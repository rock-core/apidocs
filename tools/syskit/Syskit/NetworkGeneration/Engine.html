<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Syskit::NetworkGeneration::Engine
  
    &mdash; Documentation by YARD 0.9.19
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Syskit::NetworkGeneration::Engine";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (E)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../NetworkGeneration.html" title="Syskit::NetworkGeneration (module)">NetworkGeneration</a></span></span>
     &raquo; 
    <span class="title">Engine</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Syskit::NetworkGeneration::Engine
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Syskit::NetworkGeneration::Engine</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd>Logger::Hierarchy</dd>
  </dl>
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>Logger::Hierarchy, Roby::DRoby::EventLogging</dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/syskit/network_generation/engine.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>The main deployment algorithm</p>

<p>Engine instances are the objects that actually get deployment requirements
and produce a deployment, possibly dynamically.</p>

<p>The main entry point for the algorithm is Engine#resolve</p>


  </div>
</div>
<div class="tags">
  

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="dot_index-classvariable" class="">@@dot_index =
          
        </dt>
        <dd><pre class="code"><span class='int'>0</span></pre></dd>
      
    </dl>
  




  <h2>Class Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_logging_buffer_size-class_method" title="default_logging_buffer_size (class method)">.<strong>default_logging_buffer_size</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The buffer size used to create connections to the logger in case the
dataflow dynamics can&#39;t be computed.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#deployment_postprocessing-class_method" title="deployment_postprocessing (class method)">.<strong>deployment_postprocessing</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set of blocks registered with register_deployment_postprocessing.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#final_network_postprocessing-class_method" title="final_network_postprocessing (class method)">.<strong>final_network_postprocessing</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set of blocks registered with register_final_network_postprocessing.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#instanciated_network_postprocessing-class_method" title="instanciated_network_postprocessing (class method)">.<strong>instanciated_network_postprocessing</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set of blocks registered with register_instanciated_network_postprocessing.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#instanciation_postprocessing-class_method" title="instanciation_postprocessing (class method)">.<strong>instanciation_postprocessing</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set of blocks registered with register_instanciation_postprocessing.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_error-class_method" title="on_error (class method)">.<strong>on_error</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Globally controls what happens when resolution fails.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#system_network_postprocessing-class_method" title="system_network_postprocessing (class method)">.<strong>system_network_postprocessing</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set of blocks registered with register_system_network_postprocessing.</p>
</div></span>
  
</li>

    
  </ul>

  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#dataflow_dynamics-instance_method" title="#dataflow_dynamics (instance method)">#<strong>dataflow_dynamics</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The DataFlowDynamics instance that has been used to compute
<code>port_dynamics</code>.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#deployed_tasks-instance_method" title="#deployed_tasks (instance method)">#<strong>deployed_tasks</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The set of tasks that are in-use after adaptation of the running plan.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#deployment_tasks-instance_method" title="#deployment_tasks (instance method)">#<strong>deployment_tasks</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The set of deployment tasks that are in-use after adaptation of the running
plan.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#event_logger-instance_method" title="#event_logger (instance method)">#<strong>event_logger</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute event_logger.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#merge_solver-instance_method" title="#merge_solver (instance method)">#<strong>merge_solver</strong>  &#x21d2; MergeSolver </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The merge solver instance used during resolution.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#port_dynamics-instance_method" title="#port_dynamics (instance method)">#<strong>port_dynamics</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A mapping of type.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#real_plan-instance_method" title="#real_plan (instance method)">#<strong>real_plan</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The underlying plan.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#task_context_deployment_candidates-instance_method" title="#task_context_deployment_candidates (instance method)">#<strong>task_context_deployment_candidates</strong>  &#x21d2; Hash{Model&lt;TaskContext&gt;=&gt;Model&lt;Deployment&gt;} </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A mapping from task context models to deployment models that contain such a
task.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#work_plan-instance_method" title="#work_plan (instance method)">#<strong>work_plan</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The plan we are modifying.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#autosave_plan_to_dot-class_method" title="autosave_plan_to_dot (class method)">.<strong>autosave_plan_to_dot</strong>(plan, dir = Roby.app.log_dir, prefix: nil, suffix: nil, **dot_options)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#discover_requirement_tasks_from_plan-class_method" title="discover_requirement_tasks_from_plan (class method)">.<strong>discover_requirement_tasks_from_plan</strong>(plan)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Computes the set of requirement tasks that should be used for deployment
within the given plan.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_deployment_postprocessing-class_method" title="register_deployment_postprocessing (class method)">.<strong>register_deployment_postprocessing</strong>(&amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Registers a system-wide post-processing stage for the deployed network.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_final_network_postprocessing-class_method" title="register_final_network_postprocessing (class method)">.<strong>register_final_network_postprocessing</strong>(&amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Registers a system-wide post-processing stage for the final network.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_instanciated_network_postprocessing-class_method" title="register_instanciated_network_postprocessing (class method)">.<strong>register_instanciated_network_postprocessing</strong>(&amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Registers a system-wide post-processing stage for augmenting the system
network instanciation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_instanciation_postprocessing-class_method" title="register_instanciation_postprocessing (class method)">.<strong>register_instanciation_postprocessing</strong>(&amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Registers a system-wide post-processing stage for the instanciation stage.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_system_network_postprocessing-class_method" title="register_system_network_postprocessing (class method)">.<strong>register_system_network_postprocessing</strong>(&amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Registers a system-wide post-processing stage for the system network (i.e.
the complete network before it gets merged with deployed tasks).</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#adapt_existing_deployment-instance_method" title="#adapt_existing_deployment (instance method)">#<strong>adapt_existing_deployment</strong>(deployment_task, existing_deployment_task)  &#x21d2; Array&lt;Syskit::TaskContext&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given a required deployment task in <span class='object_link'><a href="#work_plan-instance_method" title="Syskit::NetworkGeneration::Engine#work_plan (method)">#work_plan</a></span> and a proxy representing
an existing deployment task in <span class='object_link'><a href="#real_plan-instance_method" title="Syskit::NetworkGeneration::Engine#real_plan (method)">#real_plan</a></span>, modify the plan to reuse the
existing deployment.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply_deployed_network_to_plan-instance_method" title="#apply_deployed_network_to_plan (instance method)">#<strong>apply_deployed_network_to_plan</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Apply the deployed network created with <span class='object_link'><a href="#compute_deployed_network-instance_method" title="Syskit::NetworkGeneration::Engine#compute_deployed_network (method)">#compute_deployed_network</a></span> to the
existing plan.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply_merge_to_stored_instances-instance_method" title="#apply_merge_to_stored_instances (instance method)">#<strong>apply_merge_to_stored_instances</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates the tasks stored in <span class='object_link'><a href="#dataflow_dynamics-instance_method" title="Syskit::NetworkGeneration::Engine#dataflow_dynamics (method)">#dataflow_dynamics</a></span> with the tasks that will
replace them in <span class='object_link'><a href="#real_plan-instance_method" title="Syskit::NetworkGeneration::Engine#real_plan (method)">#real_plan</a></span> once the <span class='object_link'><a href="#work_plan-instance_method" title="Syskit::NetworkGeneration::Engine#work_plan (method)">#work_plan</a></span> transaction is
committed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply_system_network_to_plan-instance_method" title="#apply_system_network_to_plan (instance method)">#<strong>apply_system_network_to_plan</strong>(required_instances, compute_deployments: true, garbage_collect: true, validate_final_network: true)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#available_deployments-instance_method" title="#available_deployments (instance method)">#<strong>available_deployments</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the set of deployments that are available for this network
generation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compute_deployed_network-instance_method" title="#compute_deployed_network (instance method)">#<strong>compute_deployed_network</strong>(compute_policies: true, validate_deployed_network: true)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Transform the system network into a deployed network.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compute_system_network-instance_method" title="#compute_system_network (instance method)">#<strong>compute_system_network</strong>(requirement_tasks = Engine.discover_requirement_tasks_from_plan(real_plan), garbage_collect: true, validate_abstract_network: true, validate_generated_network: true)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#finalize_deployed_tasks-instance_method" title="#finalize_deployed_tasks (instance method)">#<strong>finalize_deployed_tasks</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given the network with deployed tasks, this method looks at how we could
adapt the running network to the new one.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_current_deployed_task-instance_method" title="#find_current_deployed_task (instance method)">#<strong>find_current_deployed_task</strong>(deployed_tasks)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Find the “last” deployed task in a set of related deployed tasks in the
plan.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fix_toplevel_tasks-instance_method" title="#fix_toplevel_tasks (instance method)">#<strong>fix_toplevel_tasks</strong>(required_instances)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Replaces the toplevel tasks (i.e. tasks planned by the
InstanceRequirementsTask tasks) by their computed implementation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handle_resolution_exception-instance_method" title="#handle_resolution_exception (instance method)">#<strong>handle_resolution_exception</strong>(e, on_error: :discard)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(plan, work_plan: Roby::Transaction.new(plan), event_logger: plan.event_logger)  &#x21d2; Engine </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of Engine.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pretty_print-instance_method" title="#pretty_print (instance method)">#<strong>pretty_print</strong>(pp)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reconfigure_tasks_on_static_port_modification-instance_method" title="#reconfigure_tasks_on_static_port_modification (instance method)">#<strong>reconfigure_tasks_on_static_port_modification</strong>(deployed_tasks)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>After the deployment phase, we check whether some static ports are modified
and cause their task to be reconfigured.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#resolve-instance_method" title="#resolve (instance method)">#<strong>resolve</strong>(requirement_tasks: Engine.discover_requirement_tasks_from_plan(real_plan), on_error: self.class.on_error, compute_deployments: true, compute_policies: true, garbage_collect: true, validate_abstract_network: true, validate_generated_network: true, validate_deployed_network: true, validate_final_network: true)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate the deployment according to the current requirements, and merges
it into the current plan.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#resolve_system_network-instance_method" title="#resolve_system_network (instance method)">#<strong>resolve_system_network</strong>(requirement_tasks, garbage_collect: true, validate_abstract_network: true, validate_generated_network: true, validate_deployed_network: true, compute_deployments: true, compute_policies: true)  &#x21d2; Hash&lt;InstanceRequirementsTask,InstanceRequirementsTask&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Computes the system network, that is the network that fullfills a list of
requirements.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_dot-instance_method" title="#to_dot (instance method)">#<strong>to_dot</strong>(options)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_dot_dataflow-instance_method" title="#to_dot_dataflow (instance method)">#<strong>to_dot_dataflow</strong>(remove_compositions = false, excluded_models = Set.new, annotations = [&quot;connection_policy&quot;])  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_svg-instance_method" title="#to_svg (instance method)">#<strong>to_svg</strong>(kind, filename = nil, *additional_args)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate a svg file representing the current state of the deployment.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_final_network-instance_method" title="#validate_final_network (instance method)">#<strong>validate_final_network</strong>(required_instances, plan, compute_deployments: true)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Validates the state of the network at the end of #resolve.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(plan, work_plan: Roby::Transaction.new(plan), event_logger: plan.event_logger)  &#x21d2; <tt><span class='object_link'><a href="" title="Syskit::NetworkGeneration::Engine (class)">Engine</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of Engine</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75
76
77
78
79
80</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 73</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_plan'>plan</span><span class='comma'>,</span> <span class='label'>work_plan:</span> <span class='const'>Roby</span><span class='op'>::</span><span class='const'>Transaction</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_plan'>plan</span><span class='rparen'>)</span><span class='comma'>,</span>
               <span class='label'>event_logger:</span> <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_event_logger'>event_logger</span><span class='rparen'>)</span>
    <span class='ivar'>@real_plan</span> <span class='op'>=</span> <span class='id identifier rubyid_plan'>plan</span>
    <span class='ivar'>@work_plan</span> <span class='op'>=</span> <span class='id identifier rubyid_work_plan'>work_plan</span>
    <span class='ivar'>@merge_solver</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../NetworkGeneration.html" title="Syskit::NetworkGeneration (module)">NetworkGeneration</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="MergeSolver.html" title="Syskit::NetworkGeneration::MergeSolver (class)">MergeSolver</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="MergeSolver.html#initialize-instance_method" title="Syskit::NetworkGeneration::MergeSolver#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_work_plan'>work_plan</span><span class='rparen'>)</span>
    <span class='ivar'>@event_logger</span> <span class='op'>=</span> <span class='id identifier rubyid_event_logger'>event_logger</span>
    <span class='ivar'>@required_instances</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="class_attr_details" class="attr_details">
    <h2>Class Attribute Details</h2>
    
      
      <span id="default_logging_buffer_size=-class_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="default_logging_buffer_size-class_method">
  
    .<strong>default_logging_buffer_size</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The buffer size used to create connections to the logger in case the
dataflow dynamics can&#39;t be computed</p>

<p>Defaults to 25</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 67</span>

<span class='kw'>def</span> <span class='id identifier rubyid_default_logging_buffer_size'>default_logging_buffer_size</span>
  <span class='ivar'>@default_logging_buffer_size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="deployment_postprocessing-class_method">
  
    .<strong>deployment_postprocessing</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set of blocks registered with register_deployment_postprocessing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 143</span>

<span class='kw'>def</span> <span class='id identifier rubyid_deployment_postprocessing'>deployment_postprocessing</span>
  <span class='ivar'>@deployment_postprocessing</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="final_network_postprocessing-class_method">
  
    .<strong>final_network_postprocessing</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set of blocks registered with register_final_network_postprocessing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 147</span>

<span class='kw'>def</span> <span class='id identifier rubyid_final_network_postprocessing'>final_network_postprocessing</span>
  <span class='ivar'>@final_network_postprocessing</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="instanciated_network_postprocessing-class_method">
  
    .<strong>instanciated_network_postprocessing</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set of blocks registered with register_instanciated_network_postprocessing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 135</span>

<span class='kw'>def</span> <span class='id identifier rubyid_instanciated_network_postprocessing'>instanciated_network_postprocessing</span>
  <span class='ivar'>@instanciated_network_postprocessing</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="instanciation_postprocessing-class_method">
  
    .<strong>instanciation_postprocessing</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set of blocks registered with register_instanciation_postprocessing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 131</span>

<span class='kw'>def</span> <span class='id identifier rubyid_instanciation_postprocessing'>instanciation_postprocessing</span>
  <span class='ivar'>@instanciation_postprocessing</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="on_error=-class_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="on_error-class_method">
  
    .<strong>on_error</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Globally controls what happens when resolution fails</p>

<p>The default is to throw away everything. Set to :save to save the state of
the transaction at the point of error into a dot file. Set to :commit to
apply it on the plan anyways</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_error'>on_error</span>
  <span class='ivar'>@on_error</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="system_network_postprocessing-class_method">
  
    .<strong>system_network_postprocessing</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set of blocks registered with register_system_network_postprocessing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 139</span>

<span class='kw'>def</span> <span class='id identifier rubyid_system_network_postprocessing'>system_network_postprocessing</span>
  <span class='ivar'>@system_network_postprocessing</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="dataflow_dynamics-instance_method">
  
    #<strong>dataflow_dynamics</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The DataFlowDynamics instance that has been used to compute
<code>port_dynamics</code>. It is only valid at the postprocesing stage of
the deployed network</p>

<p>It can be used to compute some connection policy by calling
DataFlowDynamics#policy_for</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 51</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dataflow_dynamics'>dataflow_dynamics</span>
  <span class='ivar'>@dataflow_dynamics</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="deployed_tasks-instance_method">
  
    #<strong>deployed_tasks</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The set of tasks that are in-use after adaptation of the running plan</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 43</span>

<span class='kw'>def</span> <span class='id identifier rubyid_deployed_tasks'>deployed_tasks</span>
  <span class='ivar'>@deployed_tasks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="deployment_tasks-instance_method">
  
    #<strong>deployment_tasks</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The set of deployment tasks that are in-use after adaptation of the running
plan</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


40
41
42</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 40</span>

<span class='kw'>def</span> <span class='id identifier rubyid_deployment_tasks'>deployment_tasks</span>
  <span class='ivar'>@deployment_tasks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="event_logger-instance_method">
  
    #<strong>event_logger</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute event_logger</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


71
72
73</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 71</span>

<span class='kw'>def</span> <span class='id identifier rubyid_event_logger'>event_logger</span>
  <span class='ivar'>@event_logger</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="merge_solver-instance_method">
  
    #<strong>merge_solver</strong>  &#x21d2; <tt><span class='object_link'><a href="MergeSolver.html" title="Syskit::NetworkGeneration::MergeSolver (class)">MergeSolver</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The merge solver instance used during resolution</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="MergeSolver.html" title="Syskit::NetworkGeneration::MergeSolver (class)">MergeSolver</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 36</span>

<span class='kw'>def</span> <span class='id identifier rubyid_merge_solver'>merge_solver</span>
  <span class='ivar'>@merge_solver</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="port_dynamics-instance_method">
  
    #<strong>port_dynamics</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>A mapping of type</p>

<pre class="code ruby"><code class="ruby">task_name =&gt; port_name =&gt; PortDynamics instance
</code></pre>

<p>that represent the dynamics of the given ports. The PortDynamics instance
might be nil, in which case it means some of the ports&#39; dynamics could
not be computed</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 60</span>

<span class='kw'>def</span> <span class='id identifier rubyid_port_dynamics'>port_dynamics</span>
  <span class='ivar'>@port_dynamics</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="real_plan-instance_method">
  
    #<strong>real_plan</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The underlying plan</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_real_plan'>real_plan</span>
  <span class='ivar'>@real_plan</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="task_context_deployment_candidates-instance_method">
  
    #<strong>task_context_deployment_candidates</strong>  &#x21d2; <tt>Hash{Model&lt;<span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">TaskContext</a></span>&gt;=&gt;Model&lt;<span class='object_link'><a href="../Deployment.html" title="Syskit::Deployment (class)">Deployment</a></span>&gt;}</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>A mapping from task context models to deployment models that contain such a
task.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{Model&lt;<span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">TaskContext</a></span>&gt;=&gt;Model&lt;<span class='object_link'><a href="../Deployment.html" title="Syskit::Deployment (class)">Deployment</a></span>&gt;}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


32
33
34</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 32</span>

<span class='kw'>def</span> <span class='id identifier rubyid_task_context_deployment_candidates'>task_context_deployment_candidates</span>
  <span class='ivar'>@task_context_deployment_candidates</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="work_plan-instance_method">
  
    #<strong>work_plan</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The plan we are modifying. It is usually a transaction on top of #plan</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 28</span>

<span class='kw'>def</span> <span class='id identifier rubyid_work_plan'>work_plan</span>
  <span class='ivar'>@work_plan</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="autosave_plan_to_dot-class_method">
  
    .<strong>autosave_plan_to_dot</strong>(plan, dir = Roby.app.log_dir, prefix: nil, suffix: nil, **dot_options)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


713
714
715
716
717
718
719
720
721
722
723
724
725
726</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 713</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_autosave_plan_to_dot'>autosave_plan_to_dot</span><span class='lparen'>(</span><span class='id identifier rubyid_plan'>plan</span><span class='comma'>,</span> <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='const'>Roby</span><span class='period'>.</span><span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_log_dir'>log_dir</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>suffix:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_dot_options'>dot_options</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dot_index'>dot_index</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='cvar'>@@dot_index</span> <span class='op'>+=</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dataflow_path'>dataflow_path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>syskit-plan-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_prefix'>prefix</span><span class='embexpr_end'>}</span><span class='tstring_content'>%04i</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_suffix'>suffix</span><span class='embexpr_end'>}</span><span class='tstring_content'>.%s.dot</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                              <span class='lbracket'>[</span><span class='id identifier rubyid_dot_index'>dot_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>dataflow</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_hierarchy_path'>hierarchy_path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>syskit-plan-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_prefix'>prefix</span><span class='embexpr_end'>}</span><span class='tstring_content'>%04i</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_suffix'>suffix</span><span class='embexpr_end'>}</span><span class='tstring_content'>.%s.dot</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                               <span class='lbracket'>[</span><span class='id identifier rubyid_dot_index'>dot_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hierarchy</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_dataflow_path'>dataflow_path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>w</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
        <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='const'><span class='object_link'><a href="../Graphviz.html" title="Syskit::Graphviz (class)">Graphviz</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Graphviz.html#initialize-instance_method" title="Syskit::Graphviz#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_plan'>plan</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dataflow'><span class='object_link'><a href="../Graphviz.html#dataflow-instance_method" title="Syskit::Graphviz#dataflow (method)">dataflow</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dot_options'>dot_options</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_hierarchy_path'>hierarchy_path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>w</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
        <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='const'><span class='object_link'><a href="../Graphviz.html" title="Syskit::Graphviz (class)">Graphviz</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Graphviz.html#initialize-instance_method" title="Syskit::Graphviz#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_plan'>plan</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_hierarchy'><span class='object_link'><a href="../Graphviz.html#hierarchy-instance_method" title="Syskit::Graphviz#hierarchy (method)">hierarchy</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dot_options'>dot_options</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_dataflow_path'>dataflow_path</span><span class='comma'>,</span> <span class='id identifier rubyid_hierarchy_path'>hierarchy_path</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="discover_requirement_tasks_from_plan-class_method">
  
    .<strong>discover_requirement_tasks_from_plan</strong>(plan)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Computes the set of requirement tasks that should be used for deployment
within the given plan</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 495</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_discover_requirement_tasks_from_plan'>discover_requirement_tasks_from_plan</span><span class='lparen'>(</span><span class='id identifier rubyid_plan'>plan</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_req_tasks'>req_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_find_local_tasks'>find_local_tasks</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../InstanceRequirementsTask.html" title="Syskit::InstanceRequirementsTask (class)">InstanceRequirementsTask</a></span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_req_tasks'>req_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_req_tasks'>req_tasks</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_req_task'>req_task</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_req_task'>req_task</span><span class='period'>.</span><span class='id identifier rubyid_failed?'>failed?</span> <span class='op'>||</span> <span class='id identifier rubyid_req_task'>req_task</span><span class='period'>.</span><span class='id identifier rubyid_pending?'>pending?</span>
            <span class='kw'>false</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_planned_task'>planned_task</span> <span class='op'>=</span> <span class='id identifier rubyid_req_task'>req_task</span><span class='period'>.</span><span class='id identifier rubyid_planned_task'>planned_task</span>
            <span class='op'>!</span><span class='id identifier rubyid_planned_task'>planned_task</span><span class='period'>.</span><span class='id identifier rubyid_finished?'>finished?</span> <span class='op'>||</span> <span class='id identifier rubyid_planned_task'>planned_task</span><span class='period'>.</span><span class='id identifier rubyid_being_repaired?'>being_repaired?</span>
        <span class='kw'>else</span>
            <span class='kw'>false</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_needed'>needed</span> <span class='op'>=</span> <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_useful_tasks'>useful_tasks</span><span class='lparen'>(</span><span class='label'>with_transactions:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_req_tasks'>req_tasks</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='op'>!</span><span class='id identifier rubyid_needed'>needed</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_req_tasks'>req_tasks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register_deployment_postprocessing-class_method">
  
    .<strong>register_deployment_postprocessing</strong>(&amp;block)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Registers a system-wide post-processing stage for the deployed network.
This post-processing block is meant to automatically configure the tasks
and/or dataflow, but not change the task graph. Unlike in
#register_system_network_postprocessing, it has access to information that
deployment provides (as e.g. port dynamics).</p>

<p>Postprocessing stages that change the task graph should be registered with
#register_instanciation_postprocessing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


205
206
207</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 205</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_register_deployment_postprocessing'>register_deployment_postprocessing</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_deployment_postprocessing'>deployment_postprocessing</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_block'>block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register_final_network_postprocessing-class_method">
  
    .<strong>register_final_network_postprocessing</strong>(&amp;block)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Registers a system-wide post-processing stage for the final network. This
is the last stage before the last validation</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


211
212
213</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 211</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_register_final_network_postprocessing'>register_final_network_postprocessing</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_final_network_postprocessing'>final_network_postprocessing</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_block'>block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register_instanciated_network_postprocessing-class_method">
  
    .<strong>register_instanciated_network_postprocessing</strong>(&amp;block)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Registers a system-wide post-processing stage for augmenting the system
network instanciation. Unlike the instanciation postprocessing stage, a
first merge pass has been done on the graph and it is therefore not final
but well-formed.</p>

<p>Postprocessing stages that configures the task(s) automatically should be
registered with #register_system_network_postprocessing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


180
181
182</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 180</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_register_instanciated_network_postprocessing'>register_instanciated_network_postprocessing</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_instanciated_network_postprocessing'>instanciated_network_postprocessing</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_block'>block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register_instanciation_postprocessing-class_method">
  
    .<strong>register_instanciation_postprocessing</strong>(&amp;block)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Registers a system-wide post-processing stage for the instanciation stage.
This post-processing block is meant to add new tasks and new relations in
the graph. It runs after the instanciation, but before the first merge pass
has been performed. I.e. in this graph, there will be present some
duplicate tasks, devices won&#39;t be assigned properly, … Use the
instanciated_network_postprocessing hook to be called after this first
merge pass.</p>

<p>Use it to instanciate/annotate the graph early, i.e. before some
system-wide processing is done</p>

<p>Postprocessing stages that configures the task(s) automatically should be
registered with #register_system_network_postprocessing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


169
170
171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 169</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_register_instanciation_postprocessing'>register_instanciation_postprocessing</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_instanciation_postprocessing'>instanciation_postprocessing</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_block'>block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register_system_network_postprocessing-class_method">
  
    .<strong>register_system_network_postprocessing</strong>(&amp;block)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Registers a system-wide post-processing stage for the system network (i.e.
the complete network before it gets merged with deployed tasks). This
post-processing block is meant to automatically configure the tasks and/or
dataflow, but not change the task graph</p>

<p>Postprocessing stages that change the task graph should be registered with
#register_instanciation_postprocessing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


192
193
194</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 192</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_register_system_network_postprocessing'>register_system_network_postprocessing</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_system_network_postprocessing'>system_network_postprocessing</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_block'>block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="adapt_existing_deployment-instance_method">
  
    #<strong>adapt_existing_deployment</strong>(deployment_task, existing_deployment_task)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">Syskit::TaskContext</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given a required deployment task in <span class='object_link'><a href="#work_plan-instance_method" title="Syskit::NetworkGeneration::Engine#work_plan (method)">#work_plan</a></span> and a proxy representing
an existing deployment task in <span class='object_link'><a href="#real_plan-instance_method" title="Syskit::NetworkGeneration::Engine#real_plan (method)">#real_plan</a></span>, modify the plan to reuse the
existing deployment</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">Syskit::TaskContext</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the set of TaskContext instances that have been used to replace the task
contexts generated during network generation. They are all deployed by
existing_deployment_task, and some of them might be transaction proxies.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 446</span>

<span class='kw'>def</span> <span class='id identifier rubyid_adapt_existing_deployment'>adapt_existing_deployment</span><span class='lparen'>(</span><span class='id identifier rubyid_deployment_task'>deployment_task</span><span class='comma'>,</span> <span class='id identifier rubyid_existing_deployment_task'>existing_deployment_task</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_orocos_name_to_existing'>orocos_name_to_existing</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_existing_deployment_task'>existing_deployment_task</span><span class='period'>.</span><span class='id identifier rubyid_each_executed_task'>each_executed_task</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_finished?'>finished?</span>
        <span class='lparen'>(</span><span class='id identifier rubyid_orocos_name_to_existing'>orocos_name_to_existing</span><span class='lbracket'>[</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_t'>t</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_applied_merges'>applied_merges</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_deployed_tasks'>deployed_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_deployment_task'>deployment_task</span><span class='period'>.</span><span class='id identifier rubyid_each_executed_task'>each_executed_task</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='id identifier rubyid_deployed_tasks'>deployed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_task'>task</span><span class='op'>|</span>
        <span class='id identifier rubyid_existing_tasks'>existing_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_orocos_name_to_existing'>orocos_name_to_existing</span><span class='lbracket'>[</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='rbracket'>]</span> <span class='op'>||</span>
            <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_existing_tasks'>existing_tasks</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_existing_task'>existing_task</span> <span class='op'>=</span> <span class='id identifier rubyid_find_current_deployed_task'>find_current_deployed_task</span><span class='lparen'>(</span><span class='id identifier rubyid_existing_tasks'>existing_tasks</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_existing_task'>existing_task</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_can_be_deployed_by?'>can_be_deployed_by?</span><span class='lparen'>(</span><span class='id identifier rubyid_existing_task'>existing_task</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
                <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_existing_task'>existing_task</span>
                    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  task </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> has not yet been deployed</span><span class='tstring_end'>&quot;</span></span>
                <span class='kw'>else</span>
                    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  task </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> has been deployed, but I can&#39;t merge with the existing deployment (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_existing_task'>existing_task</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
                <span class='kw'>end</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_new_task'>new_task</span> <span class='op'>=</span> <span class='id identifier rubyid_existing_deployment_task'>existing_deployment_task</span><span class='period'>.</span><span class='id identifier rubyid_task'>task</span><span class='lparen'>(</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='comma'>,</span> <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_concrete_model'>concrete_model</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  creating </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_task'>new_task</span><span class='embexpr_end'>}</span><span class='tstring_content'> for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_task'>task</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='id identifier rubyid_existing_tasks'>existing_tasks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_previous_task'>previous_task</span><span class='op'>|</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_task'>new_task</span><span class='embexpr_end'>}</span><span class='tstring_content'> needs to wait for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_existing_task'>existing_task</span><span class='embexpr_end'>}</span><span class='tstring_content'> to finish before reconfiguring</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
                <span class='id identifier rubyid_parent_task_contexts'>parent_task_contexts</span> <span class='op'>=</span> <span class='id identifier rubyid_previous_task'>previous_task</span><span class='period'>.</span><span class='id identifier rubyid_each_parent_task'>each_parent_task</span><span class='period'>.</span>
                    <span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">TaskContext</a></span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
                <span class='id identifier rubyid_parent_task_contexts'>parent_task_contexts</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
                    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_remove_child'>remove_child</span><span class='lparen'>(</span><span class='id identifier rubyid_previous_task'>previous_task</span><span class='rparen'>)</span>
                <span class='kw'>end</span>
                <span class='id identifier rubyid_new_task'>new_task</span><span class='period'>.</span><span class='id identifier rubyid_should_configure_after'>should_configure_after</span><span class='lparen'>(</span><span class='id identifier rubyid_previous_task'>previous_task</span><span class='period'>.</span><span class='id identifier rubyid_stop_event'>stop_event</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_existing_task'>existing_task</span> <span class='op'>=</span> <span class='id identifier rubyid_new_task'>new_task</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_merge_solver'>merge_solver</span><span class='period'>.</span><span class='id identifier rubyid_apply_merge_group'>apply_merge_group</span><span class='lparen'>(</span><span class='id identifier rubyid_task'>task</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_existing_task'>existing_task</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_applied_merges'>applied_merges</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_existing_task'>existing_task</span>
        <span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  using </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_existing_task'>existing_task</span><span class='embexpr_end'>}</span><span class='tstring_content'> for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_task'>task</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_remove_task'>remove_task</span><span class='lparen'>(</span><span class='id identifier rubyid_deployment_task'>deployment_task</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_applied_merges'>applied_merges</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="apply_deployed_network_to_plan-instance_method">
  
    #<strong>apply_deployed_network_to_plan</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Apply the deployed network created with <span class='object_link'><a href="#compute_deployed_network-instance_method" title="Syskit::NetworkGeneration::Engine#compute_deployed_network (method)">#compute_deployed_network</a></span> to the
existing plan</p>

<p>It accesses <span class='object_link'><a href="#real_plan-instance_method" title="Syskit::NetworkGeneration::Engine#real_plan (method)">#real_plan</a></span></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 110</span>

<span class='kw'>def</span> <span class='id identifier rubyid_apply_deployed_network_to_plan'>apply_deployed_network_to_plan</span>
    <span class='comment'># Finally, we map the deployed network to the currently
</span>    <span class='comment'># running tasks
</span>    <span class='ivar'>@deployment_tasks</span><span class='comma'>,</span> <span class='ivar'>@deployed_tasks</span> <span class='op'>=</span>
        <span class='id identifier rubyid_log_timepoint_group'>log_timepoint_group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>finalize_deployed_tasks</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
            <span class='id identifier rubyid_finalize_deployed_tasks'>finalize_deployed_tasks</span>
        <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='ivar'>@dataflow_dynamics</span>
        <span class='ivar'>@dataflow_dynamics</span><span class='period'>.</span><span class='id identifier rubyid_apply_merges'>apply_merges</span><span class='lparen'>(</span><span class='id identifier rubyid_merge_solver'>merge_solver</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>apply_merged_to_dataflow_dynamics</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>
    <span class='const'><span class='object_link'><a href="" title="Syskit::NetworkGeneration::Engine (class)">Engine</a></span></span><span class='period'>.</span><span class='id identifier rubyid_deployment_postprocessing'><span class='object_link'><a href="#deployment_postprocessing-class_method" title="Syskit::NetworkGeneration::Engine.deployment_postprocessing (method)">deployment_postprocessing</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_block'>block</span><span class='op'>|</span>
        <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>postprocessing:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block'>block</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="apply_merge_to_stored_instances-instance_method">
  
    #<strong>apply_merge_to_stored_instances</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Updates the tasks stored in <span class='object_link'><a href="#dataflow_dynamics-instance_method" title="Syskit::NetworkGeneration::Engine#dataflow_dynamics (method)">#dataflow_dynamics</a></span> with the tasks that will
replace them in <span class='object_link'><a href="#real_plan-instance_method" title="Syskit::NetworkGeneration::Engine#real_plan (method)">#real_plan</a></span> once the <span class='object_link'><a href="#work_plan-instance_method" title="Syskit::NetworkGeneration::Engine#work_plan (method)">#work_plan</a></span> transaction is
committed.</p>

<p>It also updates the merge graph in <span class='object_link'><a href="#merge_solver-instance_method" title="Syskit::NetworkGeneration::Engine#merge_solver (method)">#merge_solver</a></span> so that it points to
tasks in <span class='object_link'><a href="#real_plan-instance_method" title="Syskit::NetworkGeneration::Engine#real_plan (method)">#real_plan</a></span></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


221
222
223
224
225
226
227
228
229
230
231</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 221</span>

<span class='kw'>def</span> <span class='id identifier rubyid_apply_merge_to_stored_instances'>apply_merge_to_stored_instances</span>
    <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_each_task'>each_task</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_task'>task</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_transaction_proxy?'>transaction_proxy?</span>
            <span class='id identifier rubyid_merge_solver'>merge_solver</span><span class='period'>.</span><span class='id identifier rubyid_register_replacement'>register_replacement</span><span class='lparen'>(</span><span class='id identifier rubyid_task'>task</span><span class='comma'>,</span> <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid___getobj__'>__getobj__</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='ivar'>@dataflow_dynamics</span>
        <span class='ivar'>@dataflow_dynamics</span><span class='period'>.</span><span class='id identifier rubyid_apply_merges'>apply_merges</span><span class='lparen'>(</span><span class='id identifier rubyid_merge_solver'>merge_solver</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="apply_system_network_to_plan-instance_method">
  
    #<strong>apply_system_network_to_plan</strong>(required_instances, compute_deployments: true, garbage_collect: true, validate_final_network: true)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 628</span>

<span class='kw'>def</span> <span class='id identifier rubyid_apply_system_network_to_plan'>apply_system_network_to_plan</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_required_instances'>required_instances</span><span class='comma'>,</span> <span class='label'>compute_deployments:</span> <span class='kw'>true</span><span class='comma'>,</span>
    <span class='label'>garbage_collect:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>validate_final_network:</span> <span class='kw'>true</span><span class='rparen'>)</span>

    <span class='comment'># Now, deploy the network by matching the available
</span>    <span class='comment'># deployments to the one in the generated network. Note that
</span>    <span class='comment'># these deployments are *not* yet the running tasks.
</span>    <span class='comment'>#
</span>    <span class='comment'># The mapping from this deployed network to the running
</span>    <span class='comment'># tasks is done in #finalize_deployed_tasks
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_compute_deployments'>compute_deployments</span>
        <span class='id identifier rubyid_log_timepoint_group'>log_timepoint_group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>apply_deployed_network_to_plan</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
            <span class='id identifier rubyid_apply_deployed_network_to_plan'>apply_deployed_network_to_plan</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_apply_merge_to_stored_instances'>apply_merge_to_stored_instances</span>
    <span class='id identifier rubyid_required_instances'>required_instances</span> <span class='op'>=</span> <span class='id identifier rubyid_required_instances'>required_instances</span><span class='period'>.</span><span class='id identifier rubyid_map_value'>map_value</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_task'>task</span><span class='op'>|</span>
        <span class='id identifier rubyid_merge_solver'>merge_solver</span><span class='period'>.</span><span class='id identifier rubyid_replacement_for'>replacement_for</span><span class='lparen'>(</span><span class='id identifier rubyid_task'>task</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>apply_merge_to_stored_instances</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_fix_toplevel_tasks'>fix_toplevel_tasks</span><span class='lparen'>(</span><span class='id identifier rubyid_required_instances'>required_instances</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>fix_toplevel_tasks</span><span class='tstring_end'>&#39;</span></span>

    <span class='const'><span class='object_link'><a href="" title="Syskit::NetworkGeneration::Engine (class)">Engine</a></span></span><span class='period'>.</span><span class='id identifier rubyid_final_network_postprocessing'><span class='object_link'><a href="#final_network_postprocessing-class_method" title="Syskit::NetworkGeneration::Engine.final_network_postprocessing (method)">final_network_postprocessing</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_block'>block</span><span class='op'>|</span>
        <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>final_network_postprocessing:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block'>block</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'># Finally, we should now only have deployed tasks. Verify it
</span>    <span class='comment'># and compute the connection policies
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_garbage_collect'>garbage_collect</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_validate_final_network'>validate_final_network</span>
        <span class='id identifier rubyid_validate_final_network'>validate_final_network</span><span class='lparen'>(</span><span class='id identifier rubyid_required_instances'>required_instances</span><span class='comma'>,</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='comma'>,</span> <span class='label'>compute_deployments:</span> <span class='id identifier rubyid_compute_deployments'>compute_deployments</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>validate_final_network</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_commit_transaction'>commit_transaction</span>
    <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>commit_transaction</span><span class='tstring_end'>&#39;</span></span>

    <span class='comment'># Reset the oroGen model on all already-running tasks
</span>    <span class='id identifier rubyid_real_plan'>real_plan</span><span class='period'>.</span><span class='id identifier rubyid_find_tasks'>find_tasks</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">TaskContext</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_task'>task</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_orocos_task'>orocos_task</span> <span class='op'>=</span> <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:model=</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='period'>.</span><span class='id identifier rubyid_model'>model</span> <span class='op'>=</span> <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_orogen_model'>orogen_model</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="available_deployments-instance_method">
  
    #<strong>available_deployments</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the set of deployments that are available for this network
generation</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 84</span>

<span class='kw'>def</span> <span class='id identifier rubyid_available_deployments'>available_deployments</span>
    <span class='const'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span><span class='period'>.</span><span class='id identifier rubyid_conf'><span class='object_link'><a href="../../Syskit.html#conf-class_method" title="Syskit.conf (method)">conf</a></span></span><span class='period'>.</span><span class='id identifier rubyid_deployments'>deployments</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compute_deployed_network-instance_method">
  
    #<strong>compute_deployed_network</strong>(compute_policies: true, validate_deployed_network: true)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Transform the system network into a deployed network</p>

<p>This does not access <span class='object_link'><a href="#real_plan-instance_method" title="Syskit::NetworkGeneration::Engine#real_plan (method)">#real_plan</a></span></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


91
92
93
94
95
96
97
98
99
100
101
102
103
104</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 91</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compute_deployed_network'>compute_deployed_network</span><span class='lparen'>(</span><span class='label'>compute_policies:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>validate_deployed_network:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_log_timepoint_group'>log_timepoint_group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>deploy_system_network</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
        <span class='const'><span class='object_link'><a href="SystemNetworkDeployer.html" title="Syskit::NetworkGeneration::SystemNetworkDeployer (class)">SystemNetworkDeployer</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="SystemNetworkDeployer.html#initialize-instance_method" title="Syskit::NetworkGeneration::SystemNetworkDeployer#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_work_plan'>work_plan</span><span class='comma'>,</span> <span class='label'>event_logger:</span> <span class='id identifier rubyid_event_logger'>event_logger</span><span class='comma'>,</span> <span class='label'>merge_solver:</span> <span class='id identifier rubyid_merge_solver'>merge_solver</span><span class='rparen'>)</span><span class='period'>.</span>
            <span class='id identifier rubyid_deploy'>deploy</span><span class='lparen'>(</span><span class='label'>validate:</span> <span class='id identifier rubyid_validate_deployed_network'>validate_deployed_network</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># Now that we have a deployed network, we can compute the
</span>    <span class='comment'># connection policies and the port dynamics
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_compute_policies'>compute_policies</span>
        <span class='ivar'>@dataflow_dynamics</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="DataFlowDynamics.html" title="Syskit::NetworkGeneration::DataFlowDynamics (class)">DataFlowDynamics</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="DataFlowDynamics.html#initialize-instance_method" title="Syskit::NetworkGeneration::DataFlowDynamics#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_work_plan'>work_plan</span><span class='rparen'>)</span>
        <span class='ivar'>@port_dynamics</span> <span class='op'>=</span> <span class='id identifier rubyid_dataflow_dynamics'>dataflow_dynamics</span><span class='period'>.</span><span class='id identifier rubyid_compute_connection_policies'>compute_connection_policies</span>
        <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>compute_connection_policies</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compute_system_network-instance_method">
  
    #<strong>compute_system_network</strong>(requirement_tasks = Engine.discover_requirement_tasks_from_plan(real_plan), garbage_collect: true, validate_abstract_network: true, validate_generated_network: true)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 513</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compute_system_network'>compute_system_network</span><span class='lparen'>(</span><span class='id identifier rubyid_requirement_tasks'>requirement_tasks</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Syskit::NetworkGeneration::Engine (class)">Engine</a></span></span><span class='period'>.</span><span class='id identifier rubyid_discover_requirement_tasks_from_plan'><span class='object_link'><a href="#discover_requirement_tasks_from_plan-class_method" title="Syskit::NetworkGeneration::Engine.discover_requirement_tasks_from_plan (method)">discover_requirement_tasks_from_plan</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_real_plan'>real_plan</span><span class='rparen'>)</span><span class='comma'>,</span>
                           <span class='label'>garbage_collect:</span> <span class='kw'>true</span><span class='comma'>,</span>
                           <span class='label'>validate_abstract_network:</span> <span class='kw'>true</span><span class='comma'>,</span>
                           <span class='label'>validate_generated_network:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_requirement_tasks'>requirement_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_requirement_tasks'>requirement_tasks</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='id identifier rubyid_instance_requirements'>instance_requirements</span> <span class='op'>=</span> <span class='id identifier rubyid_requirement_tasks'>requirement_tasks</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:requirements</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_system_network_generator'>system_network_generator</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="SystemNetworkGenerator.html" title="Syskit::NetworkGeneration::SystemNetworkGenerator (class)">SystemNetworkGenerator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="SystemNetworkGenerator.html#initialize-instance_method" title="Syskit::NetworkGeneration::SystemNetworkGenerator#initialize (method)">new</a></span></span><span class='lparen'>(</span>
        <span class='id identifier rubyid_work_plan'>work_plan</span><span class='comma'>,</span> <span class='label'>event_logger:</span> <span class='id identifier rubyid_event_logger'>event_logger</span><span class='comma'>,</span> <span class='label'>merge_solver:</span> <span class='id identifier rubyid_merge_solver'>merge_solver</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_toplevel_tasks'>toplevel_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_system_network_generator'>system_network_generator</span><span class='period'>.</span><span class='id identifier rubyid_generate'>generate</span><span class='lparen'>(</span>
        <span class='id identifier rubyid_instance_requirements'>instance_requirements</span><span class='comma'>,</span>
        <span class='label'>garbage_collect:</span> <span class='id identifier rubyid_garbage_collect'>garbage_collect</span><span class='comma'>,</span>
        <span class='label'>validate_abstract_network:</span> <span class='id identifier rubyid_validate_abstract_network'>validate_abstract_network</span><span class='comma'>,</span>
        <span class='label'>validate_generated_network:</span> <span class='id identifier rubyid_validate_generated_network'>validate_generated_network</span><span class='rparen'>)</span>

    <span class='const'>Hash</span><span class='lbracket'>[</span> <span class='id identifier rubyid_requirement_tasks'>requirement_tasks</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='id identifier rubyid_toplevel_tasks'>toplevel_tasks</span><span class='rparen'>)</span> <span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="finalize_deployed_tasks-instance_method">
  
    #<strong>finalize_deployed_tasks</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given the network with deployed tasks, this method looks at how we could
adapt the running network to the new one</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 264</span>

<span class='kw'>def</span> <span class='id identifier rubyid_finalize_deployed_tasks'>finalize_deployed_tasks</span>
    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>finalizing deployed tasks</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_used_deployments'>used_deployments</span> <span class='op'>=</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_find_local_tasks'>find_local_tasks</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Deployment.html" title="Syskit::Deployment (class)">Deployment</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span>
    <span class='id identifier rubyid_used_tasks'>used_tasks</span>       <span class='op'>=</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_find_local_tasks'>find_local_tasks</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Component.html" title="Syskit::Component (class)">Component</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span>
    <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>used_tasks</span><span class='tstring_end'>&#39;</span></span>

    <span class='id identifier rubyid_all_tasks'>all_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_find_tasks'>find_tasks</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Component.html" title="Syskit::Component (class)">Component</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span>
    <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>import_all_tasks_from_plan</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_all_tasks'>all_tasks</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_reusable?'>reusable?</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  clearing the relations of the finished task </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_remove_relations'>remove_relations</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Syskit.html#Flows-constant" title="Syskit::Flows (constant)">Flows</a></span></span><span class='op'>::</span><span class='const'>DataFlow</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_remove_relations'>remove_relations</span><span class='lparen'>(</span><span class='const'>Roby</span><span class='op'>::</span><span class='const'>TaskStructure</span><span class='op'>::</span><span class='const'>Dependency</span><span class='rparen'>)</span>
            <span class='kw'>true</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_transaction_proxy?'>transaction_proxy?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_abstract?'>abstract?</span>
            <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_remove_task'>remove_task</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span>
            <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>all_tasks_cleanup</span><span class='tstring_end'>&#39;</span></span>

    <span class='comment'># Remove connections that are not forwarding connections (e.g.
</span>    <span class='comment'># composition exports)
</span>    <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span> <span class='op'>=</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_task_relation_graph_for'>task_relation_graph_for</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Syskit.html#Flows-constant" title="Syskit::Flows (constant)">Flows</a></span></span><span class='op'>::</span><span class='const'>DataFlow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_all_tasks'>all_tasks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_used_tasks'>used_tasks</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_in_neighbours'>in_neighbours</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_source_t'>source_t</span><span class='op'>|</span>
            <span class='id identifier rubyid_connections'>connections</span> <span class='op'>=</span> <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_edge_info'>edge_info</span><span class='lparen'>(</span><span class='id identifier rubyid_source_t'>source_t</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
            <span class='id identifier rubyid_connections'>connections</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_source_port'>source_port</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_port'>sink_port</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='op'>|</span>
                <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_source_t'>source_t</span><span class='period'>.</span><span class='id identifier rubyid_find_output_port'>find_output_port</span><span class='lparen'>(</span><span class='id identifier rubyid_source_port'>source_port</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_find_output_port'>find_output_port</span><span class='lparen'>(</span><span class='id identifier rubyid_sink_port'>sink_port</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
                    <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_source_t'>source_t</span><span class='period'>.</span><span class='id identifier rubyid_find_input_port'>find_input_port</span><span class='lparen'>(</span><span class='id identifier rubyid_source_port'>source_port</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_find_input_port'>find_input_port</span><span class='lparen'>(</span><span class='id identifier rubyid_sink_port'>sink_port</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
            <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_connections'>connections</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
                <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_set_edge_info'>set_edge_info</span><span class='lparen'>(</span><span class='id identifier rubyid_source_t'>source_t</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='id identifier rubyid_connections'>connections</span><span class='rparen'>)</span>
            <span class='kw'>else</span>
                <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_remove_edge'>remove_edge</span><span class='lparen'>(</span><span class='id identifier rubyid_source_t'>source_t</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>dataflow_graph_cleanup</span><span class='tstring_end'>&#39;</span></span>

    <span class='id identifier rubyid_deployments'>deployments</span> <span class='op'>=</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_find_tasks'>find_tasks</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Deployment.html" title="Syskit::Deployment (class)">Deployment</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_not_finished'>not_finished</span>
    <span class='id identifier rubyid_finishing_deployments'>finishing_deployments</span><span class='comma'>,</span> <span class='id identifier rubyid_existing_deployments'>existing_deployments</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_deployments'>deployments</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_task'>task</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_finishing?'>finishing?</span>
            <span class='id identifier rubyid_finishing_deployments'>finishing_deployments</span><span class='lbracket'>[</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_process_name'>process_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_task'>task</span>
        <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_used_deployments'>used_deployments</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_task'>task</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_existing_deployments'>existing_deployments</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_task'>task</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>existing_and_finished_deployments</span><span class='tstring_end'>&#39;</span></span>

    <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  Mapping deployments in the network to the existing ones</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>    Network deployments:</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_used_deployments'>used_deployments</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_dep'>dep</span><span class='op'>|</span> <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dep'>dep</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>    Existing deployments:</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_existing_deployments'>existing_deployments</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_dep'>dep</span><span class='op'>|</span> <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dep'>dep</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
        <span class='kw'>break</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_newly_deployed_tasks'>newly_deployed_tasks</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_reused_deployed_tasks'>reused_deployed_tasks</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_selected_deployment_tasks'>selected_deployment_tasks</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_used_deployments'>used_deployments</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_deployment_task'>deployment_task</span><span class='op'>|</span>
        <span class='id identifier rubyid_existing_candidates'>existing_candidates</span> <span class='op'>=</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span>
            <span class='id identifier rubyid_find_local_tasks'>find_local_tasks</span><span class='lparen'>(</span><span class='id identifier rubyid_deployment_task'>deployment_task</span><span class='period'>.</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span><span class='period'>.</span>
            <span class='id identifier rubyid_not_finishing'>not_finishing</span><span class='period'>.</span><span class='id identifier rubyid_not_finished'>not_finished</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span>

        <span class='comment'># Check for the corresponding task in the plan
</span>        <span class='id identifier rubyid_existing_deployment_tasks'>existing_deployment_tasks</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_existing_candidates'>existing_candidates</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_existing_deployments'>existing_deployments</span><span class='rparen'>)</span><span class='period'>.</span>
            <span class='id identifier rubyid_find_all'>find_all</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
                <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_process_name'>process_name</span> <span class='op'>==</span> <span class='id identifier rubyid_deployment_task'>deployment_task</span><span class='period'>.</span><span class='id identifier rubyid_process_name'>process_name</span>
            <span class='kw'>end</span>

        <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  looking to reuse a deployment for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_deployment_task'>deployment_task</span><span class='period'>.</span><span class='id identifier rubyid_process_name'>process_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_deployment_task'>deployment_task</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_existing_deployment_tasks'>existing_deployment_tasks</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> candidates:</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_existing_deployment_tasks'>existing_deployment_tasks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_candidate_task'>candidate_task</span><span class='op'>|</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>    </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_candidate_task'>candidate_task</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>end</span>
            <span class='kw'>break</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_existing_deployment_tasks'>existing_deployment_tasks</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  deployment </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_deployment_task'>deployment_task</span><span class='period'>.</span><span class='id identifier rubyid_process_name'>process_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not yet represented in the plan</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='comment'># Nothing to do, we leave the plan as it is
</span>            <span class='id identifier rubyid_newly_deployed_tasks'>newly_deployed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_deployment_task'>deployment_task</span><span class='period'>.</span><span class='id identifier rubyid_each_executed_task'>each_executed_task</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_selected_deployment'>selected_deployment</span> <span class='op'>=</span> <span class='id identifier rubyid_deployment_task'>deployment_task</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_existing_deployment_tasks'>existing_deployment_tasks</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='int'>1</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../InternalError.html" title="Syskit::InternalError (class)">InternalError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>more than one task for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_deployment_task'>deployment_task</span><span class='period'>.</span><span class='id identifier rubyid_process_name'>process_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> present in the plan: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_existing_deployment_tasks'>existing_deployment_tasks</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_selected_deployment'>selected_deployment</span> <span class='op'>=</span> <span class='id identifier rubyid_existing_deployment_tasks'>existing_deployment_tasks</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
            <span class='id identifier rubyid_new_merged_tasks'>new_merged_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_adapt_existing_deployment'>adapt_existing_deployment</span><span class='lparen'>(</span>
                <span class='id identifier rubyid_deployment_task'>deployment_task</span><span class='comma'>,</span>
                <span class='id identifier rubyid_selected_deployment'>selected_deployment</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_reused_deployed_tasks'>reused_deployed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_new_merged_tasks'>new_merged_tasks</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_finishing'>finishing</span> <span class='op'>=</span> <span class='id identifier rubyid_finishing_deployments'>finishing_deployments</span><span class='lbracket'>[</span><span class='id identifier rubyid_selected_deployment'>selected_deployment</span><span class='period'>.</span><span class='id identifier rubyid_process_name'>process_name</span><span class='rbracket'>]</span>
            <span class='id identifier rubyid_selected_deployment'>selected_deployment</span><span class='period'>.</span><span class='id identifier rubyid_should_start_after'>should_start_after</span> <span class='id identifier rubyid_finishing'>finishing</span><span class='period'>.</span><span class='id identifier rubyid_stop_event'>stop_event</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_selected_deployment_tasks'>selected_deployment_tasks</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_selected_deployment'>selected_deployment</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>select_deployments</span><span class='tstring_end'>&#39;</span></span>

    <span class='id identifier rubyid_reused_deployed_tasks'>reused_deployed_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_reconfigure_tasks_on_static_port_modification'>reconfigure_tasks_on_static_port_modification</span><span class='lparen'>(</span>
        <span class='id identifier rubyid_reused_deployed_tasks'>reused_deployed_tasks</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>reconfigure_tasks_on_static_port_modification</span><span class='tstring_end'>&#39;</span></span>

    <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reused_deployed_tasks'>reused_deployed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> tasks reused during deployment</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_reused_deployed_tasks'>reused_deployed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
        <span class='kw'>break</span>
    <span class='kw'>end</span>

    <span class='comment'># This is required to merge the already existing compositions
</span>    <span class='comment'># with the ones in the plan
</span>    <span class='id identifier rubyid_merge_solver'>merge_solver</span><span class='period'>.</span><span class='id identifier rubyid_merge_identical_tasks'>merge_identical_tasks</span>
    <span class='id identifier rubyid_log_timepoint'>log_timepoint</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>merge</span><span class='tstring_end'>&#39;</span></span>

    <span class='lbracket'>[</span><span class='id identifier rubyid_selected_deployment_tasks'>selected_deployment_tasks</span><span class='comma'>,</span> <span class='id identifier rubyid_reused_deployed_tasks'>reused_deployed_tasks</span> <span class='op'>|</span> <span class='id identifier rubyid_newly_deployed_tasks'>newly_deployed_tasks</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_current_deployed_task-instance_method">
  
    #<strong>find_current_deployed_task</strong>(deployed_tasks)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Find the “last” deployed task in a set of related deployed tasks in the
plan</p>

<p>Ordering is encoded in the should_configure_after relation</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


425
426
427
428
429
430
431
432
433
434
435</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 425</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_current_deployed_task'>find_current_deployed_task</span><span class='lparen'>(</span><span class='id identifier rubyid_deployed_tasks'>deployed_tasks</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_configuration_precedence_graph'>configuration_precedence_graph</span> <span class='op'>=</span>
        <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_event_relation_graph_for'>event_relation_graph_for</span><span class='lparen'>(</span><span class='const'>Roby</span><span class='op'>::</span><span class='const'>EventStructure</span><span class='op'>::</span><span class='const'>SyskitConfigurationPrecedence</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_tasks'>tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_deployed_tasks'>deployed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_reusable?'>reusable?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_configuration_precedence_graph'>configuration_precedence_graph</span><span class='period'>.</span><span class='id identifier rubyid_leaf?'>leaf?</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_stop_event'>stop_event</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../InternalError.html" title="Syskit::InternalError (class)">InternalError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>could not find the current task in </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_deployed_tasks'>deployed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_s</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>, </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fix_toplevel_tasks-instance_method">
  
    #<strong>fix_toplevel_tasks</strong>(required_instances)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Replaces the toplevel tasks (i.e. tasks planned by the
InstanceRequirementsTask tasks) by their computed implementation.</p>

<p>Also updates the permanent and mission flags for these tasks.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 237</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fix_toplevel_tasks'>fix_toplevel_tasks</span><span class='lparen'>(</span><span class='id identifier rubyid_required_instances'>required_instances</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_required_instances'>required_instances</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='kw'>return</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_replacement_filter'>replacement_filter</span> <span class='op'>=</span> <span class='const'>Roby</span><span class='op'>::</span><span class='const'>Plan</span><span class='op'>::</span><span class='const'>ReplacementFilter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span>
        <span class='id identifier rubyid_exclude_relation'>exclude_relation</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Syskit.html#Flows-constant" title="Syskit::Flows (constant)">Flows</a></span></span><span class='op'>::</span><span class='const'>DataFlow</span><span class='rparen'>)</span><span class='period'>.</span>
        <span class='id identifier rubyid_exclude_tasks'>exclude_tasks</span><span class='lparen'>(</span><span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_find_local_tasks'>find_local_tasks</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Component.html" title="Syskit::Component (class)">Component</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_required_instances'>required_instances</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_req_task'>req_task</span><span class='comma'>,</span> <span class='id identifier rubyid_actual_task'>actual_task</span><span class='op'>|</span>
        <span class='id identifier rubyid_placeholder_task'>placeholder_task</span> <span class='op'>=</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_wrap_task'>wrap_task</span><span class='lparen'>(</span><span class='id identifier rubyid_req_task'>req_task</span><span class='period'>.</span><span class='id identifier rubyid_planned_task'>planned_task</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_req_task'>req_task</span>         <span class='op'>=</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_wrap_task'>wrap_task</span><span class='lparen'>(</span><span class='id identifier rubyid_req_task'>req_task</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_actual_task'>actual_task</span>      <span class='op'>=</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_wrap_task'>wrap_task</span><span class='lparen'>(</span><span class='id identifier rubyid_actual_task'>actual_task</span><span class='rparen'>)</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_placeholder_task'>placeholder_task</span> <span class='op'>!=</span> <span class='id identifier rubyid_actual_task'>actual_task</span>
            <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span><span class='lparen'>(</span><span class='id identifier rubyid_placeholder_task'>placeholder_task</span><span class='comma'>,</span> <span class='id identifier rubyid_actual_task'>actual_task</span><span class='comma'>,</span>
                <span class='label'>filter:</span> <span class='id identifier rubyid_replacement_filter'>replacement_filter</span><span class='rparen'>)</span>
            <span class='comment'># Need to switch the planning relation as well, it is
</span>            <span class='comment'># not done by #replace
</span>            <span class='id identifier rubyid_placeholder_task'>placeholder_task</span><span class='period'>.</span><span class='id identifier rubyid_remove_planning_task'>remove_planning_task</span> <span class='id identifier rubyid_req_task'>req_task</span>
            <span class='id identifier rubyid_actual_task'>actual_task</span><span class='period'>.</span><span class='id identifier rubyid_add_planning_task'>add_planning_task</span> <span class='id identifier rubyid_req_task'>req_task</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="handle_resolution_exception-instance_method">
  
    #<strong>handle_resolution_exception</strong>(e, on_error: :discard)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 675</span>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_resolution_exception'>handle_resolution_exception</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='label'>on_error:</span> <span class='symbol'>:discard</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_finalized?'>finalized?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_work_plan'>work_plan</span> <span class='op'>!=</span> <span class='id identifier rubyid_real_plan'>real_plan</span><span class='rparen'>)</span> <span class='comment'># we started processing, look at what the user wants to do with the partial transaction
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_on_error'>on_error</span> <span class='op'>==</span> <span class='symbol'>:save</span>
            <span class='id identifier rubyid_log_pp'>log_pp</span><span class='lparen'>(</span><span class='symbol'>:fatal</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_fatal'>fatal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Engine#resolve failed</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>begin</span>
                <span class='id identifier rubyid_dataflow_path'>dataflow_path</span><span class='comma'>,</span> <span class='id identifier rubyid_hierarchy_path'>hierarchy_path</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Syskit::NetworkGeneration::Engine (class)">Engine</a></span></span><span class='period'>.</span><span class='id identifier rubyid_autosave_plan_to_dot'><span class='object_link'><a href="#autosave_plan_to_dot-class_method" title="Syskit::NetworkGeneration::Engine.autosave_plan_to_dot (method)">autosave_plan_to_dot</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_work_plan'>work_plan</span><span class='comma'>,</span> <span class='const'>Roby</span><span class='period'>.</span><span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_log_dir'>log_dir</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_fatal'>fatal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>the generated plan has been saved</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_fatal'>fatal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>use dot -Tsvg </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dataflow_path'>dataflow_path</span><span class='embexpr_end'>}</span><span class='tstring_content'> &gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dataflow_path'>dataflow_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>.svg to convert the dataflow to SVG</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_fatal'>fatal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>use dot -Tsvg </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hierarchy_path'>hierarchy_path</span><span class='embexpr_end'>}</span><span class='tstring_content'> &gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hierarchy_path'>hierarchy_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>.svg to convert to SVG</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
                <span class='const'>Roby</span><span class='period'>.</span><span class='id identifier rubyid_log_exception_with_backtrace'>log_exception_with_backtrace</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='symbol'>:fatal</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_on_error'>on_error</span> <span class='op'>==</span> <span class='symbol'>:commit</span>
            <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_commit_transaction'>commit_transaction</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_discard_transaction'>discard_transaction</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pretty_print-instance_method">
  
    #<strong>pretty_print</strong>(pp)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 741</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pretty_print'>pretty_print</span><span class='lparen'>(</span><span class='id identifier rubyid_pp'>pp</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>    <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-- Tasks</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_nest'>nest</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_breakable'>breakable</span>
        <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_each_task'>each_task</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_task'>task</span><span class='op'>|</span>
            <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_task'>task</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_nest'>nest</span><span class='lparen'>(</span><span class='int'>4</span><span class='rparen'>)</span> <span class='kw'>do</span>
                <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_breakable'>breakable</span>
                <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_seplist'>seplist</span><span class='lparen'>(</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
                    <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='kw'>end</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_breakable'>breakable</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_breakable'>breakable</span>
    <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-- Connections</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_nest'>nest</span><span class='lparen'>(</span><span class='int'>4</span><span class='rparen'>)</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_breakable'>breakable</span>
        <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_task_relation_graph_for'>task_relation_graph_for</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html#Flows-constant" title="Syskit::Flows (constant)">Flows</a></span></span><span class='op'>::</span><span class='const'>DataFlow</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each_edge'>each_edge</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span><span class='comma'>,</span> <span class='id identifier rubyid_info'>info</span><span class='op'>|</span>
            <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from'>from</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_breakable'>breakable</span>
            <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  =&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to'>to</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_info'>info</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_pp'>pp</span><span class='period'>.</span><span class='id identifier rubyid_breakable'>breakable</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reconfigure_tasks_on_static_port_modification-instance_method">
  
    #<strong>reconfigure_tasks_on_static_port_modification</strong>(deployed_tasks)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>After the deployment phase, we check whether some static ports are modified
and cause their task to be reconfigured.</p>

<p>Note that tasks that are already reconfigured because of
<span class='object_link'><a href="#adapt_existing_deployment-instance_method" title="Syskit::NetworkGeneration::Engine#adapt_existing_deployment (method)">#adapt_existing_deployment</a></span> will be fine as the task is not configured yet</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 396</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reconfigure_tasks_on_static_port_modification'>reconfigure_tasks_on_static_port_modification</span><span class='lparen'>(</span><span class='id identifier rubyid_deployed_tasks'>deployed_tasks</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_final_deployed_tasks'>final_deployed_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_deployed_tasks'>deployed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>

    <span class='comment'># We filter against &#39;deployed_tasks&#39; to always select the tasks
</span>    <span class='comment'># that have been selected in this deployment. It does mean that
</span>    <span class='comment'># the task is always the &#39;current&#39; one, that is we would pick
</span>    <span class='comment'># the new deployment task and ignore the one that is being
</span>    <span class='comment'># replaced
</span>    <span class='id identifier rubyid_already_setup_tasks'>already_setup_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_work_plan'>work_plan</span><span class='period'>.</span><span class='id identifier rubyid_find_tasks'>find_tasks</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">TaskContext</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_not_finished'>not_finished</span><span class='period'>.</span><span class='id identifier rubyid_not_finishing'>not_finishing</span><span class='period'>.</span>
        <span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_deployed_tasks'>deployed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_setting_up?'>setting_up?</span> <span class='op'>||</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_setup?'>setup?</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

    <span class='id identifier rubyid_already_setup_tasks'>already_setup_tasks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_transaction_modifies_static_ports?'>transaction_modifies_static_ports?</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='embexpr_end'>}</span><span class='tstring_content'> was selected as deployment, but it would require modifications on static ports, spawning a new deployment</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>

            <span class='id identifier rubyid_new_task'>new_task</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_execution_agent'>execution_agent</span><span class='period'>.</span><span class='id identifier rubyid_task'>task</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_concrete_model'>concrete_model</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_merge_solver'>merge_solver</span><span class='period'>.</span><span class='id identifier rubyid_apply_merge_group'>apply_merge_group</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_task'>new_task</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_new_task'>new_task</span><span class='period'>.</span><span class='id identifier rubyid_should_configure_after'>should_configure_after</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_stop_event'>stop_event</span>
            <span class='id identifier rubyid_final_deployed_tasks'>final_deployed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_final_deployed_tasks'>final_deployed_tasks</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_new_task'>new_task</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_final_deployed_tasks'>final_deployed_tasks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resolve-instance_method">
  
    #<strong>resolve</strong>(requirement_tasks: Engine.discover_requirement_tasks_from_plan(real_plan), on_error: self.class.on_error, compute_deployments: true, compute_policies: true, garbage_collect: true, validate_abstract_network: true, validate_generated_network: true, validate_deployed_network: true, validate_final_network: true)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate the deployment according to the current requirements, and merges
it into the current plan</p>

<p>The following options are understood:</p>
<dl class="rdoc-list note-list"><dt>compute_policies
<dd>
<p>if false, it will not compute the policies between ports. Mainly useful for
offline testing</p>
</dd><dt>compute_deployments
<dd>
<p>if false, it will not do the deployment allocation. Mainly useful for
testing/debugging purposes. It obviously turns off the policy computation
as well.</p>
</dd><dt>garbage_collect
<dd>
<p>if false, it will not clean up the plan from all tasks that are not useful.
Mainly useful for testing/debugging purposes</p>
</dd><dt>on_error
<dd>
<p>by default, #resolve will generate a dot file containing the current plan
state if an error occurs. This corresponds to a :save value for this
option. It can also be set to :commit, in which case the current state of
the transaction is committed to the plan, allowing to display it anyway
(for debugging of models for instance). Set it to false to do no special
action (i.e. drop the currently generated plan)</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 598</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resolve'>resolve</span><span class='lparen'>(</span><span class='label'>requirement_tasks:</span> <span class='const'><span class='object_link'><a href="" title="Syskit::NetworkGeneration::Engine (class)">Engine</a></span></span><span class='period'>.</span><span class='id identifier rubyid_discover_requirement_tasks_from_plan'><span class='object_link'><a href="#discover_requirement_tasks_from_plan-class_method" title="Syskit::NetworkGeneration::Engine.discover_requirement_tasks_from_plan (method)">discover_requirement_tasks_from_plan</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_real_plan'>real_plan</span><span class='rparen'>)</span><span class='comma'>,</span>
            <span class='label'>on_error:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_on_error'>on_error</span><span class='comma'>,</span>
            <span class='label'>compute_deployments:</span> <span class='kw'>true</span><span class='comma'>,</span>
            <span class='label'>compute_policies:</span> <span class='kw'>true</span><span class='comma'>,</span>
            <span class='label'>garbage_collect:</span> <span class='kw'>true</span><span class='comma'>,</span>
            <span class='label'>validate_abstract_network:</span> <span class='kw'>true</span><span class='comma'>,</span>
            <span class='label'>validate_generated_network:</span> <span class='kw'>true</span><span class='comma'>,</span>
            <span class='label'>validate_deployed_network:</span> <span class='kw'>true</span><span class='comma'>,</span>
            <span class='label'>validate_final_network:</span> <span class='kw'>true</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_required_instances'>required_instances</span> <span class='op'>=</span> <span class='id identifier rubyid_resolve_system_network'>resolve_system_network</span><span class='lparen'>(</span>
        <span class='id identifier rubyid_requirement_tasks'>requirement_tasks</span><span class='comma'>,</span>
        <span class='label'>garbage_collect:</span> <span class='id identifier rubyid_garbage_collect'>garbage_collect</span><span class='comma'>,</span>
        <span class='label'>validate_abstract_network:</span> <span class='id identifier rubyid_validate_abstract_network'>validate_abstract_network</span><span class='comma'>,</span>
        <span class='label'>validate_generated_network:</span> <span class='id identifier rubyid_validate_generated_network'>validate_generated_network</span><span class='comma'>,</span>
        <span class='label'>compute_deployments:</span> <span class='id identifier rubyid_compute_deployments'>compute_deployments</span><span class='comma'>,</span>
        <span class='label'>compute_policies:</span> <span class='id identifier rubyid_compute_policies'>compute_policies</span><span class='comma'>,</span>
        <span class='label'>validate_deployed_network:</span> <span class='id identifier rubyid_validate_deployed_network'>validate_deployed_network</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_apply_system_network_to_plan'>apply_system_network_to_plan</span><span class='lparen'>(</span>
        <span class='id identifier rubyid_required_instances'>required_instances</span><span class='comma'>,</span>
        <span class='label'>compute_deployments:</span> <span class='id identifier rubyid_compute_deployments'>compute_deployments</span><span class='comma'>,</span>
        <span class='label'>garbage_collect:</span> <span class='id identifier rubyid_garbage_collect'>garbage_collect</span><span class='comma'>,</span>
        <span class='label'>validate_final_network:</span> <span class='id identifier rubyid_validate_final_network'>validate_final_network</span><span class='rparen'>)</span>

<span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_handle_resolution_exception'>handle_resolution_exception</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='label'>on_error:</span> <span class='id identifier rubyid_on_error'>on_error</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resolve_system_network-instance_method">
  
    #<strong>resolve_system_network</strong>(requirement_tasks, garbage_collect: true, validate_abstract_network: true, validate_generated_network: true, validate_deployed_network: true, compute_deployments: true, compute_policies: true)  &#x21d2; <tt>Hash&lt;<span class='object_link'><a href="../InstanceRequirementsTask.html" title="Syskit::InstanceRequirementsTask (class)">InstanceRequirementsTask</a></span>,<span class='object_link'><a href="../InstanceRequirementsTask.html" title="Syskit::InstanceRequirementsTask (class)">InstanceRequirementsTask</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Computes the system network, that is the network that fullfills a list of
requirements</p>

<p>This phase does not interact at all with <span class='object_link'><a href="#real_plan-instance_method" title="Syskit::NetworkGeneration::Engine#real_plan (method)">#real_plan</a></span>. It only computes the
canonical plan that matches the requirements.</p>

<p>Its return value can then be given to <span class='object_link'><a href="#apply_system_network_to_plan-instance_method" title="Syskit::NetworkGeneration::Engine#apply_system_network_to_plan (method)">#apply_system_network_to_plan</a></span> to
adapt the current plan to the desired state.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>requirement_tasks</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../InstanceRequirementsTask.html" title="Syskit::InstanceRequirementsTask (class)">InstanceRequirementsTask</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the tasks that represent the requirements for the generated network</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>plan</span>
      
      
        <span class='type'>(<tt>Plan</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the plan into which the network should be generated</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>garbage_collect</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>whether the plan should be cleaned of unused tasks (debugging only)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash&lt;<span class='object_link'><a href="../InstanceRequirementsTask.html" title="Syskit::InstanceRequirementsTask (class)">InstanceRequirementsTask</a></span>,<span class='object_link'><a href="../InstanceRequirementsTask.html" title="Syskit::InstanceRequirementsTask (class)">InstanceRequirementsTask</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>mapping from a requirement task given to the method to the corresponding
requirement task in the generated plan. In other words, the keys are in
<span class='object_link'><a href="#real_plan-instance_method" title="Syskit::NetworkGeneration::Engine#real_plan (method)">#real_plan</a></span> and the values in <span class='object_link'><a href="#work_plan-instance_method" title="Syskit::NetworkGeneration::Engine#work_plan (method)">#work_plan</a></span></p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 551</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resolve_system_network'>resolve_system_network</span><span class='lparen'>(</span><span class='id identifier rubyid_requirement_tasks'>requirement_tasks</span><span class='comma'>,</span>
                           <span class='label'>garbage_collect:</span> <span class='kw'>true</span><span class='comma'>,</span>
                           <span class='label'>validate_abstract_network:</span> <span class='kw'>true</span><span class='comma'>,</span>
                           <span class='label'>validate_generated_network:</span> <span class='kw'>true</span><span class='comma'>,</span>
                           <span class='label'>validate_deployed_network:</span> <span class='kw'>true</span><span class='comma'>,</span>
                           <span class='label'>compute_deployments:</span> <span class='kw'>true</span><span class='comma'>,</span>
                           <span class='label'>compute_policies:</span> <span class='kw'>true</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_required_instances'>required_instances</span> <span class='op'>=</span> <span class='id identifier rubyid_compute_system_network'>compute_system_network</span><span class='lparen'>(</span>
        <span class='id identifier rubyid_requirement_tasks'>requirement_tasks</span><span class='comma'>,</span>
        <span class='label'>garbage_collect:</span> <span class='id identifier rubyid_garbage_collect'>garbage_collect</span><span class='comma'>,</span>
        <span class='label'>validate_abstract_network:</span> <span class='id identifier rubyid_validate_abstract_network'>validate_abstract_network</span><span class='comma'>,</span>
        <span class='label'>validate_generated_network:</span> <span class='id identifier rubyid_validate_generated_network'>validate_generated_network</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_compute_deployments'>compute_deployments</span>
        <span class='id identifier rubyid_log_timepoint_group'>log_timepoint_group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>compute_deployed_network</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
            <span class='id identifier rubyid_compute_deployed_network'>compute_deployed_network</span><span class='lparen'>(</span>
                <span class='label'>compute_policies:</span> <span class='id identifier rubyid_compute_policies'>compute_policies</span><span class='comma'>,</span>
                <span class='label'>validate_deployed_network:</span> <span class='id identifier rubyid_validate_deployed_network'>validate_deployed_network</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_required_instances'>required_instances</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_dot-instance_method">
  
    #<strong>to_dot</strong>(options)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


739</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 739</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_dot'>to_dot</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='id identifier rubyid_to_dot_dataflow'>to_dot_dataflow</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_dot_dataflow-instance_method">
  
    #<strong>to_dot_dataflow</strong>(remove_compositions = false, excluded_models = Set.new, annotations = [&quot;connection_policy&quot;])  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


734
735
736
737</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 734</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_dot_dataflow'>to_dot_dataflow</span><span class='lparen'>(</span><span class='id identifier rubyid_remove_compositions'>remove_compositions</span> <span class='op'>=</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='id identifier rubyid_excluded_models'>excluded_models</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_annotations'>annotations</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>connection_policy</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_gen'>gen</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Graphviz.html" title="Syskit::Graphviz (class)">Graphviz</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Graphviz.html#initialize-instance_method" title="Syskit::Graphviz#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_work_plan'>work_plan</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_gen'>gen</span><span class='period'>.</span><span class='id identifier rubyid_dataflow'>dataflow</span><span class='lparen'>(</span><span class='id identifier rubyid_remove_compositions'>remove_compositions</span><span class='comma'>,</span> <span class='id identifier rubyid_excluded_models'>excluded_models</span><span class='comma'>,</span> <span class='id identifier rubyid_annotations'>annotations</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_svg-instance_method">
  
    #<strong>to_svg</strong>(kind, filename = nil, *additional_args)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate a svg file representing the current state of the deployment</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


730
731
732</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 730</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_svg'>to_svg</span><span class='lparen'>(</span><span class='id identifier rubyid_kind'>kind</span><span class='comma'>,</span> <span class='id identifier rubyid_filename'>filename</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_additional_args'>additional_args</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../Graphviz.html" title="Syskit::Graphviz (class)">Graphviz</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Graphviz.html#initialize-instance_method" title="Syskit::Graphviz#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_work_plan'>work_plan</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_file'><span class='object_link'><a href="../Graphviz.html#to_file-instance_method" title="Syskit::Graphviz#to_file (method)">to_file</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_kind'>kind</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>svg</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_additional_args'>additional_args</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate_final_network-instance_method">
  
    #<strong>validate_final_network</strong>(required_instances, plan, compute_deployments: true)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Validates the state of the network at the end of #resolve</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


699
700
701
702
703
704
705
706
707
708
709
710</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/network_generation/engine.rb', line 699</span>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_final_network'>validate_final_network</span><span class='lparen'>(</span><span class='id identifier rubyid_required_instances'>required_instances</span><span class='comma'>,</span> <span class='id identifier rubyid_plan'>plan</span><span class='comma'>,</span> <span class='label'>compute_deployments:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='comment'># Check that all device instances are proper tasks (not proxies)
</span>    <span class='id identifier rubyid_required_instances'>required_instances</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_req_task'>req_task</span><span class='comma'>,</span> <span class='id identifier rubyid_task'>task</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_transaction_proxy?'>transaction_proxy?</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../InternalError.html" title="Syskit::InternalError (class)">InternalError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>instance definition </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_instance'>instance</span><span class='embexpr_end'>}</span><span class='tstring_content'> contains a transaction proxy: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_task'>task</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../InternalError.html" title="Syskit::InternalError (class)">InternalError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>instance definition </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_task'>task</span><span class='embexpr_end'>}</span><span class='tstring_content'> has been removed from plan</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>super</span> <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='kw'>super</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed Apr 10 21:57:25 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.19 (ruby-2.5.1).
</div>

    </div>
  </body>
</html>