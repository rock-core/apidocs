<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Syskit::Runtime::ConnectionManagement
  
    &mdash; Documentation by YARD 0.9.19
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Syskit::Runtime::ConnectionManagement";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Runtime.html" title="Syskit::Runtime (module)">Runtime</a></span></span>
     &raquo; 
    <span class="title">ConnectionManagement</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Syskit::Runtime::ConnectionManagement
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Syskit::Runtime::ConnectionManagement</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd>Logger::Hierarchy</dd>
  </dl>
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>Logger::Hierarchy</dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/syskit/runtime/connection_management.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Connection management at runtime</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#dataflow_graph-instance_method" title="#dataflow_graph (instance method)">#<strong>dataflow_graph</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute dataflow_graph.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#plan-instance_method" title="#plan (instance method)">#<strong>plan</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute plan.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-class_method" title="update (class method)">.<strong>update</strong>(plan)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#active_task%3F-instance_method" title="#active_task? (instance method)">#<strong>active_task?</strong>(t)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply_connection_additions-instance_method" title="#apply_connection_additions (instance method)">#<strong>apply_connection_additions</strong>(new)  &#x21d2; [Syskit::TaskContext] </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Actually create new connections.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply_connection_changes-instance_method" title="#apply_connection_changes (instance method)">#<strong>apply_connection_changes</strong>(new, removed)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Apply the connection changes that can be applied.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply_connection_removal-instance_method" title="#apply_connection_removal (instance method)">#<strong>apply_connection_removal</strong>(removed)  &#x21d2; [Syskit::TaskContext] </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove port-to-port connections.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compute_connection_changes-instance_method" title="#compute_connection_changes (instance method)">#<strong>compute_connection_changes</strong>(tasks)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Computes the connection changes that are required to make the required
connections (declared in the DataFlow relation) match the actual ones (on
the underlying modules).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dangling_task_cleanup-instance_method" title="#dangling_task_cleanup (instance method)">#<strong>dangling_task_cleanup</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Compute the set of connections we should remove to account for orocos tasks
whose supporting syskit task has been removed, but are still connected.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_setup_syskit_task_context_from_orocos_task-instance_method" title="#find_setup_syskit_task_context_from_orocos_task (instance method)">#<strong>find_setup_syskit_task_context_from_orocos_task</strong>(orocos_task)  &#x21d2; nil, Syskit::TaskContext </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the Syskit::TaskContext in the plan that manages an orocos task.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(plan)  &#x21d2; ConnectionManagement </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of ConnectionManagement.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#log_timepoint_group-instance_method" title="#log_timepoint_group (instance method)">#<strong>log_timepoint_group</strong>(name, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mark_connected_pending_tasks_as_executable-instance_method" title="#mark_connected_pending_tasks_as_executable (instance method)">#<strong>mark_connected_pending_tasks_as_executable</strong>(pending_tasks)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_connections_partition_held_ready-instance_method" title="#new_connections_partition_held_ready (instance method)">#<strong>new_connections_partition_held_ready</strong>(new)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Partition new connections between.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#partition_early_late-instance_method" title="#partition_early_late (instance method)">#<strong>partition_early_late</strong>(connections, kind, to_syskit_task)  &#x21d2; Array, Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Partition a set of connections between the ones that can be performed right
now, and those that must wait for the involved tasks&#39; state to change.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#perform_connections-instance_method" title="#perform_connections (instance method)">#<strong>perform_connections</strong>(connections)  &#x21d2; (Array,Array) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Actually perform the connections.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#perform_disconnections-instance_method" title="#perform_disconnections (instance method)">#<strong>perform_disconnections</strong>(disconnections)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post_connect_failure-instance_method" title="#post_connect_failure (instance method)">#<strong>post_connect_failure</strong>(connections)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post_connect_success-instance_method" title="#post_connect_success (instance method)">#<strong>post_connect_success</strong>(connections)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post_disconnect_failure-instance_method" title="#post_disconnect_failure (instance method)">#<strong>post_disconnect_failure</strong>(disconnections)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post_disconnect_success-instance_method" title="#post_disconnect_success (instance method)">#<strong>post_disconnect_success</strong>(disconnections)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pre_connect-instance_method" title="#pre_connect (instance method)">#<strong>pre_connect</strong>(new)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pre_disconnect-instance_method" title="#pre_disconnect (instance method)">#<strong>pre_disconnect</strong>(removed)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#removed_connections_require_network_update%3F-instance_method" title="#removed_connections_require_network_update? (instance method)">#<strong>removed_connections_require_network_update?</strong>(connections)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks whether the removal of some connections require to run the Syskit
deployer right away.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#scheduler-instance_method" title="#scheduler (instance method)">#<strong>scheduler</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_required_dataflow_graph-instance_method" title="#update_required_dataflow_graph (instance method)">#<strong>update_required_dataflow_graph</strong>(tasks)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates an intermediate graph (Syskit::RequiredDataFlow) where we store the
concrete connections.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(plan)  &#x21d2; <tt><span class='object_link'><a href="" title="Syskit::Runtime::ConnectionManagement (class)">ConnectionManagement</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of ConnectionManagement</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22
23
24
25
26
27
28
29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_plan'>plan</span><span class='rparen'>)</span>
    <span class='ivar'>@plan</span> <span class='op'>=</span> <span class='id identifier rubyid_plan'>plan</span>
    <span class='ivar'>@dataflow_graph</span> <span class='op'>=</span> <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_task_relation_graph_for'>task_relation_graph_for</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html#Flows-constant" title="Syskit::Flows (constant)">Flows</a></span></span><span class='op'>::</span><span class='const'>DataFlow</span><span class='rparen'>)</span>
    <span class='ivar'>@orocos_task_to_syskit_tasks</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@orocos_task_to_setup_syskit_task</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_find_tasks'>find_tasks</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">TaskContext</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='lparen'>(</span><span class='ivar'>@orocos_task_to_syskit_tasks</span><span class='lbracket'>[</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_t'>t</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_setup?'>setup?</span>
            <span class='ivar'>@orocos_task_to_setup_syskit_task</span><span class='lbracket'>[</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="dataflow_graph-instance_method">
  
    #<strong>dataflow_graph</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute dataflow_graph</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 10</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span>
  <span class='ivar'>@dataflow_graph</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="plan-instance_method">
  
    #<strong>plan</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute plan</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 8</span>

<span class='kw'>def</span> <span class='id identifier rubyid_plan'>plan</span>
  <span class='ivar'>@plan</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="update-class_method">
  
    .<strong>update</strong>(plan)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35
36</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 33</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_plan'>plan</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_manager'>manager</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Syskit::Runtime::ConnectionManagement (class)">ConnectionManagement</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Syskit::Runtime::ConnectionManagement#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_plan'>plan</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_manager'>manager</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="active_task?-instance_method">
  
    #<strong>active_task?</strong>(t)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


627
628
629
630</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 627</span>

<span class='kw'>def</span> <span class='id identifier rubyid_active_task?'>active_task?</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_finished?'>finished?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_execution_agent'>execution_agent</span> <span class='op'>&amp;&amp;</span>
        <span class='op'>!</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_execution_agent'>execution_agent</span><span class='period'>.</span><span class='id identifier rubyid_finished?'>finished?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_execution_agent'>execution_agent</span><span class='period'>.</span><span class='id identifier rubyid_ready_to_die?'>ready_to_die?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="apply_connection_additions-instance_method">
  
    #<strong>apply_connection_additions</strong>(new)  &#x21d2; <tt>[<span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">Syskit::TaskContext</a></span>]</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Actually create new connections</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>removed</span>
      
      
        <span class='type'>(<tt>{(<span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">Syskit::TaskContext</a></span>,<span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">Syskit::TaskContext</a></span>) =&gt; {[String,String] =&gt; Hash}}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the connections, specified between the Syskit tasks</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>[<span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">Syskit::TaskContext</a></span>]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the list of tasks whose connections have been modified</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


334
335
336
337
338
339
340
341</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 334</span>

<span class='kw'>def</span> <span class='id identifier rubyid_apply_connection_additions'>apply_connection_additions</span><span class='lparen'>(</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_actual_connections'>actual_connections</span> <span class='op'>=</span> <span class='id identifier rubyid_pre_connect'>pre_connect</span><span class='lparen'>(</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_performed_connections'>performed_connections</span><span class='comma'>,</span> <span class='id identifier rubyid_failed_connections'>failed_connections</span> <span class='op'>=</span> <span class='id identifier rubyid_perform_connections'>perform_connections</span><span class='lparen'>(</span><span class='id identifier rubyid_actual_connections'>actual_connections</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_post_connect_success'>post_connect_success</span><span class='lparen'>(</span><span class='id identifier rubyid_performed_connections'>performed_connections</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_post_connect_failure'>post_connect_failure</span><span class='lparen'>(</span><span class='id identifier rubyid_failed_connections'>failed_connections</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_mappings'>mappings</span><span class='op'>|</span> <span class='id identifier rubyid_to_task'>to_task</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_executable?'>executable?</span> <span class='rbrace'>}</span><span class='period'>.</span>
        <span class='id identifier rubyid_compact'>compact</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="apply_connection_changes-instance_method">
  
    #<strong>apply_connection_changes</strong>(new, removed)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Apply the connection changes that can be applied</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 567</span>

<span class='kw'>def</span> <span class='id identifier rubyid_apply_connection_changes'>apply_connection_changes</span><span class='lparen'>(</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_removed'>removed</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_additions_held'>additions_held</span><span class='comma'>,</span> <span class='id identifier rubyid_additions_ready'>additions_ready</span> <span class='op'>=</span> <span class='id identifier rubyid_new_connections_partition_held_ready'>new_connections_partition_held_ready</span><span class='lparen'>(</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_early_removal'>early_removal</span><span class='comma'>,</span> <span class='id identifier rubyid_late_removal'>late_removal</span>     <span class='op'>=</span>
        <span class='id identifier rubyid_partition_early_late'>partition_early_late</span><span class='lparen'>(</span><span class='id identifier rubyid_removed'>removed</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>removed</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:find_setup_syskit_task_context_from_orocos_task</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_early_additions'>early_additions</span><span class='comma'>,</span> <span class='id identifier rubyid_late_additions'>late_additions</span> <span class='op'>=</span>
        <span class='id identifier rubyid_partition_early_late'>partition_early_late</span><span class='lparen'>(</span><span class='id identifier rubyid_additions_ready'>additions_ready</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>added</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_proc'>proc</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span> <span class='rbrace'>}</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_modified_tasks'>modified_tasks</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_log_timepoint_group'>log_timepoint_group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>early_disconnections</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
        <span class='id identifier rubyid_modified_tasks'>modified_tasks</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_apply_connection_removal'>apply_connection_removal</span><span class='lparen'>(</span><span class='id identifier rubyid_early_removal'>early_removal</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_log_timepoint_group'>log_timepoint_group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>early_connections</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
        <span class='id identifier rubyid_modified_tasks'>modified_tasks</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_apply_connection_additions'>apply_connection_additions</span><span class='lparen'>(</span><span class='id identifier rubyid_early_additions'>early_additions</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_additions_held'>additions_held</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_mark_connected_pending_tasks_as_executable'>mark_connected_pending_tasks_as_executable</span><span class='lparen'>(</span><span class='id identifier rubyid_modified_tasks'>modified_tasks</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_additions'>additions</span> <span class='op'>=</span> <span class='id identifier rubyid_additions_held'>additions_held</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_late_additions'>late_additions</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_mappings1'>mappings1</span><span class='comma'>,</span> <span class='id identifier rubyid_mappings2'>mappings2</span><span class='op'>|</span> <span class='id identifier rubyid_mappings1'>mappings1</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_mappings2'>mappings2</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_additions'>additions</span><span class='comma'>,</span> <span class='id identifier rubyid_late_removal'>late_removal</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_log_timepoint_group'>log_timepoint_group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>late_disconnections</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
        <span class='id identifier rubyid_modified_tasks'>modified_tasks</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_apply_connection_removal'>apply_connection_removal</span><span class='lparen'>(</span><span class='id identifier rubyid_late_removal'>late_removal</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_log_timepoint_group'>log_timepoint_group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>late_connections</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
        <span class='id identifier rubyid_modified_tasks'>modified_tasks</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_apply_connection_additions'>apply_connection_additions</span><span class='lparen'>(</span><span class='id identifier rubyid_late_additions'>late_additions</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_mark_connected_pending_tasks_as_executable'>mark_connected_pending_tasks_as_executable</span><span class='lparen'>(</span><span class='id identifier rubyid_modified_tasks'>modified_tasks</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="apply_connection_removal-instance_method">
  
    #<strong>apply_connection_removal</strong>(removed)  &#x21d2; <tt>[<span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">Syskit::TaskContext</a></span>]</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove port-to-port connections</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>removed</span>
      
      
        <span class='type'>(<tt>{(Orocos::TaskContext,Orocos::TaskContext) =&gt; [[String,String]]}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the connections, specified between the actual tasks (NOT their Roby
representations)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>[<span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">Syskit::TaskContext</a></span>]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the list of tasks whose connections have been modified</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


322
323
324
325
326
327</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 322</span>

<span class='kw'>def</span> <span class='id identifier rubyid_apply_connection_removal'>apply_connection_removal</span><span class='lparen'>(</span><span class='id identifier rubyid_removed'>removed</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_disconnections'>disconnections</span> <span class='op'>=</span> <span class='id identifier rubyid_pre_disconnect'>pre_disconnect</span><span class='lparen'>(</span><span class='id identifier rubyid_removed'>removed</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='id identifier rubyid_failure'>failure</span> <span class='op'>=</span> <span class='id identifier rubyid_perform_disconnections'>perform_disconnections</span><span class='lparen'>(</span><span class='id identifier rubyid_disconnections'>disconnections</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_spurious_failures'>spurious_failures</span> <span class='op'>=</span> <span class='id identifier rubyid_post_disconnect_failure'>post_disconnect_failure</span><span class='lparen'>(</span><span class='id identifier rubyid_failure'>failure</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_post_disconnect_success'>post_disconnect_success</span><span class='lparen'>(</span><span class='id identifier rubyid_success'>success</span> <span class='op'>+</span> <span class='id identifier rubyid_spurious_failures'>spurious_failures</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compute_connection_changes-instance_method">
  
    #<strong>compute_connection_changes</strong>(tasks)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Computes the connection changes that are required to make the required
connections (declared in the DataFlow relation) match the actual ones (on
the underlying modules)</p>

<p>It returns nil if the change can&#39;t be computed because the Roby tasks
are not tied to an underlying RTT task context.</p>

<p>Returns [new, removed] where</p>

<pre class="code ruby"><code class="ruby">new = { [from_task, to_task] =&gt; { [from_port, to_port] =&gt; policy, ... }, ... }
</code></pre>

<p>in which <code>from_task</code> and <code>to_task</code> are instances of
Syskit::TaskContext (i.e. Roby tasks), <code>from_port</code> and
<code>to_port</code> are the port names (i.e. strings) and policy the
policy hash that Orocos::OutputPort#connect_to expects.</p>

<pre class="code ruby"><code class="ruby">removed = { [from_task, to_task] =&gt; { [from_port, to_port], ... }, ... }
</code></pre>

<p>in which <code>from_task</code> and <code>to_task</code> are instances of
Orocos::TaskContext (i.e. the underlying RTT tasks). <code>from_port</code>
and <code>to_port</code> are the names of the ports that have to be
disconnected (i.e. strings)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 90</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compute_connection_changes'>compute_connection_changes</span><span class='lparen'>(</span><span class='id identifier rubyid_tasks'>tasks</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_not_running'>not_running</span> <span class='op'>=</span> <span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='op'>!</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span> <span class='rbrace'>}</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_not_running'>not_running</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>not computing connections because the deployment of the following tasks is not yet ready</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>end</span>
            <span class='kw'>break</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_update_required_dataflow_graph'>update_required_dataflow_graph</span><span class='lparen'>(</span><span class='id identifier rubyid_tasks'>tasks</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_edges'>new_edges</span><span class='comma'>,</span> <span class='id identifier rubyid_removed_edges'>removed_edges</span><span class='comma'>,</span> <span class='id identifier rubyid_updated_edges'>updated_edges</span> <span class='op'>=</span>
        <span class='const'><span class='object_link'><a href="../../Syskit.html#RequiredDataFlow-constant" title="Syskit::RequiredDataFlow (constant)">RequiredDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_difference'>difference</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html#ActualDataFlow-constant" title="Syskit::ActualDataFlow (constant)">ActualDataFlow</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_tasks'>tasks</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='symbol'>:orocos_task</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_new'>new</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_new_edges'>new_edges</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='op'>|</span>
        <span class='id identifier rubyid_new'>new</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Syskit.html#RequiredDataFlow-constant" title="Syskit::RequiredDataFlow (constant)">RequiredDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_edge_info'>edge_info</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_removed'>removed</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_removed_edges'>removed_edges</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='op'>|</span>
        <span class='id identifier rubyid_removed'>removed</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Syskit.html#ActualDataFlow-constant" title="Syskit::ActualDataFlow (constant)">ActualDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_edge_info'>edge_info</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span>
    <span class='kw'>end</span>

    <span class='comment'># We have to work on +updated+. The graphs are between tasks,
</span>    <span class='comment'># not between ports because of how ports are handled on both the
</span>    <span class='comment'># orocos.rb and Roby sides. So we must convert the updated
</span>    <span class='comment'># mappings into add/remove pairs. Moreover, to update a
</span>    <span class='comment'># connection policy we need to disconnect and reconnect anyway.
</span>    <span class='comment'>#
</span>    <span class='comment'># Note that it is fine from a performance point of view, as in
</span>    <span class='comment'># most cases one removes all connections from two components to
</span>    <span class='comment'># recreate other ones between other components
</span>    <span class='id identifier rubyid_updated_edges'>updated_edges</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='op'>|</span>
        <span class='id identifier rubyid_new_mapping'>new_mapping</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Syskit.html#RequiredDataFlow-constant" title="Syskit::RequiredDataFlow (constant)">RequiredDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_edge_info'>edge_info</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_old_mapping'>old_mapping</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Syskit.html#ActualDataFlow-constant" title="Syskit::ActualDataFlow (constant)">ActualDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_edge_info'>edge_info</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_new_connections'>new_connections</span>     <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
        <span class='id identifier rubyid_removed_connections'>removed_connections</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
        <span class='id identifier rubyid_new_mapping'>new_mapping</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ports'>ports</span><span class='comma'>,</span> <span class='id identifier rubyid_new_policy'>new_policy</span><span class='op'>|</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_old_policy'>old_policy</span> <span class='op'>=</span> <span class='id identifier rubyid_old_mapping'>old_mapping</span><span class='lbracket'>[</span><span class='id identifier rubyid_ports'>ports</span><span class='rbracket'>]</span>
                <span class='kw'>if</span> <span class='id identifier rubyid_old_policy'>old_policy</span> <span class='op'>!=</span> <span class='id identifier rubyid_new_policy'>new_policy</span>
                    <span class='id identifier rubyid_new_connections'>new_connections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ports'>ports</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_new_policy'>new_policy</span>
                    <span class='id identifier rubyid_removed_connections'>removed_connections</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ports'>ports</span>
                <span class='kw'>end</span>
            <span class='kw'>else</span>
                <span class='id identifier rubyid_new_connections'>new_connections</span><span class='lbracket'>[</span><span class='id identifier rubyid_ports'>ports</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_new_policy'>new_policy</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_old_mapping'>old_mapping</span><span class='period'>.</span><span class='id identifier rubyid_each_key'>each_key</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ports'>ports</span><span class='op'>|</span>
            <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_new_mapping'>new_mapping</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_ports'>ports</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_removed_connections'>removed_connections</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ports'>ports</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_new_connections'>new_connections</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_new'>new</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_new_connections'>new_connections</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_removed_connections'>removed_connections</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_removed'>removed</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_source_task'>source_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_removed_connections'>removed_connections</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_removed'>removed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="dangling_task_cleanup-instance_method">
  
    #<strong>dangling_task_cleanup</strong>  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Compute the set of connections we should remove to account for orocos tasks
whose supporting syskit task has been removed, but are still connected</p>

<p>The result is formatted as the rest of the connection hashes, that is keys
are (source_task, sink_task) and values are Array&lt;(source_port,
task_port)&gt;. Note that source_task and sink_task are
Orocos::TaskContext, and it is guaranteed that one of them has no
equivalent in the Syskit graphs (meaning that no keys in the return value
can be found in the return value of <span class='object_link'><a href="#compute_connection_changes-instance_method" title="Syskit::Runtime::ConnectionManagement#compute_connection_changes (method)">#compute_connection_changes</a></span>)</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


614
615
616
617
618
619
620
621
622
623
624
625</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 614</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dangling_task_cleanup'>dangling_task_cleanup</span>
    <span class='id identifier rubyid_removed'>removed</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='const'><span class='object_link'><a href="../../Syskit.html#ActualDataFlow-constant" title="Syskit::ActualDataFlow (constant)">ActualDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each_vertex'>each_vertex</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_parent_t'>parent_t</span><span class='op'>|</span>
        <span class='kw'>unless</span> <span class='ivar'>@orocos_task_to_syskit_tasks</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_parent_t'>parent_t</span><span class='rparen'>)</span>
            <span class='const'><span class='object_link'><a href="../../Syskit.html#ActualDataFlow-constant" title="Syskit::ActualDataFlow (constant)">ActualDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each_out_neighbour'>each_out_neighbour</span><span class='lparen'>(</span><span class='id identifier rubyid_parent_t'>parent_t</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_child_t'>child_t</span><span class='op'>|</span>
                <span class='id identifier rubyid_mappings'>mappings</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Syskit.html#ActualDataFlow-constant" title="Syskit::ActualDataFlow (constant)">ActualDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_edge_info'>edge_info</span><span class='lparen'>(</span><span class='id identifier rubyid_parent_t'>parent_t</span><span class='comma'>,</span> <span class='id identifier rubyid_child_t'>child_t</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_removed'>removed</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_parent_t'>parent_t</span><span class='comma'>,</span> <span class='id identifier rubyid_child_t'>child_t</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_mappings'>mappings</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_removed'>removed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_setup_syskit_task_context_from_orocos_task-instance_method">
  
    #<strong>find_setup_syskit_task_context_from_orocos_task</strong>(orocos_task)  &#x21d2; <tt>nil</tt>, <tt><span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">Syskit::TaskContext</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the Syskit::TaskContext in the plan that manages an orocos task</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>, <tt><span class='object_link'><a href="../TaskContext.html" title="Syskit::TaskContext (class)">Syskit::TaskContext</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


162
163
164</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 162</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_setup_syskit_task_context_from_orocos_task'>find_setup_syskit_task_context_from_orocos_task</span><span class='lparen'>(</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='rparen'>)</span>
    <span class='ivar'>@orocos_task_to_setup_syskit_task</span><span class='lbracket'>[</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="log_timepoint_group-instance_method">
  
    #<strong>log_timepoint_group</strong>(name, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


16
17
18</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 16</span>

<span class='kw'>def</span> <span class='id identifier rubyid_log_timepoint_group'>log_timepoint_group</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_execution_engine'>execution_engine</span><span class='period'>.</span><span class='id identifier rubyid_log_timepoint_group'>log_timepoint_group</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mark_connected_pending_tasks_as_executable-instance_method">
  
    #<strong>mark_connected_pending_tasks_as_executable</strong>(pending_tasks)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 455</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mark_connected_pending_tasks_as_executable'>mark_connected_pending_tasks_as_executable</span><span class='lparen'>(</span><span class='id identifier rubyid_pending_tasks'>pending_tasks</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_pending_tasks'>pending_tasks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_setup?'>setup?</span>
            <span class='id identifier rubyid_scheduler'>scheduler</span><span class='period'>.</span><span class='id identifier rubyid_report_holdoff'>report_holdoff</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>not yet configured</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span>
        <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_start_only_when_connected?'>start_only_when_connected?</span>
            <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_ready_to_start!'>ready_to_start!</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_all_inputs_connected?'>all_inputs_connected?</span>
            <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_ready_to_start!'>ready_to_start!</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='embexpr_end'>}</span><span class='tstring_content'> has all its inputs connected, set executable </span><span class='tstring_end'>&quot;</span></span>\
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to nil and executable? = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_executable?'>executable?</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_scheduler'>scheduler</span><span class='period'>.</span><span class='id identifier rubyid_report_action'>report_action</span><span class='lparen'>(</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>all inputs connected, marking as ready to start</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_scheduler'>scheduler</span><span class='period'>.</span><span class='id identifier rubyid_report_holdoff'>report_holdoff</span><span class='lparen'>(</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>waiting for all inputs to be connected</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_connections_partition_held_ready-instance_method">
  
    #<strong>new_connections_partition_held_ready</strong>(new)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Partition new connections between</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 516</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new_connections_partition_held_ready'>new_connections_partition_held_ready</span><span class='lparen'>(</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_additions_held'>additions_held</span><span class='comma'>,</span> <span class='id identifier rubyid_additions_ready'>additions_ready</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_mappings'>mappings</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_execution_agent'>execution_agent</span><span class='period'>.</span><span class='id identifier rubyid_ready?'>ready?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_execution_agent'>execution_agent</span><span class='period'>.</span><span class='id identifier rubyid_ready?'>ready?</span>
            <span class='id identifier rubyid_hold'>hold</span><span class='comma'>,</span> <span class='id identifier rubyid_ready'>ready</span> <span class='op'>=</span> <span class='id identifier rubyid_mappings'>mappings</span><span class='comma'>,</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_setup?'>setup?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_setup?'>setup?</span>
            <span class='id identifier rubyid_hold'>hold</span><span class='comma'>,</span> <span class='id identifier rubyid_ready'>ready</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_mappings'>mappings</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_hold'>hold</span><span class='comma'>,</span> <span class='id identifier rubyid_ready'>ready</span> <span class='op'>=</span> <span class='id identifier rubyid_mappings'>mappings</span><span class='period'>.</span><span class='id identifier rubyid_partition'>partition</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='op'>|</span>
                <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_setup?'>setup?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_concrete_model'>concrete_model</span><span class='period'>.</span><span class='id identifier rubyid_find_output_port'>find_output_port</span><span class='lparen'>(</span><span class='id identifier rubyid_from_port'>from_port</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>||</span>
                    <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_setup?'>setup?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_concrete_model'>concrete_model</span><span class='period'>.</span><span class='id identifier rubyid_find_input_port'>find_input_port</span><span class='lparen'>(</span><span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_hold'>hold</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>holding </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hold'>hold</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> connections from </span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_log_pp'>log_pp</span> <span class='symbol'>:debug</span><span class='comma'>,</span> <span class='id identifier rubyid_from_task'>from_task</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  setup?: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_setup?'>setup?</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_log_pp'>log_pp</span> <span class='symbol'>:debug</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  setup?: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_setup?'>setup?</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

                <span class='id identifier rubyid_hold'>hold</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='op'>|</span>
                    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_port'>from_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_port'>to_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_policy'>policy</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
                    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_setup?'>setup?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_concrete_model'>concrete_model</span><span class='period'>.</span><span class='id identifier rubyid_find_output_port'>find_output_port</span><span class='lparen'>(</span><span class='id identifier rubyid_from_port'>from_port</span><span class='rparen'>)</span>
                        <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>    output port </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_port'>from_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> is dynamic and the task is not yet configured</span><span class='tstring_end'>&quot;</span></span>
                    <span class='kw'>end</span>
                    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_setup?'>setup?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_concrete_model'>concrete_model</span><span class='period'>.</span><span class='id identifier rubyid_find_input_port'>find_input_port</span><span class='lparen'>(</span><span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span>
                        <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>    input port </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_port'>to_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> is dynamic and the task is not yet configured</span><span class='tstring_end'>&quot;</span></span>
                    <span class='kw'>end</span>
                <span class='kw'>end</span>
                <span class='kw'>break</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_additions_held'>additions_held</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_hold'>hold</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_ready'>ready</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ready on </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_task'>from_task</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_task'>to_task</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_ready'>ready</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='op'>|</span>
                    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_port'>from_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_port'>to_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_policy'>policy</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
                <span class='kw'>end</span>
                <span class='kw'>break</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_additions_ready'>additions_ready</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_ready'>ready</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_additions_held'>additions_held</span><span class='comma'>,</span> <span class='id identifier rubyid_additions_ready'>additions_ready</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="partition_early_late-instance_method">
  
    #<strong>partition_early_late</strong>(connections, kind, to_syskit_task)  &#x21d2; <tt>Array</tt>, <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Partition a set of connections between the ones that can be performed right
now, and those that must wait for the involved tasks&#39; state to change</p>

<pre class="code ruby"><code class="ruby">note that the source and sink task type are unspecified.
</code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>connections</span>
      
      
        <span class='type'></span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the connections, specified as (source_task, sink_task) =&gt; Hash[</p>

<pre class="code ruby"><code class="ruby">(source_port, sink_port) =&gt; policy,
...]
</code></pre>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>a</span>
      
      
        <span class='type'>(<tt>Hash&lt;<span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span>,Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>cache of the task states, as a mapping from a source/sink task object as
used in the connections hash to the state name</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>kind of operation that will be done. It is purely used to display debugging
information</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>an</span>
      
      
        <span class='type'>(<tt>#[]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>object that maps the objects used as tasks in connections and states to an
object that responds to #rtt_state, to evaluate the object&#39;s state.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>, <tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the set of connections that can be performed right away, and the set of
connections that require a state change in the tasks</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 498</span>

<span class='kw'>def</span> <span class='id identifier rubyid_partition_early_late'>partition_early_late</span><span class='lparen'>(</span><span class='id identifier rubyid_connections'>connections</span><span class='comma'>,</span> <span class='id identifier rubyid_kind'>kind</span><span class='comma'>,</span> <span class='id identifier rubyid_to_syskit_task'>to_syskit_task</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_early'>early</span><span class='comma'>,</span> <span class='id identifier rubyid_late'>late</span> <span class='op'>=</span> <span class='id identifier rubyid_connections'>connections</span><span class='period'>.</span><span class='id identifier rubyid_partition'>partition</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_port_pairs'>port_pairs</span><span class='op'>|</span>
        <span class='id identifier rubyid_source_is_running'>source_is_running</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_syskit_task'>syskit_task</span> <span class='op'>=</span> <span class='id identifier rubyid_to_syskit_task'>to_syskit_task</span><span class='lbracket'>[</span><span class='id identifier rubyid_source_task'>source_task</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_syskit_task'>syskit_task</span><span class='period'>.</span><span class='id identifier rubyid_running?'>running?</span>
        <span class='id identifier rubyid_sink_is_running'>sink_is_running</span>   <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_syskit_task'>syskit_task</span> <span class='op'>=</span> <span class='id identifier rubyid_to_syskit_task'>to_syskit_task</span><span class='lbracket'>[</span><span class='id identifier rubyid_sink_task'>sink_task</span><span class='rbracket'>]</span><span class='rparen'>)</span>   <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_syskit_task'>syskit_task</span><span class='period'>.</span><span class='id identifier rubyid_running?'>running?</span>
        <span class='id identifier rubyid_early'>early</span> <span class='op'>=</span> <span class='op'>!</span><span class='id identifier rubyid_source_is_running'>source_is_running</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_sink_is_running'>sink_is_running</span>

        <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_port_pairs'>port_pairs</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_early'>early</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>early</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>late</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_kind'>kind</span><span class='embexpr_end'>}</span><span class='tstring_content'> connections from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_task'>source_task</span><span class='embexpr_end'>}</span><span class='tstring_content'> to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sink_task'>sink_task</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  source running?: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_is_running'>source_is_running</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  sink   running?: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sink_is_running'>sink_is_running</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>break</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_early'>early</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_early'>early</span><span class='comma'>,</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_late'>late</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="perform_connections-instance_method">
  
    #<strong>perform_connections</strong>(connections)  &#x21d2; <tt>(Array,Array)</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Actually perform the connections</p>

<p>It logs a :syskit_connect event at the end of the connection call. It is
formatted as:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_syskit_connect'>syskit_connect</span><span class='lparen'>(</span><span class='symbol'>:success</span><span class='comma'>,</span>
  <span class='id identifier rubyid_source_task_orocos_name'>source_task_orocos_name</span><span class='comma'>,</span> <span class='id identifier rubyid_source_port_name'>source_port_name</span><span class='comma'>,</span>
  <span class='id identifier rubyid_sink_task_orocos_name'>sink_task_orocos_name</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task_name'>sink_task_name</span><span class='comma'>,</span>
  <span class='id identifier rubyid_policy'>policy</span><span class='rparen'>)</span>
</code></pre>

<p>or</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_syskit_connect'>syskit_connect</span><span class='lparen'>(</span><span class='symbol'>:failure</span><span class='comma'>,</span>
  <span class='id identifier rubyid_source_task_orocos_name'>source_task_orocos_name</span><span class='comma'>,</span> <span class='id identifier rubyid_source_port_name'>source_port_name</span><span class='comma'>,</span>
  <span class='id identifier rubyid_sink_task_orocos_name'>sink_task_orocos_name</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task_name'>sink_task_name</span><span class='comma'>,</span>
  <span class='id identifier rubyid_policy'>policy</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
</code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>connections to be created, as returned by <span class='object_link'><a href="#pre_connect-instance_method" title="Syskit::Runtime::ConnectionManagement#pre_connect (method)">#pre_connect</a></span></p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(Array,Array)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the successful and failed connections, in the same format than the
connection argument for the success array. The failure array gets in
addition the exception as last argument.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 392</span>

<span class='kw'>def</span> <span class='id identifier rubyid_perform_connections'>perform_connections</span><span class='lparen'>(</span><span class='id identifier rubyid_connections'>connections</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='id identifier rubyid_failure'>failure</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_port_cache'>port_cache</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_promises'>promises</span> <span class='op'>=</span> <span class='id identifier rubyid_connections'>connections</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='comma'>,</span> <span class='id identifier rubyid_distance'>distance</span><span class='op'>|</span>
        <span class='id identifier rubyid_execution_engine'>execution_engine</span> <span class='op'>=</span> <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_execution_engine'>execution_engine</span>
        <span class='id identifier rubyid_execution_engine'>execution_engine</span><span class='period'>.</span><span class='id identifier rubyid_promise'>promise</span><span class='lparen'>(</span><span class='label'>description:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>connect </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>#</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_port'>from_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> -&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>#</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_port'>to_port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
            <span class='kw'>begin</span>
                <span class='id identifier rubyid_from_orocos_port'>from_orocos_port</span> <span class='op'>=</span>
                    <span class='lparen'>(</span><span class='id identifier rubyid_port_cache'>port_cache</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='period'>.</span><span class='id identifier rubyid_raw_port'>raw_port</span><span class='lparen'>(</span><span class='id identifier rubyid_from_port'>from_port</span><span class='rparen'>)</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_to_orocos_port'>to_orocos_port</span>   <span class='op'>=</span>
                    <span class='lparen'>(</span><span class='id identifier rubyid_port_cache'>port_cache</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='period'>.</span><span class='id identifier rubyid_raw_port'>raw_port</span><span class='lparen'>(</span><span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_from_orocos_port'>from_orocos_port</span><span class='period'>.</span><span class='id identifier rubyid_connect_to'>connect_to</span><span class='lparen'>(</span><span class='id identifier rubyid_to_orocos_port'>to_orocos_port</span><span class='comma'>,</span> <span class='label'>distance:</span> <span class='id identifier rubyid_distance'>distance</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_policy'>policy</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_execution_engine'>execution_engine</span><span class='period'>.</span><span class='id identifier rubyid_log'>log</span><span class='lparen'>(</span><span class='symbol'>:syskit_connect</span><span class='comma'>,</span> <span class='symbol'>:success</span><span class='comma'>,</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_success'>success</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='rbracket'>]</span>
            <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
                <span class='id identifier rubyid_execution_engine'>execution_engine</span><span class='period'>.</span><span class='id identifier rubyid_log'>log</span><span class='lparen'>(</span><span class='symbol'>:syskit_connect</span><span class='comma'>,</span> <span class='symbol'>:failure</span><span class='comma'>,</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_name'>orocos_name</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_failure'>failure</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='rbracket'>]</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_log_timepoint_group'>log_timepoint_group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>apply_remote_connections</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
        <span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:execute</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='comment'># This is cheating around the &quot;do not allow blocking calls in
</span>    <span class='comment'># main thread&quot; principle. It&#39;s good because it parallelizes
</span>    <span class='comment'># connection - which speeds up network setup quite a bit - but
</span>    <span class='comment'># it&#39;s still blocking if one of the connections are blocking
</span>    <span class='comment'>#
</span>    <span class='comment'># The &quot;blocking calls should not affect Syskit&quot; tests should
</span>    <span class='comment'># catch this
</span>    <span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_promise'>promise</span><span class='period'>.</span><span class='id identifier rubyid_value!'>value!</span> <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='id identifier rubyid_failure'>failure</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="perform_disconnections-instance_method">
  
    #<strong>perform_disconnections</strong>(disconnections)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 220</span>

<span class='kw'>def</span> <span class='id identifier rubyid_perform_disconnections'>perform_disconnections</span><span class='lparen'>(</span><span class='id identifier rubyid_disconnections'>disconnections</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='id identifier rubyid_failure'>failure</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_port_cache'>port_cache</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_promises'>promises</span> <span class='op'>=</span> <span class='id identifier rubyid_disconnections'>disconnections</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_syskit_from_task'>syskit_from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_syskit_to_task'>syskit_to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='op'>|</span>
        <span class='id identifier rubyid_execution_engine'>execution_engine</span> <span class='op'>=</span> <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_execution_engine'>execution_engine</span>
        <span class='id identifier rubyid_execution_engine'>execution_engine</span><span class='period'>.</span><span class='id identifier rubyid_promise'>promise</span><span class='lparen'>(</span><span class='label'>description:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>disconnect </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>#</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_port'>from_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> -&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>#</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_port'>to_port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
            <span class='kw'>begin</span>
                <span class='id identifier rubyid_from_orocos_port'>from_orocos_port</span> <span class='op'>=</span>
                    <span class='lparen'>(</span><span class='id identifier rubyid_port_cache'>port_cache</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_raw_port'>raw_port</span><span class='lparen'>(</span><span class='id identifier rubyid_from_port'>from_port</span><span class='rparen'>)</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_to_orocos_port'>to_orocos_port</span>   <span class='op'>=</span>
                    <span class='lparen'>(</span><span class='id identifier rubyid_port_cache'>port_cache</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_raw_port'>raw_port</span><span class='lparen'>(</span><span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span><span class='rparen'>)</span>
                <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_from_orocos_port'>from_orocos_port</span><span class='period'>.</span><span class='id identifier rubyid_disconnect_from'>disconnect_from</span><span class='lparen'>(</span><span class='id identifier rubyid_to_orocos_port'>to_orocos_port</span><span class='rparen'>)</span>
                    <span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>while disconnecting </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_task'>from_task</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_port'>from_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_task'>to_task</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_port'>to_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> returned false</span><span class='tstring_end'>&quot;</span></span>
                    <span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I assume that the ports are disconnected, but this should not have happened</span><span class='tstring_end'>&quot;</span></span>
                <span class='kw'>end</span>
                <span class='id identifier rubyid_execution_engine'>execution_engine</span><span class='period'>.</span><span class='id identifier rubyid_log'>log</span><span class='lparen'>(</span><span class='symbol'>:syskit_disconnect</span><span class='comma'>,</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span>

                <span class='id identifier rubyid_success'>success</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_syskit_from_task'>syskit_from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_syskit_to_task'>syskit_to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rbracket'>]</span>
            <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
                <span class='id identifier rubyid_failure'>failure</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_syskit_from_task'>syskit_from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_syskit_to_task'>syskit_to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='rbracket'>]</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_log_timepoint_group'>log_timepoint_group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>apply_remote_disconnections</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
        <span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:execute</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='comment'># This is cheating around the &quot;do not allow blocking calls in
</span>    <span class='comment'># main thread&quot; principle. It&#39;s good because it parallelizes
</span>    <span class='comment'># disconnection - which speeds up network setup quite a bit - but
</span>    <span class='comment'># it&#39;s still blocking if one of the connections are blocking
</span>    <span class='comment'>#
</span>    <span class='comment'># The &quot;blocking calls should not affect Syskit&quot; tests should
</span>    <span class='comment'># catch this
</span>    <span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_promise'>promise</span><span class='period'>.</span><span class='id identifier rubyid_value!'>value!</span> <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='id identifier rubyid_failure'>failure</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post_connect_failure-instance_method">
  
    #<strong>post_connect_failure</strong>(connections)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


440
441
442
443
444
445
446
447
448
449
450
451
452
453</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 440</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post_connect_failure'>post_connect_failure</span><span class='lparen'>(</span><span class='id identifier rubyid_connections'>connections</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_connections'>connections</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='comma'>,</span> <span class='id identifier rubyid_error'>error</span><span class='op'>|</span>
        <span class='kw'>case</span> <span class='id identifier rubyid_error'>error</span>
        <span class='kw'>when</span> <span class='const'>Orocos</span><span class='op'>::</span><span class='const'>InterfaceObjectNotFound</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_task'>task</span> <span class='op'>==</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='id identifier rubyid_from_port'>from_port</span>
                <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_execution_engine'>execution_engine</span><span class='period'>.</span><span class='id identifier rubyid_add_error'>add_error</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../PortNotFound.html" title="Syskit::PortNotFound (class)">PortNotFound</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../PortNotFound.html#initialize-instance_method" title="Syskit::PortNotFound#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='symbol'>:output</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='kw'>else</span>
                <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_execution_engine'>execution_engine</span><span class='period'>.</span><span class='id identifier rubyid_add_error'>add_error</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../PortNotFound.html" title="Syskit::PortNotFound (class)">PortNotFound</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../PortNotFound.html#initialize-instance_method" title="Syskit::PortNotFound#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='comma'>,</span> <span class='symbol'>:input</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_execution_engine'>execution_engine</span><span class='period'>.</span><span class='id identifier rubyid_add_error'>add_error</span><span class='lparen'>(</span><span class='const'>Roby</span><span class='op'>::</span><span class='const'>CodeError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_error'>error</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post_connect_success-instance_method">
  
    #<strong>post_connect_success</strong>(connections)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


426
427
428
429
430
431
432
433
434
435
436
437
438</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 426</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post_connect_success'>post_connect_success</span><span class='lparen'>(</span><span class='id identifier rubyid_connections'>connections</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_connections'>connections</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='op'>|</span>
        <span class='id identifier rubyid_from_syskit_port'>from_syskit_port</span> <span class='op'>=</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_find_output_port'>find_output_port</span><span class='lparen'>(</span><span class='id identifier rubyid_from_port'>from_port</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_to_syskit_port'>to_syskit_port</span>   <span class='op'>=</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_find_input_port'>find_input_port</span><span class='lparen'>(</span><span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_added_output_port_connection'>added_output_port_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_from_syskit_port'>from_syskit_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_syskit_port'>to_syskit_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_added_input_port_connection'>added_input_port_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_from_syskit_port'>from_syskit_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_syskit_port'>to_syskit_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='rparen'>)</span>

        <span class='const'><span class='object_link'><a href="../../Syskit.html#ActualDataFlow-constant" title="Syskit::ActualDataFlow (constant)">ActualDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_add_connections'>add_connections</span><span class='lparen'>(</span>
            <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='comma'>,</span>
            <span class='lbracket'>[</span><span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rbracket'>]</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_policy'>policy</span><span class='comma'>,</span> <span class='id identifier rubyid_from_syskit_port'>from_syskit_port</span><span class='period'>.</span><span class='id identifier rubyid_static?'>static?</span><span class='comma'>,</span> <span class='id identifier rubyid_to_syskit_port'>to_syskit_port</span><span class='period'>.</span><span class='id identifier rubyid_static?'>static?</span><span class='rbracket'>]</span><span class='comma'>,</span>
            <span class='label'>force_update:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post_disconnect_failure-instance_method">
  
    #<strong>post_disconnect_failure</strong>(disconnections)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 296</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post_disconnect_failure'>post_disconnect_failure</span><span class='lparen'>(</span><span class='id identifier rubyid_disconnections'>disconnections</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_disconnections'>disconnections</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_syskit_from_task'>syskit_from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_syskit_to_task'>syskit_to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='comma'>,</span> <span class='id identifier rubyid_error'>error</span><span class='op'>|</span>

        <span class='kw'>case</span> <span class='id identifier rubyid_error'>error</span>
        <span class='kw'>when</span> <span class='const'>Orocos</span><span class='op'>::</span><span class='const'>ComError</span><span class='comma'>,</span> <span class='const'>Orocos</span><span class='op'>::</span><span class='const'>NotFound</span>
            <span class='id identifier rubyid_terminating_deployments'>terminating_deployments</span> <span class='op'>=</span>
                <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_find_tasks'>find_tasks</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Syskit.html" title="Syskit (module)">Syskit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Deployment.html" title="Syskit::Deployment (class)">Deployment</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_finishing'>finishing</span><span class='period'>.</span>
                <span class='id identifier rubyid_flat_map'>flat_map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_remote_task_handles'>remote_task_handles</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span> <span class='rbrace'>}</span>

            <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_terminating_deployments'>terminating_deployments</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_from_task'>from_task</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_terminating_deployments'>terminating_deployments</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_to_task'>to_task</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error while disconnecting </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_task'>from_task</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_port'>from_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_task'>to_task</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_port'>to_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I am assuming that the disconnection is actually effective, since one port does not exist anymore and/or the task cannot be contacted (i.e. assumed to be dead)</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>end</span>
            <span class='kw'>true</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_execution_engine'>execution_engine</span><span class='period'>.</span><span class='id identifier rubyid_add_framework_error'>add_framework_error</span><span class='lparen'>(</span><span class='id identifier rubyid_error'>error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>connection management</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
            <span class='kw'>false</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post_disconnect_success-instance_method">
  
    #<strong>post_disconnect_success</strong>(disconnections)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 257</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post_disconnect_success'>post_disconnect_success</span><span class='lparen'>(</span><span class='id identifier rubyid_disconnections'>disconnections</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_modified'>modified</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_disconnections'>disconnections</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_syskit_from_task'>syskit_from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_syskit_to_task'>syskit_to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_syskit_from_task'>syskit_from_task</span>
            <span class='id identifier rubyid_syskit_from_task'>syskit_from_task</span><span class='period'>.</span><span class='id identifier rubyid_removed_output_port_connection'>removed_output_port_connection</span><span class='lparen'>(</span>
                <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_syskit_to_task'>syskit_to_task</span>
            <span class='id identifier rubyid_syskit_to_task'>syskit_to_task</span><span class='period'>.</span><span class='id identifier rubyid_removed_input_port_connection'>removed_input_port_connection</span><span class='lparen'>(</span>
                <span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../Syskit.html#ActualDataFlow-constant" title="Syskit::ActualDataFlow (constant)">ActualDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_static?'>static?</span><span class='lparen'>(</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='rparen'>)</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_syskit_from_task'>syskit_from_task</span>
                <span class='id identifier rubyid_syskit_from_task'>syskit_from_task</span><span class='period'>.</span><span class='id identifier rubyid_needs_reconfiguration!'>needs_reconfiguration!</span>
            <span class='kw'>else</span>
                <span class='const'><span class='object_link'><a href="../Deployment.html" title="Syskit::Deployment (class)">Deployment</a></span></span><span class='period'>.</span><span class='id identifier rubyid_needs_reconfiguration!'><span class='object_link'><a href="../Deployment.html#needs_reconfiguration!-class_method" title="Syskit::Deployment.needs_reconfiguration! (method)">needs_reconfiguration!</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_plan'>plan</span><span class='comma'>,</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../Syskit.html#ActualDataFlow-constant" title="Syskit::ActualDataFlow (constant)">ActualDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_static?'>static?</span><span class='lparen'>(</span><span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_syskit_to_task'>syskit_to_task</span>
                <span class='id identifier rubyid_syskit_to_task'>syskit_to_task</span><span class='period'>.</span><span class='id identifier rubyid_needs_reconfiguration!'>needs_reconfiguration!</span>
            <span class='kw'>else</span>
                <span class='const'><span class='object_link'><a href="../Deployment.html" title="Syskit::Deployment (class)">Deployment</a></span></span><span class='period'>.</span><span class='id identifier rubyid_needs_reconfiguration!'><span class='object_link'><a href="../Deployment.html#needs_reconfiguration!-class_method" title="Syskit::Deployment.needs_reconfiguration! (method)">needs_reconfiguration!</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_plan'>plan</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='const'><span class='object_link'><a href="../../Syskit.html#ActualDataFlow-constant" title="Syskit::ActualDataFlow (constant)">ActualDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_remove_connections'>remove_connections</span><span class='lparen'>(</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span>
                                          <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rparen'>)</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_syskit_from_task'>syskit_from_task</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_syskit_from_task'>syskit_from_task</span><span class='period'>.</span><span class='id identifier rubyid_executable?'>executable?</span>
            <span class='id identifier rubyid_modified'>modified</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_syskit_from_task'>syskit_from_task</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_syskit_to_task'>syskit_to_task</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_syskit_to_task'>syskit_to_task</span><span class='period'>.</span><span class='id identifier rubyid_executable?'>executable?</span>
            <span class='id identifier rubyid_modified'>modified</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_syskit_to_task'>syskit_to_task</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_modified'>modified</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pre_connect-instance_method">
  
    #<strong>pre_connect</strong>(new)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 343</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pre_connect'>pre_connect</span><span class='lparen'>(</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
    <span class='comment'># And create the new ones
</span>    <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_mappings'>mappings</span><span class='op'>|</span>
        <span class='id identifier rubyid_mappings'>mappings</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='op'>|</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>connecting </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_task'>from_task</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_port'>from_port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>     =&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_task'>to_task</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_port'>to_port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>     with policy </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_policy'>policy</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='kw'>break</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_policy'>policy</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='const'>Kernel</span><span class='period'>.</span><span class='id identifier rubyid_filter_options'>filter_options</span><span class='lparen'>(</span><span class='id identifier rubyid_policy'>policy</span><span class='comma'>,</span> <span class='const'>Orocos</span><span class='op'>::</span><span class='const'>Port</span><span class='op'>::</span><span class='const'>CONNECTION_POLICY_OPTIONS</span><span class='rparen'>)</span>

            <span class='id identifier rubyid_from_syskit_port'>from_syskit_port</span> <span class='op'>=</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_find_output_port'>find_output_port</span><span class='lparen'>(</span><span class='id identifier rubyid_from_port'>from_port</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_to_syskit_port'>to_syskit_port</span>   <span class='op'>=</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_find_input_port'>find_input_port</span><span class='lparen'>(</span><span class='id identifier rubyid_to_port'>to_port</span><span class='rparen'>)</span>

            <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_adding_output_port_connection'>adding_output_port_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_from_syskit_port'>from_syskit_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_syskit_port'>to_syskit_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_to_task'>to_task</span><span class='period'>.</span><span class='id identifier rubyid_adding_input_port_connection'>adding_input_port_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_from_syskit_port'>from_syskit_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_syskit_port'>to_syskit_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='rparen'>)</span>

            <span class='id identifier rubyid_distance'>distance</span> <span class='op'>=</span> <span class='id identifier rubyid_from_task'>from_task</span><span class='period'>.</span><span class='id identifier rubyid_distance_to'>distance_to</span><span class='lparen'>(</span><span class='id identifier rubyid_to_task'>to_task</span><span class='rparen'>)</span>

            <span class='lbracket'>[</span><span class='id identifier rubyid_from_task'>from_task</span><span class='comma'>,</span> <span class='id identifier rubyid_from_port'>from_port</span><span class='comma'>,</span> <span class='id identifier rubyid_to_task'>to_task</span><span class='comma'>,</span> <span class='id identifier rubyid_to_port'>to_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='comma'>,</span> <span class='id identifier rubyid_distance'>distance</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pre_disconnect-instance_method">
  
    #<strong>pre_disconnect</strong>(removed)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 199</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pre_disconnect'>pre_disconnect</span><span class='lparen'>(</span><span class='id identifier rubyid_removed'>removed</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_removed'>removed</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_mappings'>mappings</span><span class='op'>|</span>
        <span class='id identifier rubyid_mappings'>mappings</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_source_port'>source_port</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_port'>sink_port</span><span class='op'>|</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>disconnecting </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_task'>source_task</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_port'>source_port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>     =&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sink_task'>sink_task</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sink_port'>sink_port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='kw'>break</span>
            <span class='kw'>end</span>

            <span class='kw'>if</span> <span class='id identifier rubyid_syskit_source_task'>syskit_source_task</span> <span class='op'>=</span> <span class='id identifier rubyid_find_setup_syskit_task_context_from_orocos_task'>find_setup_syskit_task_context_from_orocos_task</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_syskit_source_task'>syskit_source_task</span><span class='period'>.</span><span class='id identifier rubyid_removing_output_port_connection'>removing_output_port_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_source_port'>source_port</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_port'>sink_port</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_syskit_sink_task'>syskit_sink_task</span> <span class='op'>=</span> <span class='id identifier rubyid_find_setup_syskit_task_context_from_orocos_task'>find_setup_syskit_task_context_from_orocos_task</span><span class='lparen'>(</span><span class='id identifier rubyid_sink_task'>sink_task</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_syskit_sink_task'>syskit_sink_task</span><span class='period'>.</span><span class='id identifier rubyid_removing_input_port_connection'>removing_input_port_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_source_port'>source_port</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_port'>sink_port</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='lbracket'>[</span><span class='id identifier rubyid_syskit_source_task'>syskit_source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_source_port'>source_port</span><span class='comma'>,</span> <span class='id identifier rubyid_syskit_sink_task'>syskit_sink_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_port'>sink_port</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="removed_connections_require_network_update?-instance_method">
  
    #<strong>removed_connections_require_network_update?</strong>(connections)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks whether the removal of some connections require to run the Syskit
deployer right away</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>removed</span>
      
      
        <span class='type'>(<tt>{(Orocos::TaskContext,Orocos::TaskContext) =&gt; {[String,String] =&gt; Hash}}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the connections, specified between the actual tasks (NOT their Roby
representations)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 171</span>

<span class='kw'>def</span> <span class='id identifier rubyid_removed_connections_require_network_update?'>removed_connections_require_network_update?</span><span class='lparen'>(</span><span class='id identifier rubyid_connections'>connections</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_unneeded_tasks'>unneeded_tasks</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_handle_modified_task'>handle_modified_task</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_syskit_task'>syskit_task</span> <span class='op'>=</span> <span class='id identifier rubyid_find_setup_syskit_task_context_from_orocos_task'>find_setup_syskit_task_context_from_orocos_task</span><span class='lparen'>(</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_unneeded_tasks'>unneeded_tasks</span> <span class='op'>||=</span> <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_unneeded_tasks'>unneeded_tasks</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_unneeded_tasks'>unneeded_tasks</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_syskit_task'>syskit_task</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_connections'>connections</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_mappings'>mappings</span><span class='op'>|</span>
        <span class='id identifier rubyid_mappings'>mappings</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_source_port'>source_port</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_port'>sink_port</span><span class='op'>|</span>
            <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../Syskit.html#ActualDataFlow-constant" title="Syskit::ActualDataFlow (constant)">ActualDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_static?'>static?</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_source_port'>source_port</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_handle_modified_task'>handle_modified_task</span><span class='lbracket'>[</span><span class='id identifier rubyid_source_task'>source_task</span><span class='rbracket'>]</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_task'>source_task</span><span class='embexpr_end'>}</span><span class='tstring_content'> has an outgoing connection removed from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_port'>source_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> and the port is static</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
                <span class='kw'>return</span> <span class='kw'>true</span>
            <span class='kw'>elsif</span> <span class='const'><span class='object_link'><a href="../../Syskit.html#ActualDataFlow-constant" title="Syskit::ActualDataFlow (constant)">ActualDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_static?'>static?</span><span class='lparen'>(</span><span class='id identifier rubyid_sink_task'>sink_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_port'>sink_port</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_handle_modified_task'>handle_modified_task</span><span class='lbracket'>[</span><span class='id identifier rubyid_sink_task'>sink_task</span><span class='rbracket'>]</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sink_task'>sink_task</span><span class='embexpr_end'>}</span><span class='tstring_content'> has an outgoing connection removed from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sink_port'>sink_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> and the port is static</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
                <span class='kw'>return</span> <span class='kw'>true</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="scheduler-instance_method">
  
    #<strong>scheduler</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_scheduler'>scheduler</span>
    <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_execution_engine'>execution_engine</span><span class='period'>.</span><span class='id identifier rubyid_scheduler'>scheduler</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update-instance_method">
  
    #<strong>update</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 632</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>
    <span class='comment'># Don&#39;t do anything if the engine is deploying
</span>    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_syskit_has_async_resolution?'>syskit_has_async_resolution?</span>

    <span class='id identifier rubyid_tasks'>tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_modified_tasks'>modified_tasks</span>
    <span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='op'>!</span><span class='id identifier rubyid_active_task?'>active_task?</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>connection: updating, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> tasks modified in dataflow graph</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># The modifications to +tasks+ might have removed all input
</span>    <span class='comment'># connection. Make sure that in this case, executable? has been
</span>    <span class='comment'># reset to nil
</span>    <span class='comment'>#
</span>    <span class='comment'># The normal workflow does not work in this case, as it is only
</span>    <span class='comment'># looking for tasks whose input connections have been modified
</span>    <span class='id identifier rubyid_mark_connected_pending_tasks_as_executable'>mark_connected_pending_tasks_as_executable</span><span class='lparen'>(</span>
        <span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:executable?</span><span class='rparen'>)</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_pending_changes'>pending_changes</span>
            <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_pending_changes'>pending_changes</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
                <span class='id identifier rubyid_tasks'>tasks</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_t'>t</span> <span class='kw'>if</span> <span class='id identifier rubyid_active_task?'>active_task?</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='comment'># Auto-add any Syskit task that has the same underlying
</span>        <span class='comment'># orocos task, or we might get inconsistencies
</span>        <span class='id identifier rubyid_tasks'>tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_each_with_object'>each_with_object</span><span class='lparen'>(</span><span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
            <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='ivar'>@orocos_task_to_syskit_tasks</span><span class='lbracket'>[</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_orocos_task'>orocos_task</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='op'>!</span><span class='id identifier rubyid_active_task?'>active_task?</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

        <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>computing data flow update from modified tasks</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>for</span> <span class='id identifier rubyid_t'>t</span> <span class='kw'>in</span> <span class='id identifier rubyid_tasks'>tasks</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>end</span>
            <span class='kw'>break</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_removed'>removed</span> <span class='op'>=</span> <span class='id identifier rubyid_compute_connection_changes'>compute_connection_changes</span><span class='lparen'>(</span><span class='id identifier rubyid_tasks'>tasks</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_new'>new</span>
            <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_pending_changes'>pending_changes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='comma'>,</span> <span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_removed'>removed</span><span class='rbracket'>]</span>
            <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_modified_tasks'>modified_tasks</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cannot compute changes, keeping the tasks queued</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_dangling'>dangling</span> <span class='op'>=</span> <span class='id identifier rubyid_dangling_task_cleanup'>dangling_task_cleanup</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_dangling'>dangling</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_pending_changes'>pending_changes</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_pending_changes'>pending_changes</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='id identifier rubyid_dangling'>dangling</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_m0'>m0</span><span class='comma'>,</span> <span class='id identifier rubyid_m1'>m1</span><span class='op'>|</span>
            <span class='id identifier rubyid_m0'>m0</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_m1'>m1</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_pending_changes'>pending_changes</span>
        <span class='id identifier rubyid_main_tasks'>main_tasks</span><span class='comma'>,</span> <span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_removed'>removed</span> <span class='op'>=</span> <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_pending_changes'>pending_changes</span>
        <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_main_tasks'>main_tasks</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> tasks in pending</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_main_tasks'>main_tasks</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='op'>!</span><span class='id identifier rubyid_active_task?'>active_task?</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_main_tasks'>main_tasks</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> tasks after inactive removal</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span>
            <span class='op'>!</span><span class='id identifier rubyid_active_task?'>active_task?</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_active_task?'>active_task?</span><span class='lparen'>(</span><span class='id identifier rubyid_sink_task'>sink_task</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_removed_connections_require_network_update?'>removed_connections_require_network_update?</span><span class='lparen'>(</span><span class='id identifier rubyid_removed'>removed</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_pending_changes'>pending_changes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_main_tasks'>main_tasks</span><span class='comma'>,</span> <span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_removed'>removed</span><span class='rbracket'>]</span>
            <span class='const'><span class='object_link'><a href="../Runtime.html" title="Syskit::Runtime (module)">Runtime</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply_requirement_modifications'><span class='object_link'><a href="../Runtime.html#apply_requirement_modifications-class_method" title="Syskit::Runtime.apply_requirement_modifications (method)">apply_requirement_modifications</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_plan'>plan</span><span class='comma'>,</span> <span class='label'>force:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>applying pending changes from the data flow graph</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_removed'>removed</span> <span class='op'>=</span> <span class='id identifier rubyid_apply_connection_changes'>apply_connection_changes</span><span class='lparen'>(</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_removed'>removed</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_removed'>removed</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_pending_changes'>pending_changes</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_pending_changes'>pending_changes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_main_tasks'>main_tasks</span><span class='comma'>,</span> <span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_removed'>removed</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_pending_changes'>pending_changes</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>successfully applied pending changes</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>some connection changes could not be applied in this pass</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_main_tasks'>main_tasks</span><span class='comma'>,</span> <span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_removed'>removed</span> <span class='op'>=</span> <span class='id identifier rubyid_dataflow_graph'>dataflow_graph</span><span class='period'>.</span><span class='id identifier rubyid_pending_changes'>pending_changes</span>
                <span class='id identifier rubyid_additions'>additions</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_count'>count</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_ports'>ports</span><span class='rparen'>)</span><span class='op'>|</span> <span class='id identifier rubyid_count'>count</span> <span class='op'>+</span> <span class='id identifier rubyid_ports'>ports</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rbrace'>}</span>
                <span class='id identifier rubyid_removals'>removals</span>  <span class='op'>=</span> <span class='id identifier rubyid_removed'>removed</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_count'>count</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_ports'>ports</span><span class='rparen'>)</span><span class='op'>|</span> <span class='id identifier rubyid_count'>count</span> <span class='op'>+</span> <span class='id identifier rubyid_ports'>ports</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rbrace'>}</span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_additions'>additions</span><span class='embexpr_end'>}</span><span class='tstring_content'> new connections pending</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_removals'>removals</span><span class='embexpr_end'>}</span><span class='tstring_content'> removed connections pending</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  involving </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_main_tasks'>main_tasks</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> tasks</span><span class='tstring_end'>&quot;</span></span>
                <span class='kw'>break</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_required_dataflow_graph-instance_method">
  
    #<strong>update_required_dataflow_graph</strong>(tasks)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Updates an intermediate graph (Syskit::RequiredDataFlow) where we store the
concrete connections. We don&#39;t try to be smart: remove all tasks that
have to be updated and add their connections again</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/syskit/runtime/connection_management.rb', line 42</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_required_dataflow_graph'>update_required_dataflow_graph</span><span class='lparen'>(</span><span class='id identifier rubyid_tasks'>tasks</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_tasks'>tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span>

    <span class='comment'># Remove first all tasks. Otherwise, removing some tasks will
</span>    <span class='comment'># also remove the new edges we just added
</span>    <span class='kw'>for</span> <span class='id identifier rubyid_t'>t</span> <span class='kw'>in</span> <span class='id identifier rubyid_tasks'>tasks</span>
        <span class='const'><span class='object_link'><a href="../../Syskit.html#RequiredDataFlow-constant" title="Syskit::RequiredDataFlow (constant)">RequiredDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_remove_vertex'>remove_vertex</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># Create the new connections
</span>    <span class='comment'>#
</span>    <span class='comment'># We&#39;re only updating on a partial set of tasks ... so we do
</span>    <span class='comment'># have to enumerate both output and input connections. We can
</span>    <span class='comment'># however avoid doulbing work by avoiding the update of sink
</span>    <span class='comment'># tasks that are part of the set
</span>    <span class='kw'>for</span> <span class='id identifier rubyid_t'>t</span> <span class='kw'>in</span> <span class='id identifier rubyid_tasks'>tasks</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_each_concrete_input_connection'>each_concrete_input_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_source_port'>source_port</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_port'>sink_port</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='op'>|</span>
            <span class='const'><span class='object_link'><a href="../../Syskit.html#RequiredDataFlow-constant" title="Syskit::RequiredDataFlow (constant)">RequiredDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_add_connections'>add_connections</span><span class='lparen'>(</span><span class='id identifier rubyid_source_task'>source_task</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_source_port'>source_port</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_port'>sink_port</span><span class='rbracket'>]</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_policy'>policy</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_each_concrete_output_connection'>each_concrete_output_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_source_port'>source_port</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_port'>sink_port</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='comma'>,</span> <span class='id identifier rubyid_policy'>policy</span><span class='op'>|</span>
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_sink_task'>sink_task</span><span class='rparen'>)</span>
            <span class='const'><span class='object_link'><a href="../../Syskit.html#RequiredDataFlow-constant" title="Syskit::RequiredDataFlow (constant)">RequiredDataFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_add_connections'>add_connections</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_task'>sink_task</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_source_port'>source_port</span><span class='comma'>,</span> <span class='id identifier rubyid_sink_port'>sink_port</span><span class='rbracket'>]</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_policy'>policy</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed Apr 10 21:58:23 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.19 (ruby-2.5.1).
</div>

    </div>
  </body>
</html>