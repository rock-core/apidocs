<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Pocolog::Logfiles
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Pocolog::Logfiles";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (L)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Pocolog.html" title="Pocolog (module)">Pocolog</a></span></span>
     &raquo; 
    <span class="title">Logfiles</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Pocolog::Logfiles
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Pocolog::Logfiles</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/pocolog/logfiles.rb<span class="defines">,<br />
  lib/pocolog/convert.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Low-level access to (consistent) set of logfiles.</p>

<p>The pocolog logfiles can be split during recording in order to limit each
file&#39;s size. This class allows to provide a list of files (to
Logfiles.open) and have a uniform access to the data.</p>

<p>Files are indexed (i.e. a .idx file gets generated along with the log file)
to provide quick random access.</p>

<p>A higher level access is provided by the streams (DataStream), that can be
retrieved with #stream, #stream_from_type and #stream_from_index</p>

<h2 id="label-Format">Format</h2>

<p>Pocolog files are made of:</p>
<ul><li>
<p>a prologue</p>
</li><li>
<p>a sequence of generic blocks, each block pointing to the next block</p>
</li><li>
<p>blocks can either be stream blocks, control blocks or data blocks.</p>
<ul><li>
<p>Stream blocks define a new data stream with name, type name and type
definition, assigning it a stream ID which is unique in these logfiles</p>
</li><li>
<p>Control blocks provide additional, logfile-wide, information. They are not
assigned to streams. This feature is currently unused.</p>
</li><li>
<p>Data blocks store a single data sample in a stream</p>
</li></ul>
</li></ul>

<p>See the tasks/logging.hh file in Rock&#39;s tools/logger package for a
detailed description of each block&#39;s layout.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Logfiles/DataHeader.html" title="Pocolog::Logfiles::DataHeader (class)">DataHeader</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="MAGIC-constant" class="">MAGIC =
        
      </dt>
      <dd><pre class="code"><span class='const'><span class='object_link'><a href="Format.html" title="Pocolog::Format (module)">Format</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Format.html#Current-constant" title="Pocolog::Format::Current (constant)">Current</a></span></span><span class='op'>::</span><span class='const'>MAGIC</span></pre></dd>
    
      <dt id="FORMAT_VERSION-constant" class="">FORMAT_VERSION =
        
      </dt>
      <dd><pre class="code"><span class='const'><span class='object_link'><a href="Format.html" title="Pocolog::Format (module)">Format</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Format.html#Current-constant" title="Pocolog::Format::Current (constant)">Current</a></span></span><span class='op'>::</span><span class='const'>VERSION</span></pre></dd>
    
      <dt id="BLOCK_HEADER_SIZE-constant" class="">BLOCK_HEADER_SIZE =
        
      </dt>
      <dd><pre class="code"><span class='const'><span class='object_link'><a href="Format.html" title="Pocolog::Format (module)">Format</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Format.html#Current-constant" title="Pocolog::Format::Current (constant)">Current</a></span></span><span class='op'>::</span><span class='const'>BLOCK_HEADER_SIZE</span></pre></dd>
    
      <dt id="TIME_SIZE-constant" class="">TIME_SIZE =
        
      </dt>
      <dd><pre class="code"><span class='const'><span class='object_link'><a href="Format.html" title="Pocolog::Format (module)">Format</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Format.html#Current-constant" title="Pocolog::Format::Current (constant)">Current</a></span></span><span class='op'>::</span><span class='const'>TIME_SIZE</span></pre></dd>
    
      <dt id="MissingPrologue-constant" class="">MissingPrologue =
        <div class="docstring">
  <div class="discussion">
    
<p>For backward compatibility</p>


  </div>
</div>
<div class="tags">
  

</div>
      </dt>
      <dd><pre class="code"><span class='const'><span class='object_link'><a href="../Pocolog.html" title="Pocolog (module)">Pocolog</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="MissingPrologue.html" title="Pocolog::MissingPrologue (class)">MissingPrologue</a></span></span></pre></dd>
    
      <dt id="COMPRESSION_MIN_SIZE-constant" class="">COMPRESSION_MIN_SIZE =
        <div class="docstring">
  <div class="discussion">
    
<p>Data blocks of less than COMPRESSION_MIN_SIZE are never compressed</p>


  </div>
</div>
<div class="tags">
  

</div>
      </dt>
      <dd><pre class="code"><span class='int'>60</span> <span class='op'>*</span> <span class='int'>1024</span></pre></dd>
    
      <dt id="COMPRESSION_THRESHOLD-constant" class="">COMPRESSION_THRESHOLD =
        <div class="docstring">
  <div class="discussion">
    
<p>If the size gained by compressing is below this value, do not save in
compressed form</p>


  </div>
</div>
<div class="tags">
  

</div>
      </dt>
      <dd><pre class="code"><span class='float'>0.3</span></pre></dd>
    
      <dt id="TIME_PADDING-constant" class="">TIME_PADDING =
        
      </dt>
      <dd><pre class="code"><span class='const'><span class='object_link'><a href="#TIME_SIZE-constant" title="Pocolog::Logfiles::TIME_SIZE (constant)">TIME_SIZE</a></span></span> <span class='op'>-</span> <span class='int'>8</span></pre></dd>
    
      <dt id="DATA_BLOCK_HEADER_FORMAT-constant" class="">DATA_BLOCK_HEADER_FORMAT =
        <div class="docstring">
  <div class="discussion">
    
<p>Formatting string for Array.pack to create a data block</p>


  </div>
</div>
<div class="tags">
  

</div>
      </dt>
      <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>VVx</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="#TIME_PADDING-constant" title="Pocolog::Logfiles::TIME_PADDING (constant)">TIME_PADDING</a></span></span><span class='embexpr_end'>}</span><span class='tstring_content'>VVx</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="#TIME_PADDING-constant" title="Pocolog::Logfiles::TIME_PADDING (constant)">TIME_PADDING</a></span></span><span class='embexpr_end'>}</span><span class='tstring_content'>VC</span><span class='tstring_end'>&quot;</span></span></pre></dd>
    
  </dl>




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#basename-instance_method" title="#basename (instance method)">#<strong>basename</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The basename for creating new log files.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#block_stream-instance_method" title="#block_stream (instance method)">#<strong>block_stream</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The block stream object used to interpret the data stream.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#io-instance_method" title="#io (instance method)">#<strong>io</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The underlying IO object.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#path-instance_method" title="#path (instance method)">#<strong>path</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute path.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#registry-instance_method" title="#registry (instance method)">#<strong>registry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The type registry for these logfiles, as a Typelib::Registry instance.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#streams-instance_method" title="#streams (instance method)">#<strong>streams</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set of data streams found in this file.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#append-class_method" title="append (class method)">.<strong>append</strong>(basename)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open an already existing set of log files or create it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compress-class_method" title="compress (class method)">.<strong>compress</strong>(from_io, to_io)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#copy_block-class_method" title="copy_block (class method)">.<strong>copy_block</strong>(block_info, from_io, to_io, buffer)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-class_method" title="create (class method)">.<strong>create</strong>(basename, registry = Typelib::Registry.new)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create an empty log file using <code>basename</code> to build its name.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_index_filename-class_method" title="default_index_filename (class method)">.<strong>default_index_filename</strong>(path, index_dir: File.dirname(path))  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the default index file for a given file.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#encode_stream_declaration_payload-class_method" title="encode_stream_declaration_payload (class method)">.<strong>encode_stream_declaration_payload</strong>(name, type_name, type_registry: nil, metadata: {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Produce the encoded (on-disk) version of a stream definition.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#from_version_1-class_method" title="from_version_1 (class method)">.<strong>from_version_1</strong>(from, to_io, big_endian)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Converts a version 1 logfile.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#normalize_metadata-class_method" title="normalize_metadata (class method)">.<strong>normalize_metadata</strong>(metadata)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open-class_method" title="open (class method)">.<strong>open</strong>(pattern, registry = Typelib::Registry.new, index_dir: nil, silent: false)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Opens a set of file.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rename_streams-class_method" title="rename_streams (class method)">.<strong>rename_streams</strong>(from_io, to_io, mappings)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_new_format-class_method" title="to_new_format (class method)">.<strong>to_new_format</strong>(from_io, to_io, big_endian = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valid_file%3F-class_method" title="valid_file? (class method)">.<strong>valid_file?</strong>(file)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns true if <code>file</code> is a valid, up-to-date, pocolog file.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_block-class_method" title="write_block (class method)">.<strong>write_block</strong>(wio, type, index, payload)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Formats a block and writes it to <code>io</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_data_block-class_method" title="write_data_block (class method)">.<strong>write_data_block</strong>(io, stream_index, rt, lg, compress, data)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_prologue-class_method" title="write_prologue (class method)">.<strong>write_prologue</strong>(to_io, big_endian = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_stream_declaration-class_method" title="write_stream_declaration (class method)">.<strong>write_stream_declaration</strong>(wio, index, name, type_name, type_registry = nil, metadata = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Encodes and writes a stream declaration block to <code>wio</code>.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Close the underlying IO objects.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#closed%3F-instance_method" title="#closed? (instance method)">#<strong>closed?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_stream-instance_method" title="#create_stream (instance method)">#<strong>create_stream</strong>(name, type, metadata = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Explicitely creates a new stream named <code>name</code>, of the given type
and metadata.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#data-instance_method" title="#data (instance method)">#<strong>data</strong>(data_header = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the raw data payload of the current block.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#data_header-instance_method" title="#data_header (instance method)">#<strong>data_header</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Reads the header of a data block.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#declared_stream%3F-instance_method" title="#declared_stream? (instance method)">#<strong>declared_stream?</strong>(index)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>True if there is a stream <code>index</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each_stream-instance_method" title="#each_stream (instance method)">#<strong>each_stream</strong>(&amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Enumerate this file&#39;s streams.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#endian_swap-instance_method" title="#endian_swap (instance method)">#<strong>endian_swap</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Whether the endianness of the data stored in the file matches the
host&#39;s (false) or not (true).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#eof%3F-instance_method" title="#eof? (instance method)">#<strong>eof?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>True if we read the last block in the file set.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flush-instance_method" title="#flush (instance method)">#<strong>flush</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Flush the IO objects.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_stream%3F-instance_method" title="#has_stream? (instance method)">#<strong>has_stream?</strong>(name)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns true if <code>name</code> is the name of an existing stream.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(*io, write_only: false, index_dir: nil, silent: false)  &#x21d2; Logfiles </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>call-seq:   Logfiles.open(io1, io2)   Logfiles.open(io1, io2, registry).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize_copy-instance_method" title="#initialize_copy (instance method)">#<strong>initialize_copy</strong>(from)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize_from_stream_info-instance_method" title="#initialize_from_stream_info (instance method)">#<strong>initialize_from_stream_info</strong>(io, stream_info)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Initialize self by loading information from an index file.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#joint_stream-instance_method" title="#joint_stream (instance method)">#<strong>joint_stream</strong>(use_rt, *names)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a JointStream object on the streams whose names are given.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_stream_info-instance_method" title="#load_stream_info (instance method)">#<strong>load_stream_info</strong>(ios, index_dir: nil, silent: false)  &#x21d2; Array&lt;DataStream,nil&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Load stream information, either from an existing on-disk index or by
rebuilding an index.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_stream_info_from_file-instance_method" title="#load_stream_info_from_file (instance method)">#<strong>load_stream_info_from_file</strong>(io, index_dir: File.dirname(io.path), silent: false)  &#x21d2; Array&lt;StreamInfo&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the index for the file backed by the given IO.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_file-instance_method" title="#new_file (instance method)">#<strong>new_file</strong>(filename = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Continue writing logs in a new file.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#num_io-instance_method" title="#num_io (instance method)">#<strong>num_io</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open-instance_method" title="#open (instance method)">#<strong>open</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_one_block-instance_method" title="#read_one_block (instance method)">#<strong>read_one_block</strong>(file_pos)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Read the block information for the block at a certain position in the IO.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_one_data_payload-instance_method" title="#read_one_data_payload (instance method)">#<strong>read_one_data_payload</strong>(file_pos)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Read the data payload for a data block present at a certain position in the
IO.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rebuild_and_load_index-instance_method" title="#rebuild_and_load_index (instance method)">#<strong>rebuild_and_load_index</strong>(io, index_path = self.class.default_index_filename(io), silent: false)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Go through the whole file to extract index information, and write the index
file.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stream-instance_method" title="#stream (instance method)">#<strong>stream</strong>(name, type = nil, create = false)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the DataStream object for <code>name</code>, <code>registry</code>
and <code>type</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stream_aligner-instance_method" title="#stream_aligner (instance method)">#<strong>stream_aligner</strong>(use_rt = false)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a stream aligner on all streams of this logfile.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stream_from_index-instance_method" title="#stream_from_index (instance method)">#<strong>stream_from_index</strong>(index)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a stream from its index.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stream_from_type-instance_method" title="#stream_from_type (instance method)">#<strong>stream_from_type</strong>(type)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a stream of the given type, if there is only one.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#streams_from_type-instance_method" title="#streams_from_type (instance method)">#<strong>streams_from_type</strong>(type)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns all streams of the given type.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sub_field-instance_method" title="#sub_field (instance method)">#<strong>sub_field</strong>(offset, size, data_header = self.data_header)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tell-instance_method" title="#tell (instance method)">#<strong>tell</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the current position in the current IO.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_block-instance_method" title="#write_block (instance method)">#<strong>write_block</strong>(type, index, payload)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Write a raw block.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_data_block-instance_method" title="#write_data_block (instance method)">#<strong>write_data_block</strong>(stream, rt, lg, data)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Write a data block for stream index <code>stream</code>, with the provided
times and the given data.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(*io, write_only: false, index_dir: nil, silent: false)  &#x21d2; <tt><span class='object_link'><a href="" title="Pocolog::Logfiles (class)">Logfiles</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>call-seq:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="" title="Pocolog::Logfiles (class)">Logfiles</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open'><span class='object_link'><a href="#open-class_method" title="Pocolog::Logfiles.open (method)">open</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_io1'>io1</span><span class='comma'>,</span> <span class='id identifier rubyid_io2'>io2</span><span class='rparen'>)</span>
<span class='const'><span class='object_link'><a href="" title="Pocolog::Logfiles (class)">Logfiles</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open'><span class='object_link'><a href="#open-class_method" title="Pocolog::Logfiles.open (method)">open</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_io1'>io1</span><span class='comma'>,</span> <span class='id identifier rubyid_io2'>io2</span><span class='comma'>,</span> <span class='id identifier rubyid_registry'>registry</span><span class='rparen'>)</span>
</code></pre>

<p>This is usually not used directly. Most users want to use Pocolog.open to
read existing file(s), and Pocolog.create to create new ones.</p>

<p>Creates a new Logfiles object to read the given IO objects. If the last
argument is a Typelib::Registry instance, update this registry with the
type definitions found in the logfile.</p>

<p>Providing a type registry guarantees that you get an error if the
logfile&#39;s types do not match the type definitions found in the
registry.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 100</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='label'>write_only:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>index_dir:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>silent:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='ivar'>@registry</span> <span class='op'>=</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span> <span class='kw'>if</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Typelib</span><span class='op'>::</span><span class='const'>Registry</span><span class='rparen'>)</span>

    <span class='ivar'>@path</span> <span class='op'>=</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span> <span class='kw'>unless</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='ivar'>@io</span> <span class='op'>=</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span>
            <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
        <span class='kw'>else</span>
            <span class='const'><span class='object_link'><a href="IOSequence.html" title="Pocolog::IOSequence (class)">IOSequence</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="IOSequence.html#initialize-instance_method" title="Pocolog::IOSequence#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='ivar'>@block_stream</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BlockStream.html" title="Pocolog::BlockStream (class)">BlockStream</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="BlockStream.html#initialize-instance_method" title="Pocolog::BlockStream#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@io</span><span class='rparen'>)</span>
    <span class='ivar'>@big_endian</span> <span class='op'>=</span> <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_big_endian?'>big_endian?</span>

    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@streams</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@compress</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='ivar'>@data_header_buffer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
    <span class='ivar'>@streams</span> <span class='op'>=</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_write_only'>write_only</span>
            <span class='lbracket'>[</span><span class='rbracket'>]</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_load_stream_info'>load_stream_info</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='label'>index_dir:</span> <span class='id identifier rubyid_index_dir'>index_dir</span><span class='comma'>,</span> <span class='label'>silent:</span> <span class='id identifier rubyid_silent'>silent</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="basename=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="basename-instance_method">
  
    #<strong>basename</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The basename for creating new log files. The files names are</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#{basename}.#{index}.log
</span></code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


162
163
164</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 162</span>

<span class='kw'>def</span> <span class='id identifier rubyid_basename'>basename</span>
  <span class='ivar'>@basename</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="block_stream-instance_method">
  
    #<strong>block_stream</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The block stream object used to interpret the data stream</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 84</span>

<span class='kw'>def</span> <span class='id identifier rubyid_block_stream'>block_stream</span>
  <span class='ivar'>@block_stream</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="io-instance_method">
  
    #<strong>io</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The underlying IO object</p>

<p>Sequence of files are handled through the <span class='object_link'><a href="IOSequence.html" title="Pocolog::IOSequence (class)">IOSequence</a></span> facade</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


77
78
79</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 77</span>

<span class='kw'>def</span> <span class='id identifier rubyid_io'>io</span>
  <span class='ivar'>@io</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="path-instance_method">
  
    #<strong>path</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute path</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


125
126
127</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 125</span>

<span class='kw'>def</span> <span class='id identifier rubyid_path'>path</span>
  <span class='ivar'>@path</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="registry-instance_method">
  
    #<strong>registry</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The type registry for these logfiles, as a Typelib::Registry instance</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 79</span>

<span class='kw'>def</span> <span class='id identifier rubyid_registry'>registry</span>
  <span class='ivar'>@registry</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="streams-instance_method">
  
    #<strong>streams</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set of data streams found in this file</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 81</span>

<span class='kw'>def</span> <span class='id identifier rubyid_streams'>streams</span>
  <span class='ivar'>@streams</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="append-class_method">
  
    .<strong>append</strong>(basename)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Open an already existing set of log files or create it</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


219
220
221
222
223
224
225
226
227
228
229
230
231
232</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 219</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='id identifier rubyid_basename'>basename</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>while</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_readable?'>readable?</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_basename'>basename</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>.log</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_io'>io</span> <span class='op'>&lt;&lt;</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a+</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='id identifier rubyid_basename'>basename</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='id identifier rubyid_file'>file</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Pocolog::Logfiles (class)">Logfiles</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Pocolog::Logfiles#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span> <span class='op'>=</span> <span class='id identifier rubyid_basename'>basename</span>
    <span class='id identifier rubyid_file'>file</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compress-class_method">
  
    .<strong>compress</strong>(from_io, to_io)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/convert.rb', line 77</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_compress'>compress</span><span class='lparen'>(</span><span class='id identifier rubyid_from_io'>from_io</span><span class='comma'>,</span> <span class='id identifier rubyid_to_io'>to_io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_from'>from</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Pocolog::Logfiles (class)">Logfiles</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Pocolog::Logfiles#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_from_io'>from_io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_read_prologue'>read_prologue</span>
    <span class='id identifier rubyid_write_prologue'>write_prologue</span><span class='lparen'>(</span><span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_endian_swap'>endian_swap</span> <span class='op'>^</span> <span class='const'><span class='object_link'><a href="../Pocolog.html" title="Pocolog (module)">Pocolog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_big_endian?'><span class='object_link'><a href="../Pocolog.html#big_endian%3F-class_method" title="Pocolog.big_endian? (method)">big_endian?</a></span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_compressed'>compressed</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>C</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>BINARY</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_each_block'>each_block</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_block_info'>block_info</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>!=</span> <span class='const'><span class='object_link'><a href="../Pocolog.html#DATA_BLOCK-constant" title="Pocolog::DATA_BLOCK (constant)">DATA_BLOCK</a></span></span> <span class='op'>||</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_payload_size'>payload_size</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="#COMPRESSION_MIN_SIZE-constant" title="Pocolog::Logfiles::COMPRESSION_MIN_SIZE (constant)">COMPRESSION_MIN_SIZE</a></span></span>
            <span class='id identifier rubyid_copy_block'>copy_block</span><span class='lparen'>(</span><span class='id identifier rubyid_block_info'>block_info</span><span class='comma'>,</span> <span class='id identifier rubyid_from_io'>from_io</span><span class='comma'>,</span> <span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
            <span class='comment'># Get the data header
</span>            <span class='id identifier rubyid_data_header'>data_header</span> <span class='op'>=</span> <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_data_header'>data_header</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_data_header'>data_header</span><span class='period'>.</span><span class='id identifier rubyid_compressed'>compressed</span>
                <span class='id identifier rubyid_copy_block'>copy_block</span><span class='lparen'>(</span><span class='id identifier rubyid_block_info'>block_info</span><span class='comma'>,</span> <span class='id identifier rubyid_from_io'>from_io</span><span class='comma'>,</span> <span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
                <span class='kw'>next</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_compressed'>compressed</span> <span class='op'>=</span> <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>Deflate</span><span class='period'>.</span><span class='id identifier rubyid_deflate'>deflate</span><span class='lparen'>(</span><span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_delta'>delta</span> <span class='op'>=</span> <span class='id identifier rubyid_data_header'>data_header</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>-</span> <span class='id identifier rubyid_compressed'>compressed</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
            <span class='kw'>if</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_delta'>delta</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_data_header'>data_header</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='const'><span class='object_link'><a href="#COMPRESSION_THRESHOLD-constant" title="Pocolog::Logfiles::COMPRESSION_THRESHOLD (constant)">COMPRESSION_THRESHOLD</a></span></span>
                <span class='comment'># Save it in compressed form
</span>                <span class='id identifier rubyid_payload_size'>payload_size</span> <span class='op'>=</span> <span class='const'>DATA_HEADER_SIZE</span> <span class='op'>+</span> <span class='id identifier rubyid_compressed'>compressed</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
                <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_payload_size'>payload_size</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CxvV</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_pos'>pos</span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="#BLOCK_HEADER_SIZE-constant" title="Pocolog::Logfiles::BLOCK_HEADER_SIZE (constant)">BLOCK_HEADER_SIZE</a></span></span><span class='rparen'>)</span>
                <span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="#TIME_SIZE-constant" title="Pocolog::Logfiles::TIME_SIZE (constant)">TIME_SIZE</a></span></span> <span class='op'>*</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_compressed'>compressed</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>VC</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_compressed'>compressed</span><span class='rparen'>)</span>
            <span class='kw'>else</span>
                <span class='id identifier rubyid_copy_block'>copy_block</span><span class='lparen'>(</span><span class='id identifier rubyid_block_info'>block_info</span><span class='comma'>,</span> <span class='id identifier rubyid_from_io'>from_io</span><span class='comma'>,</span> <span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="copy_block-class_method">
  
    .<strong>copy_block</strong>(block_info, from_io, to_io, buffer)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/convert.rb', line 12</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_copy_block'>copy_block</span><span class='lparen'>(</span><span class='id identifier rubyid_block_info'>block_info</span><span class='comma'>,</span> <span class='id identifier rubyid_from_io'>from_io</span><span class='comma'>,</span> <span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
    <span class='comment'># copy the block as-is
</span>    <span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_pos'>pos</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>=</span> <span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="#BLOCK_HEADER_SIZE-constant" title="Pocolog::Logfiles::BLOCK_HEADER_SIZE (constant)">BLOCK_HEADER_SIZE</a></span></span> <span class='op'>+</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_payload_size'>payload_size</span><span class='comma'>,</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
        <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>=</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create-class_method">
  
    .<strong>create</strong>(basename, registry = Typelib::Registry.new)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create an empty log file using <code>basename</code> to build its name.
Namely, it will create a new file named &lt;basename&gt;.0.log. Then, calls
to #new_file would create &lt;basename&gt;.1.log and so on</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


207
208
209
210
211
212
213
214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 207</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='id identifier rubyid_basename'>basename</span><span class='comma'>,</span> <span class='id identifier rubyid_registry'>registry</span> <span class='op'>=</span> <span class='const'>Typelib</span><span class='op'>::</span><span class='const'>Registry</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_file'>file</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Pocolog::Logfiles (class)">Logfiles</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Pocolog::Logfiles#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_registry'>registry</span><span class='comma'>,</span> <span class='label'>write_only:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_basename'>basename</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.\d+\.log$</span><span class='regexp_end'>/</span></span>
        <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_new_file'>new_file</span><span class='lparen'>(</span><span class='id identifier rubyid_basename'>basename</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
        <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span> <span class='op'>=</span> <span class='id identifier rubyid_basename'>basename</span>
        <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_new_file'>new_file</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_file'>file</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="default_index_filename-class_method">
  
    .<strong>default_index_filename</strong>(path, index_dir: File.dirname(path))  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the default index file for a given file</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>path</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the log file&#39;s path</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the index file name</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


246
247
248
249
250
251
252
253
254
255</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 246</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_default_index_filename'>default_index_filename</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='label'>index_dir:</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_index_filename'>index_filename</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.log$</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.idx</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_index_path'>index_path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_index_dir'>index_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_index_filename'>index_filename</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_index_path'>index_path</span> <span class='op'>==</span> <span class='id identifier rubyid_path'>path</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
              <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'> does not end in .log, cannot generate a </span><span class='tstring_end'>&quot;</span></span>\
              <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>default index name for it</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_index_path'>index_path</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="encode_stream_declaration_payload-class_method">
  
    
      <span class="overload">.<strong>using</strong>(rawdata)  &#x21d2; <tt>Object</tt> </span>
    
      <span class="overload">.<strong>using</strong>(objects)  &#x21d2; <tt>Object</tt> </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Produce the encoded (on-disk) version of a stream definition</p>

<p>Note that raw and object forms can be mixed, i.e. you may pass the type and
registry as string, but the metadata as Hash</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">.<strong>using</strong>(rawdata)  &#x21d2; <tt>Object</tt> </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the stream name</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>type_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the name of the stream type</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>type_registry</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the type registry in XML form</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>metadata</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the metadata marshalled as YAML</p>
</div>
      
    </li>
  
</ul>


</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">.<strong>using</strong>(objects)  &#x21d2; <tt>Object</tt> </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the stream name</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>type</span>
      
      
        <span class='type'>(<tt>Class&lt;Typelib::Type&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the stream type</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>metadata</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the metadata</p>
</div>
      
    </li>
  
</ul>


</div>
      </li>
    
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 500</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_encode_stream_declaration_payload'>encode_stream_declaration_payload</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_type_name'>type_name</span><span class='comma'>,</span> <span class='label'>type_registry:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>metadata:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
<span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_type_name'>type_name</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_type_registry'>type_registry</span> <span class='op'>||=</span> <span class='id identifier rubyid_type_name'>type_name</span><span class='period'>.</span><span class='id identifier rubyid_registry'>registry</span><span class='period'>.</span><span class='id identifier rubyid_minimal'>minimal</span><span class='lparen'>(</span><span class='id identifier rubyid_type_name'>type_name</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_xml'>to_xml</span>
        <span class='id identifier rubyid_type_name'>type_name</span> <span class='op'>=</span> <span class='id identifier rubyid_type_name'>type_name</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
    <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_type_registry'>type_registry</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
              <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cannot give a type name without a corresponding type registry</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_type_registry'>type_registry</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:to_xml</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_type_registry'>type_registry</span> <span class='op'>=</span> <span class='id identifier rubyid_type_registry'>type_registry</span><span class='period'>.</span><span class='id identifier rubyid_to_xml'>to_xml</span>
    <span class='kw'>end</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_metadata'>metadata</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:to_str</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_metadata'>metadata</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_metadata'>normalize_metadata</span><span class='lparen'>(</span><span class='id identifier rubyid_metadata'>metadata</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_metadata'>metadata</span> <span class='op'>=</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lparen'>(</span><span class='id identifier rubyid_metadata'>metadata</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='const'><span class='object_link'><a href="BlockStream.html" title="Pocolog::BlockStream (class)">BlockStream</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="BlockStream/StreamBlock.html" title="Pocolog::BlockStream::StreamBlock (class)">StreamBlock</a></span></span>
        <span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_type_name'>type_name</span><span class='comma'>,</span> <span class='id identifier rubyid_type_registry'>type_registry</span><span class='comma'>,</span> <span class='id identifier rubyid_metadata'>metadata</span><span class='rparen'>)</span>
        <span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="from_version_1-class_method">
  
    .<strong>from_version_1</strong>(from, to_io, big_endian)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Converts a version 1 logfile. Modifications:</p>
<ul><li>
<p>no prologue</p>
</li><li>
<p>no compressed flag on data blocks</p>
</li><li>
<p>time was written as [type, sec, usec, padding], with each field a 32-bit
integer</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/convert.rb', line 27</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_from_version_1'>from_version_1</span><span class='lparen'>(</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_big_endian'>big_endian</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_write_prologue'>write_prologue</span><span class='lparen'>(</span><span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_big_endian'>big_endian</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_from_io'>from_io</span> <span class='op'>=</span> <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_rio'>rio</span>

    <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_uncompressed'>uncompressed</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>C</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_each_block'>each_block</span><span class='lparen'>(</span><span class='kw'>true</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_block_info'>block_info</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="../Pocolog.html#STREAM_BLOCK-constant" title="Pocolog::STREAM_BLOCK (constant)">STREAM_BLOCK</a></span></span>
            <span class='id identifier rubyid_copy_block'>copy_block</span><span class='lparen'>(</span><span class='id identifier rubyid_block_info'>block_info</span><span class='comma'>,</span> <span class='id identifier rubyid_from_io'>from_io</span><span class='comma'>,</span> <span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="../Pocolog.html#CONTROL_BLOCK-constant" title="Pocolog::CONTROL_BLOCK (constant)">CONTROL_BLOCK</a></span></span>
            <span class='comment'># remove the fields in time structure
</span>            <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_payload_size'>payload_size</span> <span class='op'>-</span> <span class='int'>16</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CxvV</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_pos'>pos</span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="#BLOCK_HEADER_SIZE-constant" title="Pocolog::Logfiles::BLOCK_HEADER_SIZE (constant)">BLOCK_HEADER_SIZE</a></span></span> <span class='op'>+</span> <span class='int'>4</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='int'>8</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='int'>4</span><span class='comma'>,</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>SEEK_CUR</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='int'>4</span><span class='comma'>,</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>SEEK_CUR</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='int'>8</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_size_offset'>size_offset</span> <span class='op'>=</span> <span class='op'>-</span> <span class='int'>16</span> <span class='op'>+</span> <span class='int'>1</span>

            <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_payload_size'>payload_size</span> <span class='op'>+</span> <span class='id identifier rubyid_size_offset'>size_offset</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CxvV</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_pos'>pos</span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="#BLOCK_HEADER_SIZE-constant" title="Pocolog::Logfiles::BLOCK_HEADER_SIZE (constant)">BLOCK_HEADER_SIZE</a></span></span> <span class='op'>+</span> <span class='int'>4</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='int'>8</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='int'>8</span><span class='comma'>,</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>SEEK_CUR</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='int'>8</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='int'>4</span><span class='comma'>,</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>SEEK_CUR</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='int'>4</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_uncompressed'>uncompressed</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_payload_size'>payload_size</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='const'>DATA_HEADER_SIZE</span> <span class='op'>-</span> <span class='id identifier rubyid_size_offset'>size_offset</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="normalize_metadata-class_method">
  
    .<strong>normalize_metadata</strong>(metadata)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


477
478
479
480
481
482
483</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 477</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_normalize_metadata'>normalize_metadata</span><span class='lparen'>(</span><span class='id identifier rubyid_metadata'>metadata</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_metadata'>metadata</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
        <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='period'>.</span><span class='id identifier rubyid_to_str'>to_str</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="open-class_method">
  
    .<strong>open</strong>(pattern, registry = Typelib::Registry.new, index_dir: nil, silent: false)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Opens a set of file. <code>pattern</code> can be a globbing pattern, in
which case all the matching files will be opened as a log sequence</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196
197
198
199
200
201
202</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 194</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_pattern'>pattern</span><span class='comma'>,</span> <span class='id identifier rubyid_registry'>registry</span> <span class='op'>=</span> <span class='const'>Typelib</span><span class='op'>::</span><span class='const'>Registry</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span>
    <span class='label'>index_dir:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>silent:</span> <span class='kw'>false</span>
<span class='rparen'>)</span>
    <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_enum_for'>enum_for</span><span class='lparen'>(</span><span class='symbol'>:glob</span><span class='comma'>,</span> <span class='id identifier rubyid_pattern'>pattern</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no files matching &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pattern'>pattern</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_registry'>registry</span><span class='comma'>,</span> <span class='label'>index_dir:</span> <span class='id identifier rubyid_index_dir'>index_dir</span><span class='comma'>,</span> <span class='label'>silent:</span> <span class='id identifier rubyid_silent'>silent</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rename_streams-class_method">
  
    .<strong>rename_streams</strong>(from_io, to_io, mappings)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/convert.rb', line 112</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rename_streams'>rename_streams</span><span class='lparen'>(</span><span class='id identifier rubyid_from_io'>from_io</span><span class='comma'>,</span> <span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_mappings'>mappings</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_from'>from</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Pocolog::Logfiles (class)">Logfiles</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Pocolog::Logfiles#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_from_io'>from_io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_read_prologue'>read_prologue</span>
    <span class='id identifier rubyid_write_prologue'>write_prologue</span><span class='lparen'>(</span><span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_endian_swap'>endian_swap</span> <span class='op'>^</span> <span class='const'><span class='object_link'><a href="../Pocolog.html" title="Pocolog (module)">Pocolog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_big_endian?'><span class='object_link'><a href="../Pocolog.html#big_endian%3F-class_method" title="Pocolog.big_endian? (method)">big_endian?</a></span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_each_block'>each_block</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_block_info'>block_info</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="../Pocolog.html#STREAM_BLOCK-constant" title="Pocolog::STREAM_BLOCK (constant)">STREAM_BLOCK</a></span></span>
            <span class='id identifier rubyid_stream'>stream</span> <span class='op'>=</span> <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_read_stream_declaration'>read_stream_declaration</span>
            <span class='id identifier rubyid_write_stream_declaration'>write_stream_declaration</span><span class='lparen'>(</span><span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_stream'>stream</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span>
                    <span class='id identifier rubyid_mappings'>mappings</span><span class='lbracket'>[</span><span class='id identifier rubyid_stream'>stream</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_stream'>stream</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
                    <span class='id identifier rubyid_stream'>stream</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_stream'>stream</span><span class='period'>.</span><span class='id identifier rubyid_metadata'>metadata</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_copy_block'>copy_block</span><span class='lparen'>(</span><span class='id identifier rubyid_block_info'>block_info</span><span class='comma'>,</span> <span class='id identifier rubyid_from_io'>from_io</span><span class='comma'>,</span> <span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_new_format-class_method">
  
    .<strong>to_new_format</strong>(from_io, to_io, big_endian = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/convert.rb', line 62</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_to_new_format'>to_new_format</span><span class='lparen'>(</span><span class='id identifier rubyid_from_io'>from_io</span><span class='comma'>,</span> <span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_big_endian'>big_endian</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_from'>from</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Pocolog::Logfiles (class)">Logfiles</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Pocolog::Logfiles#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_from_io'>from_io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_read_prologue'>read_prologue</span>

<span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="#MissingPrologue-constant" title="Pocolog::Logfiles::MissingPrologue (constant)">MissingPrologue</a></span></span>
    <span class='comment'># This is format version 1. Need either --little-endian or --big-endian
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_big_endian'>big_endian</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'> looks like a v1 log file. You must specify either --little-endian or --big-endian</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from_io'>from_io</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'>: format v1 in </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_big_endian'>big_endian</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>big endian</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>little endian</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_from_version_1'>from_version_1</span><span class='lparen'>(</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_big_endian'>big_endian</span><span class='rparen'>)</span>

<span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="ObsoleteVersion.html" title="Pocolog::ObsoleteVersion (class)">ObsoleteVersion</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="valid_file?-class_method">
  
    .<strong>valid_file?</strong>(file)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns true if <code>file</code> is a valid, up-to-date, pocolog file</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 70</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_valid_file?'>valid_file?</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="Format.html" title="Pocolog::Format (module)">Format</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Format.html#Current-constant" title="Pocolog::Format::Current (constant)">Current</a></span></span><span class='period'>.</span><span class='id identifier rubyid_valid_file?'>valid_file?</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_block-class_method">
  
    .<strong>write_block</strong>(wio, type, index, payload)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Formats a block and writes it to <code>io</code></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


463
464
465
466
467</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 463</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_write_block'>write_block</span><span class='lparen'>(</span><span class='id identifier rubyid_wio'>wio</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_wio'>wio</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CxvV</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_wio'>wio</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_payload'>payload</span>
    <span class='id identifier rubyid_wio'>wio</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_data_block-class_method">
  
    .<strong>write_data_block</strong>(io, stream_index, rt, lg, compress, data)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


622
623
624
625
626
627
628
629
630
631
632
633
634</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 622</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_write_data_block'>write_data_block</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_stream_index'>stream_index</span><span class='comma'>,</span> <span class='id identifier rubyid_rt'>rt</span><span class='comma'>,</span> <span class='id identifier rubyid_lg'>lg</span><span class='comma'>,</span> <span class='id identifier rubyid_compress'>compress</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_rt'>rt</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Time</span><span class='rparen'>)</span>
            <span class='lbracket'>[</span><span class='id identifier rubyid_rt'>rt</span><span class='period'>.</span><span class='id identifier rubyid_tv_sec'>tv_sec</span><span class='comma'>,</span> <span class='id identifier rubyid_rt'>rt</span><span class='period'>.</span><span class='id identifier rubyid_tv_usec'>tv_usec</span><span class='comma'>,</span> <span class='id identifier rubyid_lg'>lg</span><span class='period'>.</span><span class='id identifier rubyid_tv_sec'>tv_sec</span><span class='comma'>,</span> <span class='id identifier rubyid_lg'>lg</span><span class='period'>.</span><span class='id identifier rubyid_tv_usec'>tv_usec</span><span class='comma'>,</span>
             <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='comma'>,</span> <span class='id identifier rubyid_compress'>compress</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rbracket'>]</span>
        <span class='kw'>else</span>
            <span class='lbracket'>[</span><span class='id identifier rubyid_rt'>rt</span> <span class='op'>/</span> <span class='int'>1_000_000</span><span class='comma'>,</span> <span class='id identifier rubyid_rt'>rt</span> <span class='op'>%</span> <span class='int'>1_000_000</span><span class='comma'>,</span>
             <span class='id identifier rubyid_lg'>lg</span> <span class='op'>/</span> <span class='int'>1_000_000</span><span class='comma'>,</span> <span class='id identifier rubyid_lg'>lg</span> <span class='op'>%</span> <span class='int'>1_000_000</span><span class='comma'>,</span>
             <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='comma'>,</span> <span class='id identifier rubyid_compress'>compress</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
    <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='id identifier rubyid_payload'>payload</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="#DATA_BLOCK_HEADER_FORMAT-constant" title="Pocolog::Logfiles::DATA_BLOCK_HEADER_FORMAT (constant)">DATA_BLOCK_HEADER_FORMAT</a></span></span><span class='embexpr_end'>}</span><span class='tstring_content'>a</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_write_block'>write_block</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="../Pocolog.html#DATA_BLOCK-constant" title="Pocolog::DATA_BLOCK (constant)">DATA_BLOCK</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_stream_index'>stream_index</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_prologue-class_method">
  
    .<strong>write_prologue</strong>(to_io, big_endian = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


4
5
6
7
8
9
10</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/convert.rb', line 4</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_write_prologue'>write_prologue</span><span class='lparen'>(</span><span class='id identifier rubyid_to_io'>to_io</span><span class='comma'>,</span> <span class='id identifier rubyid_big_endian'>big_endian</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="#MAGIC-constant" title="Pocolog::Logfiles::MAGIC (constant)">MAGIC</a></span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_big_endian'>big_endian</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_big_endian'>big_endian</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Pocolog.html" title="Pocolog (module)">Pocolog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_big_endian?'><span class='object_link'><a href="../Pocolog.html#big_endian%3F-class_method" title="Pocolog.big_endian? (method)">big_endian?</a></span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_to_io'>to_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='op'>*</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="#FORMAT_VERSION-constant" title="Pocolog::Logfiles::FORMAT_VERSION (constant)">FORMAT_VERSION</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_big_endian'>big_endian</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xVV</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_stream_declaration-class_method">
  
    .<strong>write_stream_declaration</strong>(wio, index, name, type_name, type_registry = nil, metadata = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Encodes and writes a stream declaration block to <code>wio</code></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


524
525
526
527
528
529
530
531</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 524</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_write_stream_declaration'>write_stream_declaration</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_wio'>wio</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_type_name'>type_name</span><span class='comma'>,</span> <span class='id identifier rubyid_type_registry'>type_registry</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_metadata'>metadata</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
<span class='rparen'>)</span>
    <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='id identifier rubyid_encode_stream_declaration_payload'>encode_stream_declaration_payload</span><span class='lparen'>(</span>
        <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_type_name'>type_name</span><span class='comma'>,</span> <span class='label'>type_registry:</span> <span class='id identifier rubyid_type_registry'>type_registry</span><span class='comma'>,</span> <span class='label'>metadata:</span> <span class='id identifier rubyid_metadata'>metadata</span>
    <span class='rparen'>)</span>
    <span class='id identifier rubyid_write_block'>write_block</span><span class='lparen'>(</span><span class='id identifier rubyid_wio'>wio</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="../Pocolog.html#STREAM_BLOCK-constant" title="Pocolog::STREAM_BLOCK (constant)">STREAM_BLOCK</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="close-instance_method">
  
    #<strong>close</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Close the underlying IO objects</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


145
146
147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 145</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
    <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="closed?-instance_method">
  
    #<strong>closed?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 135</span>

<span class='kw'>def</span> <span class='id identifier rubyid_closed?'>closed?</span>
    <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_stream-instance_method">
  
    #<strong>create_stream</strong>(name, type, metadata = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Explicitely creates a new stream named <code>name</code>, of the given type
and metadata</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 559</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_stream'>create_stream</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_metadata'>metadata</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='id identifier rubyid_registry'>registry</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:to_str</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_registry'>registry</span> <span class='op'>=</span> <span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_registry'>registry</span><span class='period'>.</span><span class='id identifier rubyid_minimal'>minimal</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_xml'>to_xml</span>

    <span class='ivar'>@streams</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_new_index'>new_index</span> <span class='op'>=</span> <span class='ivar'>@streams</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
    <span class='id identifier rubyid_pos'>pos</span> <span class='op'>=</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_tell'>tell</span>
    <span class='const'><span class='object_link'><a href="" title="Pocolog::Logfiles (class)">Logfiles</a></span></span><span class='period'>.</span><span class='id identifier rubyid_write_stream_declaration'><span class='object_link'><a href="#write_stream_declaration-class_method" title="Pocolog::Logfiles.write_stream_declaration (method)">write_stream_declaration</a></span></span><span class='lparen'>(</span>
        <span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_new_index'>new_index</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_registry'>registry</span><span class='comma'>,</span> <span class='id identifier rubyid_metadata'>metadata</span>
    <span class='rparen'>)</span>

    <span class='id identifier rubyid_stream'>stream</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="DataStream.html" title="Pocolog::DataStream (class)">DataStream</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="DataStream.html#initialize-instance_method" title="Pocolog::DataStream#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_new_index'>new_index</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_metadata'>metadata</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_stream'>stream</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_declaration_blocks'>declaration_blocks</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_pos'>pos</span>
    <span class='ivar'>@streams</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_stream'>stream</span>
    <span class='id identifier rubyid_stream'>stream</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="data-instance_method">
  
    #<strong>data</strong>(data_header = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the raw data payload of the current block</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


448
449
450
451
452
453
454
455
456
457
458
459
460</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 448</span>

<span class='kw'>def</span> <span class='id identifier rubyid_data'>data</span><span class='lparen'>(</span><span class='id identifier rubyid_data_header'>data_header</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='ivar'>@data</span> <span class='kw'>if</span> <span class='ivar'>@data</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_data_header'>data_header</span>

    <span class='id identifier rubyid_data_header'>data_header</span> <span class='op'>||=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_data_header'>data_header</span>
    <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='id identifier rubyid_data_header'>data_header</span><span class='period'>.</span><span class='id identifier rubyid_payload_pos'>payload_pos</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='id identifier rubyid_data_header'>data_header</span><span class='period'>.</span><span class='id identifier rubyid_data_size'>data_size</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_data_header'>data_header</span><span class='period'>.</span><span class='id identifier rubyid_compressed?'>compressed?</span>
        <span class='comment'># Payload is compressed
</span>        <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>Inflate</span><span class='period'>.</span><span class='id identifier rubyid_inflate'>inflate</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span> <span class='kw'>unless</span> <span class='id identifier rubyid_data_header'>data_header</span>
    <span class='id identifier rubyid_data'>data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="data_header-instance_method">
  
    #<strong>data_header</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Reads the header of a data block. This sets the @data_header instance
variable to a new DataHeader object describing the last read block. If you
want to keep a reference on a data block, and read it later, do the
following</p>

<pre class="code ruby"><code class="ruby">block = file.data_header.dup
[do something, including reading the file]
data  = file.data(block)
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


424
425
426
427
428
429
430
431
432
433
434
435
436</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 424</span>

<span class='kw'>def</span> <span class='id identifier rubyid_data_header'>data_header</span>
    <span class='kw'>unless</span> <span class='ivar'>@data_header</span>
        <span class='id identifier rubyid_raw_header'>raw_header</span> <span class='op'>=</span> <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_read_data_block_header'>read_data_block_header</span>
        <span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Logfiles/DataHeader.html" title="Pocolog::Logfiles::DataHeader (class)">DataHeader</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="BlockStream/DataBlockHeader.html#initialize-instance_method" title="Pocolog::BlockStream::DataBlockHeader#initialize (method)">new</a></span></span><span class='lparen'>(</span>
            <span class='id identifier rubyid_raw_header'>raw_header</span><span class='period'>.</span><span class='id identifier rubyid_rt_time'>rt_time</span><span class='comma'>,</span> <span class='id identifier rubyid_raw_header'>raw_header</span><span class='period'>.</span><span class='id identifier rubyid_lg_time'>lg_time</span><span class='comma'>,</span>
            <span class='id identifier rubyid_raw_header'>raw_header</span><span class='period'>.</span><span class='id identifier rubyid_data_size'>data_size</span><span class='comma'>,</span> <span class='id identifier rubyid_raw_header'>raw_header</span><span class='period'>.</span><span class='id identifier rubyid_compressed?'>compressed?</span>
        <span class='rparen'>)</span>
        <span class='id identifier rubyid_h'>h</span><span class='period'>.</span><span class='id identifier rubyid_block_pos'>block_pos</span>   <span class='op'>=</span> <span class='ivar'>@block_pos</span>
        <span class='id identifier rubyid_h'>h</span><span class='period'>.</span><span class='id identifier rubyid_payload_pos'>payload_pos</span> <span class='op'>=</span> <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_tell'>tell</span>
        <span class='ivar'>@data_header</span> <span class='op'>=</span> <span class='id identifier rubyid_h'>h</span>
    <span class='kw'>end</span>
    <span class='ivar'>@data_header</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="declared_stream?-instance_method">
  
    #<strong>declared_stream?</strong>(index)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>True if there is a stream <code>index</code></p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


388
389
390</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 388</span>

<span class='kw'>def</span> <span class='id identifier rubyid_declared_stream?'>declared_stream?</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='rparen'>)</span>
    <span class='ivar'>@streams</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='ivar'>@streams</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@streams</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="each_stream-instance_method">
  
    #<strong>each_stream</strong>(&amp;block)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Enumerate this file&#39;s streams</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


597
598
599</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 597</span>

<span class='kw'>def</span> <span class='id identifier rubyid_each_stream'>each_stream</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_streams'>streams</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="endian_swap-instance_method">
  
    #<strong>endian_swap</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Whether the endianness of the data stored in the file matches the
host&#39;s (false) or not (true)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 65</span>

<span class='kw'>def</span> <span class='id identifier rubyid_endian_swap'>endian_swap</span>
    <span class='id identifier rubyid_big_endian?'>big_endian?</span> <span class='op'>^</span> <span class='const'><span class='object_link'><a href="../Pocolog.html" title="Pocolog (module)">Pocolog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_big_endian?'><span class='object_link'><a href="../Pocolog.html#big_endian%3F-class_method" title="Pocolog.big_endian? (method)">big_endian?</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="eof?-instance_method">
  
    #<strong>eof?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>True if we read the last block in the file set</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


154
155
156</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 154</span>

<span class='kw'>def</span> <span class='id identifier rubyid_eof?'>eof?</span>
    <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_eof?'>eof?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="flush-instance_method">
  
    #<strong>flush</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Flush the IO objects</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 140</span>

<span class='kw'>def</span> <span class='id identifier rubyid_flush'>flush</span>
    <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_flush'>flush</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="has_stream?-instance_method">
  
    #<strong>has_stream?</strong>(name)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns true if <code>name</code> is the name of an existing stream</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


602
603
604
605</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 602</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_stream?'>has_stream?</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_stream'>stream</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>ArgumentError</span> <span class='comment'># rubocop:disable Lint/HandleExceptions
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialize_copy-instance_method">
  
    #<strong>initialize_copy</strong>(from)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


234
235
236
237
238
239
240</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 234</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize_copy'>initialize_copy</span><span class='lparen'>(</span><span class='id identifier rubyid_from'>from</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>    <span class='kw'>super</span>

    <span class='ivar'>@io</span> <span class='op'>=</span> <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
    <span class='ivar'>@block_stream</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BlockStream.html" title="Pocolog::BlockStream (class)">BlockStream</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="BlockStream.html#initialize-instance_method" title="Pocolog::BlockStream#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@io</span><span class='rparen'>)</span>
    <span class='ivar'>@registry</span> <span class='op'>=</span> <span class='id identifier rubyid_from'>from</span><span class='period'>.</span><span class='id identifier rubyid_registry'>registry</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialize_from_stream_info-instance_method">
  
    #<strong>initialize_from_stream_info</strong>(io, stream_info)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Initialize self by loading information from an index file</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 326</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize_from_stream_info'>initialize_from_stream_info</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_stream_info'>stream_info</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_block_stream'>block_stream</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BlockStream.html" title="Pocolog::BlockStream (class)">BlockStream</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="BlockStream.html#initialize-instance_method" title="Pocolog::BlockStream#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_stream_info'>stream_info</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_info'>info</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
        <span class='id identifier rubyid_pos'>pos</span> <span class='op'>=</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_declaration_blocks'>declaration_blocks</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
        <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='id identifier rubyid_pos'>pos</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_block_header'>block_header</span> <span class='op'>=</span> <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_read_next_block_header'>read_next_block_header</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_block_header'>block_header</span><span class='period'>.</span><span class='id identifier rubyid_kind'>kind</span> <span class='op'>!=</span> <span class='const'><span class='object_link'><a href="../Pocolog.html#STREAM_BLOCK-constant" title="Pocolog::STREAM_BLOCK (constant)">STREAM_BLOCK</a></span></span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="Pocolog::InvalidIndex (class)">InvalidIndex</a></span></span><span class='comma'>,</span>
                  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invalid stream declaration position in index: block </span><span class='tstring_end'>&#39;</span></span>\
                  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>is not a stream declaration block</span><span class='tstring_end'>&#39;</span></span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_block_header'>block_header</span><span class='period'>.</span><span class='id identifier rubyid_stream_index'>stream_index</span> <span class='op'>!=</span> <span class='id identifier rubyid_idx'>idx</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="Pocolog::InvalidIndex (class)">InvalidIndex</a></span></span><span class='comma'>,</span>
                  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invalid stream declaration position in index: </span><span class='tstring_end'>&#39;</span></span>\
                  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stream index mismatch between block header </span><span class='tstring_end'>&#39;</span></span>\
                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block_header'>block_header</span><span class='period'>.</span><span class='id identifier rubyid_stream_index'>stream_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>) and expected index </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_idx'>idx</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_stream_block'>stream_block</span> <span class='op'>=</span> <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_read_stream_block'>read_stream_block</span>

        <span class='comment'># Read the stream declaration block and then update the
</span>        <span class='comment'># info attribute of the stream object
</span>        <span class='kw'>unless</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_pos'>pos</span> <span class='op'>=</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_interval_io'>interval_io</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
            <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='id identifier rubyid_pos'>pos</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_block_info'>block_info</span> <span class='op'>=</span> <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_read_next_block_header'>read_next_block_header</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_kind'>kind</span> <span class='op'>!=</span> <span class='const'><span class='object_link'><a href="../Pocolog.html#DATA_BLOCK-constant" title="Pocolog::DATA_BLOCK (constant)">DATA_BLOCK</a></span></span>
                <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="Pocolog::InvalidIndex (class)">InvalidIndex</a></span></span><span class='comma'>,</span>
                      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invalid stream interval_io in index </span><span class='tstring_end'>&#39;</span></span>\
                      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>for stream </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_idx'>idx</span><span class='embexpr_end'>}</span><span class='tstring_content'>: expected first block at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pos'>pos</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='tstring_end'>&quot;</span></span>\
                      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>but this is not a data block</span><span class='tstring_end'>&#39;</span></span>
            <span class='kw'>elsif</span> <span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_stream_index'>stream_index</span> <span class='op'>!=</span> <span class='id identifier rubyid_idx'>idx</span>
                <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="Pocolog::InvalidIndex (class)">InvalidIndex</a></span></span><span class='comma'>,</span>
                      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invalid stream interval_io in index </span><span class='tstring_end'>&#39;</span></span>\
                      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>for stream </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_idx'>idx</span><span class='embexpr_end'>}</span><span class='tstring_content'>: first block at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pos'>pos</span><span class='embexpr_end'>}</span><span class='tstring_content'> found, </span><span class='tstring_end'>&quot;</span></span>\
                      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>but it is a block of stream </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block_info'>block_info</span><span class='period'>.</span><span class='id identifier rubyid_stream_index'>stream_index</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='lbracket'>[</span><span class='id identifier rubyid_stream_block'>stream_block</span><span class='comma'>,</span> <span class='id identifier rubyid_info'>info</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="joint_stream-instance_method">
  
    #<strong>joint_stream</strong>(use_rt, *names)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a JointStream object on the streams whose names are given. The
returned object is used to coherently iterate on the samples of the given
streams (i.e. it will yield samples that are valid at the same time)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


611
612
613
614
615
616</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 611</span>

<span class='kw'>def</span> <span class='id identifier rubyid_joint_stream'>joint_stream</span><span class='lparen'>(</span><span class='id identifier rubyid_use_rt'>use_rt</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_names'>names</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_streams'>streams</span> <span class='op'>=</span> <span class='id identifier rubyid_names'>names</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_n'>n</span><span class='op'>|</span>
        <span class='id identifier rubyid_stream'>stream</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='const'>JointStream</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_use_rt'>use_rt</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_streams'>streams</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_stream_info-instance_method">
  
    #<strong>load_stream_info</strong>(ios, index_dir: nil, silent: false)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="DataStream.html" title="Pocolog::DataStream (class)">DataStream</a></span>,nil&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Load stream information, either from an existing on-disk index or by
rebuilding an index</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="DataStream.html" title="Pocolog::DataStream (class)">DataStream</a></span>,nil&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 261</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_stream_info'>load_stream_info</span><span class='lparen'>(</span><span class='id identifier rubyid_ios'>ios</span><span class='comma'>,</span> <span class='label'>index_dir:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>silent:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_per_file_stream_info'>per_file_stream_info</span> <span class='op'>=</span> <span class='id identifier rubyid_ios'>ios</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_single_io'>single_io</span><span class='op'>|</span>
        <span class='id identifier rubyid_load_stream_info_from_file'>load_stream_info_from_file</span><span class='lparen'>(</span>
            <span class='id identifier rubyid_single_io'>single_io</span><span class='comma'>,</span>
            <span class='label'>index_dir:</span> <span class='lparen'>(</span><span class='id identifier rubyid_index_dir'>index_dir</span> <span class='op'>||</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='id identifier rubyid_single_io'>single_io</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='comma'>,</span>
            <span class='label'>silent:</span> <span class='id identifier rubyid_silent'>silent</span>
        <span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_stream_count'>stream_count</span> <span class='op'>=</span> <span class='id identifier rubyid_per_file_stream_info'>per_file_stream_info</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:size</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span> <span class='op'>||</span> <span class='int'>0</span>
    <span class='id identifier rubyid_per_stream'>per_stream</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lbracket'>[</span><span class='kw'>nil</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_stream_count'>stream_count</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_per_file_stream_info'>per_file_stream_info</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_streams'>streams</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_per_stream'>per_stream</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_stream_info'>stream_info</span><span class='comma'>,</span> <span class='id identifier rubyid_stream_index'>stream_index</span><span class='op'>|</span>
        <span class='id identifier rubyid_combined_info'>combined_info</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="StreamInfo.html" title="Pocolog::StreamInfo (class)">StreamInfo</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="StreamInfo.html#initialize-instance_method" title="Pocolog::StreamInfo#initialize (method)">new</a></span></span>
        <span class='id identifier rubyid_file_pos_offset'>file_pos_offset</span> <span class='op'>=</span> <span class='int'>0</span>
        <span class='id identifier rubyid_stream_block'>stream_block</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='comment'># We used an array of nil to initialize the zip. Remove it.
</span>        <span class='id identifier rubyid_stream_info'>stream_info</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>
        <span class='id identifier rubyid_stream_info'>stream_info</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_block'>block</span><span class='comma'>,</span> <span class='id identifier rubyid_info'>info</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_file_index'>file_index</span><span class='op'>|</span>
            <span class='id identifier rubyid_stream_block'>stream_block</span> <span class='op'>||=</span> <span class='id identifier rubyid_block'>block</span>
            <span class='id identifier rubyid_combined_info'>combined_info</span><span class='period'>.</span><span class='id identifier rubyid_concat'>concat</span><span class='lparen'>(</span><span class='id identifier rubyid_info'>info</span><span class='comma'>,</span> <span class='id identifier rubyid_file_pos_offset'>file_pos_offset</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_info'>info</span>
            <span class='id identifier rubyid_file_pos_offset'>file_pos_offset</span> <span class='op'>+=</span> <span class='id identifier rubyid_ios'>ios</span><span class='lbracket'>[</span><span class='id identifier rubyid_file_index'>file_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_stream_block'>stream_block</span>
            <span class='id identifier rubyid_streams'>streams</span><span class='lbracket'>[</span><span class='id identifier rubyid_stream_index'>stream_index</span><span class='rbracket'>]</span> <span class='op'>=</span>
                <span class='const'><span class='object_link'><a href="DataStream.html" title="Pocolog::DataStream (class)">DataStream</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="DataStream.html#initialize-instance_method" title="Pocolog::DataStream#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_stream_index'>stream_index</span><span class='comma'>,</span> <span class='id identifier rubyid_stream_block'>stream_block</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
                               <span class='id identifier rubyid_stream_block'>stream_block</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span>
                               <span class='id identifier rubyid_stream_block'>stream_block</span><span class='period'>.</span><span class='id identifier rubyid_metadata'>metadata</span><span class='comma'>,</span> <span class='id identifier rubyid_combined_info'>combined_info</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_streams'>streams</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_stream_info_from_file-instance_method">
  
    #<strong>load_stream_info_from_file</strong>(io, index_dir: File.dirname(io.path), silent: false)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="StreamInfo.html" title="Pocolog::StreamInfo (class)">StreamInfo</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the index for the file backed by the given IO</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>io</span>
      
      
        <span class='type'>(<tt>File</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the file. It must be a single file</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="StreamInfo.html" title="Pocolog::StreamInfo (class)">StreamInfo</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>list of streams in the given file</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 300</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_stream_info_from_file'>load_stream_info_from_file</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='label'>index_dir:</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>silent:</span> <span class='kw'>false</span>
<span class='rparen'>)</span>
    <span class='id identifier rubyid_index_filename'>index_filename</span> <span class='op'>=</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_default_index_filename'>default_index_filename</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='label'>index_dir:</span> <span class='id identifier rubyid_index_dir'>index_dir</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_index_filename'>index_filename</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="../Pocolog.html" title="Pocolog (module)">Pocolog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>loading file info from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_index_filename'>index_filename</span><span class='embexpr_end'>}</span><span class='tstring_content'>... </span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_silent'>silent</span>
        <span class='kw'>begin</span>
            <span class='id identifier rubyid_streams_info'>streams_info</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_index_filename'>index_filename</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_index_io'>index_io</span><span class='op'>|</span>
                <span class='const'><span class='object_link'><a href="Format.html" title="Pocolog::Format (module)">Format</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Format.html#Current-constant" title="Pocolog::Format::Current (constant)">Current</a></span></span><span class='period'>.</span><span class='id identifier rubyid_read_index'>read_index</span><span class='lparen'>(</span>
                    <span class='id identifier rubyid_index_io'>index_io</span><span class='comma'>,</span> <span class='label'>expected_file_size:</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='label'>expected_mtime:</span> <span class='kw'>nil</span>
                <span class='rparen'>)</span>
            <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='id identifier rubyid_initialize_from_stream_info'>initialize_from_stream_info</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_streams_info'>streams_info</span><span class='rparen'>)</span>
        <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="Pocolog::InvalidIndex (class)">InvalidIndex</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
            <span class='kw'>unless</span> <span class='id identifier rubyid_silent'>silent</span>
                <span class='const'><span class='object_link'><a href="../Pocolog.html" title="Pocolog (module)">Pocolog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid index file </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_index_filename'>index_filename</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_rebuild_and_load_index'>rebuild_and_load_index</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_index_filename'>index_filename</span><span class='comma'>,</span> <span class='label'>silent:</span> <span class='id identifier rubyid_silent'>silent</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_file-instance_method">
  
    #<strong>new_file</strong>(filename = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Continue writing logs in a new file. See #basename to know how files are
named</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 173</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new_file'>new_file</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_filename'>filename</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_basename'>basename</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_num_io'>num_io</span><span class='embexpr_end'>}</span><span class='tstring_content'>.log</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>w+</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="Format.html" title="Pocolog::Format (module)">Format</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Format.html#Current-constant" title="Pocolog::Format::Current (constant)">Current</a></span></span><span class='period'>.</span><span class='id identifier rubyid_write_prologue'>write_prologue</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_streams'>streams</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
        <span class='const'><span class='object_link'><a href="" title="Pocolog::Logfiles (class)">Logfiles</a></span></span><span class='period'>.</span><span class='id identifier rubyid_write_stream_declaration'><span class='object_link'><a href="#write_stream_declaration-class_method" title="Pocolog::Logfiles.write_stream_declaration (method)">write_stream_declaration</a></span></span><span class='lparen'>(</span>
            <span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_to_xml'>to_xml</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_metadata'>metadata</span>
        <span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_num_io'>num_io</span> <span class='op'>==</span> <span class='int'>0</span>
        <span class='ivar'>@io</span> <span class='op'>=</span> <span class='id identifier rubyid_io'>io</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_num_io'>num_io</span> <span class='op'>==</span> <span class='int'>1</span>
        <span class='ivar'>@io</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IOSequence.html" title="Pocolog::IOSequence (class)">IOSequence</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="IOSequence.html#initialize-instance_method" title="Pocolog::IOSequence#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@io</span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
        <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_add_io'>add_io</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='ivar'>@block_stream</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BlockStream.html" title="Pocolog::BlockStream (class)">BlockStream</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="BlockStream.html#initialize-instance_method" title="Pocolog::BlockStream#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@io</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="num_io-instance_method">
  
    #<strong>num_io</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129
130
131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 127</span>

<span class='kw'>def</span> <span class='id identifier rubyid_num_io'>num_io</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:num_io</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_num_io'>num_io</span>
    <span class='kw'>else</span>
        <span class='int'>1</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="open-instance_method">
  
    #<strong>open</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


149
150
151</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 149</span>

<span class='kw'>def</span> <span class='id identifier rubyid_open'>open</span>
    <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_one_block-instance_method">
  
    #<strong>read_one_block</strong>(file_pos)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Read the block information for the block at a certain position in the IO</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


394
395
396
397
398
399
400
401</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 394</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_one_block'>read_one_block</span><span class='lparen'>(</span><span class='id identifier rubyid_file_pos'>file_pos</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='id identifier rubyid_file_pos'>file_pos</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_header'>header</span> <span class='op'>=</span> <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_read_next_block_header'>read_next_block_header</span>
    <span class='ivar'>@block_pos</span> <span class='op'>=</span> <span class='id identifier rubyid_file_pos'>file_pos</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@data_header</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_header'>header</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_one_data_payload-instance_method">
  
    #<strong>read_one_data_payload</strong>(file_pos)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Read the data payload for a data block present at a certain position in the
IO</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


405
406
407
408</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 405</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_one_data_payload'>read_one_data_payload</span><span class='lparen'>(</span><span class='id identifier rubyid_file_pos'>file_pos</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_read_one_block'>read_one_block</span><span class='lparen'>(</span><span class='id identifier rubyid_file_pos'>file_pos</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_read_data_block_payload'>read_data_block_payload</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rebuild_and_load_index-instance_method">
  
    #<strong>rebuild_and_load_index</strong>(io, index_path = self.class.default_index_filename(io), silent: false)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Go through the whole file to extract index information, and write the index
file</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


371
372
373
374
375
376
377
378
379
380</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 371</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rebuild_and_load_index'>rebuild_and_load_index</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_index_path'>index_path</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_default_index_filename'>default_index_filename</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span><span class='comma'>,</span>
                           <span class='label'>silent:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='comment'># No index file. Compute it.
</span>    <span class='const'><span class='object_link'><a href="../Pocolog.html" title="Pocolog (module)">Pocolog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>building index </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'> ...</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_silent'>silent</span>
    <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_rewind'>rewind</span>
    <span class='id identifier rubyid_stream_info'>stream_info</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Format.html" title="Pocolog::Format (module)">Format</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Format.html#Current-constant" title="Pocolog::Format::Current (constant)">Current</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rebuild_index_file'>rebuild_index_file</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_index_path'>index_path</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_rewind'>rewind</span>
    <span class='const'><span class='object_link'><a href="../Pocolog.html" title="Pocolog (module)">Pocolog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>done</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_silent'>silent</span>
    <span class='id identifier rubyid_initialize_from_stream_info'>initialize_from_stream_info</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_stream_info'>stream_info</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stream-instance_method">
  
    #<strong>stream</strong>(name, type = nil, create = false)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the DataStream object for <code>name</code>, <code>registry</code>
and <code>type</code>. Optionally creates it.</p>

<p>If <code>create</code> is false, raises ArgumentError if the stream does
not exist.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


582
583
584
585
586
587
588
589
590
591
592
593
594</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 582</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stream'>stream</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_create'>create</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_matching_stream'>matching_stream</span> <span class='op'>=</span> <span class='id identifier rubyid_streams'>streams</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='id identifier rubyid_name'>name</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_matching_stream'>matching_stream</span>
    <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_type'>type</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_create'>create</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no such stream </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
        <span class='const'><span class='object_link'><a href="../Pocolog.html" title="Pocolog (module)">Pocolog</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn_deprecated'><span class='object_link'><a href="../Pocolog.html#warn_deprecated-class_method" title="Pocolog.warn_deprecated (method)">warn_deprecated</a></span></span><span class='lparen'>(</span>
            <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>the &quot;create&quot; flag of #stream is deprecated, </span><span class='tstring_end'>&#39;</span></span>\
            <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>use #create_stream directly instead</span><span class='tstring_end'>&#39;</span></span>
        <span class='rparen'>)</span>
        <span class='id identifier rubyid_create_stream'>create_stream</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stream_aligner-instance_method">
  
    #<strong>stream_aligner</strong>(use_rt = false)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a stream aligner on all streams of this logfile</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


650
651
652</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 650</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stream_aligner'>stream_aligner</span><span class='lparen'>(</span><span class='id identifier rubyid_use_rt'>use_rt</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="StreamAligner.html" title="Pocolog::StreamAligner (class)">StreamAligner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="StreamAligner.html#initialize-instance_method" title="Pocolog::StreamAligner#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_use_rt'>use_rt</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_streams'>streams</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stream_from_index-instance_method">
  
    #<strong>stream_from_index</strong>(index)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a stream from its index</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


383
384
385</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 383</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stream_from_index'>stream_from_index</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='rparen'>)</span>
    <span class='ivar'>@streams</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stream_from_type-instance_method">
  
    #<strong>stream_from_type</strong>(type)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a stream of the given type, if there is only one. The type can be
given by its name or through a Typelib::Type subclass</p>

<p>If there is no match or multiple matches, raises ArgumentError.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


544
545
546
547
548
549
550
551
552
553
554
555</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 544</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stream_from_type'>stream_from_type</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_matches'>matches</span> <span class='op'>=</span> <span class='id identifier rubyid_streams_from_type'>streams_from_type</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_matches'>matches</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
              <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>there is no stream in this file with the required type</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_matches'>matches</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
              <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>there is more than one stream in this file with the required type</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>else</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_matches'>matches</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="streams_from_type-instance_method">
  
    #<strong>streams_from_type</strong>(type)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns all streams of the given type. The type can be given by its name or
through a Typelib::Type subclass</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


535
536
537
538</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 535</span>

<span class='kw'>def</span> <span class='id identifier rubyid_streams_from_type'>streams_from_type</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='kw'>if</span> <span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_streams'>streams</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='id identifier rubyid_type'>type</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sub_field-instance_method">
  
    #<strong>sub_field</strong>(offset, size, data_header = self.data_header)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


438
439
440
441
442
443
444
445</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 438</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sub_field'>sub_field</span><span class='lparen'>(</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_data_header'>data_header</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_data_header'>data_header</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_data_header'>data_header</span><span class='period'>.</span><span class='id identifier rubyid_compressed'>compressed</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>field access on compressed files is unsupported</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='id identifier rubyid_data_header'>data_header</span><span class='period'>.</span><span class='id identifier rubyid_payload_pos'>payload_pos</span> <span class='op'>+</span> <span class='id identifier rubyid_offset'>offset</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tell-instance_method">
  
    #<strong>tell</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the current position in the current IO</p>

<p>This is the position of the next block.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


167
168
169</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 167</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tell'>tell</span>
    <span class='id identifier rubyid_block_stream'>block_stream</span><span class='period'>.</span><span class='id identifier rubyid_tell'>tell</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_block-instance_method">
  
    #<strong>write_block</strong>(type, index, payload)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Write a raw block. <code>type</code> is the block type (either
CONTROL_BLOCK, DATA_BLOCK or STREAM_BLOCK), <code>index</code> the stream
index for stream and data blocks and the control block type for control
blocs. <code>payload</code> is the block&#39;s payload.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


473
474
475</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 473</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_block'>write_block</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="" title="Pocolog::Logfiles (class)">Logfiles</a></span></span><span class='period'>.</span><span class='id identifier rubyid_write_block'><span class='object_link'><a href="#write_block-class_method" title="Pocolog::Logfiles.write_block (method)">write_block</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_data_block-instance_method">
  
    #<strong>write_data_block</strong>(stream, rt, lg, data)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Write a data block for stream index <code>stream</code>, with the provided
times and the given data. <code>data</code> must already be marshalled
(i.e. it is meant to be a String that represents a byte array).</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


639
640
641
642
643
644
645
646
647</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pocolog/logfiles.rb', line 639</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_data_block'>write_data_block</span><span class='lparen'>(</span><span class='id identifier rubyid_stream'>stream</span><span class='comma'>,</span> <span class='id identifier rubyid_rt'>rt</span><span class='comma'>,</span> <span class='id identifier rubyid_lg'>lg</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>    <span class='id identifier rubyid_compress'>compress</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_compress?'>compress?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='const'><span class='object_link'><a href="#COMPRESSION_MIN_SIZE-constant" title="Pocolog::Logfiles::COMPRESSION_MIN_SIZE (constant)">COMPRESSION_MIN_SIZE</a></span></span>
        <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>Deflate</span><span class='period'>.</span><span class='id identifier rubyid_deflate'>deflate</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_compress'>compress</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='kw'>end</span>

    <span class='const'><span class='object_link'><a href="" title="Pocolog::Logfiles (class)">Logfiles</a></span></span><span class='period'>.</span><span class='id identifier rubyid_write_data_block'><span class='object_link'><a href="#write_data_block-class_method" title="Pocolog::Logfiles.write_data_block (method)">write_data_block</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_stream'>stream</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_rt'>rt</span><span class='comma'>,</span> <span class='id identifier rubyid_lg'>lg</span><span class='comma'>,</span> <span class='id identifier rubyid_compress'>compress</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.12 (ruby-2.5.1).
</div>

    </div>
  </body>
</html>